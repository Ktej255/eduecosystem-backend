"""Add persistent storage fields to Batch1Segment

Revision ID: 9eed3ff38601
Revises: 2f618313c857
Create Date: 2026-01-02 13:54:41.265284

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import sqlite

# revision identifiers, used by Alembic.
revision: str = '9eed3ff38601'
down_revision: Union[str, Sequence[str], None] = '2f618313c857'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table('assignments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_assignments_id'))
        batch_op.drop_index(batch_op.f('ix_assignments_title'))

    op.drop_table('assignments')
    with op.batch_alter_table('project_milestones', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_project_milestones_id'))

    op.drop_table('project_milestones')
    with op.batch_alter_table('courses', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_courses_category_id'))
        batch_op.drop_index(batch_op.f('ix_courses_id'))
        batch_op.drop_index(batch_op.f('ix_courses_instructor_id'))
        batch_op.drop_index(batch_op.f('ix_courses_is_published'))
        batch_op.drop_index(batch_op.f('ix_courses_level'))
        batch_op.drop_index(batch_op.f('ix_courses_slug'))
        batch_op.drop_index(batch_op.f('ix_courses_title'))

    op.drop_table('courses')
    with op.batch_alter_table('user_achievements', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_achievements_achievement_id'))
        batch_op.drop_index(batch_op.f('ix_user_achievements_id'))
        batch_op.drop_index(batch_op.f('ix_user_achievements_user_id'))

    op.drop_table('user_achievements')
    with op.batch_alter_table('user_permissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_permissions_id'))
        batch_op.drop_index(batch_op.f('ix_user_permissions_user_id'))

    op.drop_table('user_permissions')
    with op.batch_alter_table('bundle_enrollments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_bundle_enrollments_bundle_id'))
        batch_op.drop_index(batch_op.f('ix_bundle_enrollments_id'))
        batch_op.drop_index(batch_op.f('ix_bundle_enrollments_user_id'))

    op.drop_table('bundle_enrollments')
    op.drop_table('role_permissions')
    with op.batch_alter_table('meditation_progress', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_meditation_progress_id'))

    op.drop_table('meditation_progress')
    with op.batch_alter_table('live_class_chat_messages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_class_chat_messages_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_chat_messages_live_class_id'))

    op.drop_table('live_class_chat_messages')
    with op.batch_alter_table('ai_conversations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_conversations_id'))

    op.drop_table('ai_conversations')
    with op.batch_alter_table('order_items', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_order_items_id'))
        batch_op.drop_index(batch_op.f('ix_order_items_order_id'))

    op.drop_table('order_items')
    with op.batch_alter_table('certificate_templates', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_certificate_templates_id'))

    op.drop_table('certificate_templates')
    with op.batch_alter_table('bank_questions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_bank_questions_id'))

    op.drop_table('bank_questions')
    with op.batch_alter_table('drill_questions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_drill_questions_gs_paper'))
        batch_op.drop_index(batch_op.f('ix_drill_questions_topic'))

    op.drop_table('drill_questions')
    with op.batch_alter_table('chat_feedback', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_chat_feedback_id'))

    op.drop_table('chat_feedback')
    with op.batch_alter_table('drill_daily_summaries', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_drill_daily_summaries_date'))
        batch_op.drop_index(batch_op.f('ix_drill_daily_summaries_student_id'))

    op.drop_table('drill_daily_summaries')
    with op.batch_alter_table('leads', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_leads_email'))
        batch_op.drop_index(batch_op.f('ix_leads_id'))
        batch_op.drop_index(batch_op.f('ix_leads_name'))
        batch_op.drop_index(batch_op.f('ix_leads_phone'))
        batch_op.drop_index(batch_op.f('ix_leads_source_primary'))

    op.drop_table('leads')
    with op.batch_alter_table('message_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_message_logs_channel'))
        batch_op.drop_index(batch_op.f('ix_message_logs_id'))
        batch_op.drop_index(batch_op.f('ix_message_logs_lead_id'))
        batch_op.drop_index(batch_op.f('ix_message_logs_status'))

    op.drop_table('message_logs')
    with op.batch_alter_table('user_preferences', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_preferences_id'))

    op.drop_table('user_preferences')
    with op.batch_alter_table('questions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_questions_id'))

    op.drop_table('questions')
    with op.batch_alter_table('affiliate_commissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_affiliate_commissions_affiliate_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_commissions_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_commissions_referral_id'))

    op.drop_table('affiliate_commissions')
    with op.batch_alter_table('drill_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_drill_sessions_date'))
        batch_op.drop_index(batch_op.f('ix_drill_sessions_student_id'))

    op.drop_table('drill_sessions')
    with op.batch_alter_table('quiz_results', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_quiz_results_id'))
        batch_op.drop_index(batch_op.f('ix_quiz_results_segment_key'))
        batch_op.drop_index(batch_op.f('ix_quiz_results_student_email'))

    op.drop_table('quiz_results')
    with op.batch_alter_table('exam_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_exam_sessions_id'))

    op.drop_table('exam_sessions')
    with op.batch_alter_table('live_class_questions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_class_questions_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_questions_live_class_id'))

    op.drop_table('live_class_questions')
    with op.batch_alter_table('chat_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_chat_sessions_id'))

    op.drop_table('chat_sessions')
    with op.batch_alter_table('email_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_email_logs_created_at'))
        batch_op.drop_index(batch_op.f('ix_email_logs_id'))
        batch_op.drop_index(batch_op.f('ix_email_logs_status'))
        batch_op.drop_index(batch_op.f('ix_email_logs_user_id'))

    op.drop_table('email_logs')
    op.drop_table('upsc_drills')
    with op.batch_alter_table('user_rewards', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_rewards_id'))

    op.drop_table('user_rewards')
    with op.batch_alter_table('automation_analytics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_automation_analytics_date'))
        batch_op.drop_index(batch_op.f('ix_automation_analytics_id'))
        batch_op.drop_index(batch_op.f('ix_automation_analytics_workflow_id'))

    op.drop_table('automation_analytics')
    with op.batch_alter_table('collaborative_projects', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_collaborative_projects_id'))

    op.drop_table('collaborative_projects')
    with op.batch_alter_table('chatbot_messages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_chatbot_messages_id'))

    op.drop_table('chatbot_messages')
    with op.batch_alter_table('email_templates', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_email_templates_id'))
        batch_op.drop_index(batch_op.f('ix_email_templates_name'))
        batch_op.drop_index(batch_op.f('ix_email_templates_notification_type'))

    op.drop_table('email_templates')
    op.drop_table('drill_model_answers')
    with op.batch_alter_table('quiz_feedback', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_quiz_feedback_id'))

    op.drop_table('quiz_feedback')
    with op.batch_alter_table('shopping_carts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_shopping_carts_id'))
        batch_op.drop_index(batch_op.f('ix_shopping_carts_session_id'))
        batch_op.drop_index(batch_op.f('ix_shopping_carts_user_id'))

    op.drop_table('shopping_carts')
    op.drop_table('upsc_attempts')
    with op.batch_alter_table('user_language_preferences', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_language_preferences_id'))
        batch_op.drop_index(batch_op.f('ix_user_language_preferences_user_id'))

    op.drop_table('user_language_preferences')
    with op.batch_alter_table('lessons', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_lessons_id'))
        batch_op.drop_index(batch_op.f('ix_lessons_module_id'))
        batch_op.drop_index(batch_op.f('ix_lessons_order_index'))
        batch_op.drop_index(batch_op.f('ix_lessons_type'))

    op.drop_table('lessons')
    with op.batch_alter_table('affiliate_payouts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_affiliate_payouts_affiliate_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_payouts_id'))

    op.drop_table('affiliate_payouts')
    with op.batch_alter_table('instructor_analytics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_instructor_analytics_date'))
        batch_op.drop_index(batch_op.f('ix_instructor_analytics_id'))

    op.drop_table('instructor_analytics')
    with op.batch_alter_table('project_teams', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_project_teams_id'))

    op.drop_table('project_teams')
    with op.batch_alter_table('live_class_attendance', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_class_attendance_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_attendance_live_class_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_attendance_student_id'))

    op.drop_table('live_class_attendance')
    with op.batch_alter_table('ai_debug_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_debug_sessions_session_id'))

    op.drop_table('ai_debug_sessions')
    op.drop_table('upsc_batches')
    with op.batch_alter_table('lesson_notes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_lesson_notes_id'))

    op.drop_table('lesson_notes')
    op.drop_table('upsc_plans')
    with op.batch_alter_table('path_courses', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_path_courses_course_id'))
        batch_op.drop_index(batch_op.f('ix_path_courses_id'))
        batch_op.drop_index(batch_op.f('ix_path_courses_order_index'))
        batch_op.drop_index(batch_op.f('ix_path_courses_path_id'))

    op.drop_table('path_courses')
    with op.batch_alter_table('peer_review_assignments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_peer_review_assignments_id'))

    op.drop_table('peer_review_assignments')
    with op.batch_alter_table('categories', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_categories_id'))
        batch_op.drop_index(batch_op.f('ix_categories_name'))
        batch_op.drop_index(batch_op.f('ix_categories_slug'))

    op.drop_table('categories')
    with op.batch_alter_table('instructor_payouts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_instructor_payouts_id'))
        batch_op.drop_index(batch_op.f('ix_instructor_payouts_instructor_id'))

    op.drop_table('instructor_payouts')
    with op.batch_alter_table('midnight_test_questions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_midnight_test_questions_id'))
        batch_op.drop_index(batch_op.f('ix_midnight_test_questions_topic_id'))

    op.drop_table('midnight_test_questions')
    with op.batch_alter_table('tax_calculations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_tax_calculations_id'))
        batch_op.drop_index(batch_op.f('ix_tax_calculations_order_id'))
        batch_op.drop_index(batch_op.f('ix_tax_calculations_payment_id'))
        batch_op.drop_index(batch_op.f('ix_tax_calculations_subscription_id'))
        batch_op.drop_index(batch_op.f('ix_tax_calculations_user_id'))

    op.drop_table('tax_calculations')
    with op.batch_alter_table('group_memberships', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_group_memberships_id'))

    op.drop_table('group_memberships')
    with op.batch_alter_table('user_subscriptions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_subscriptions_id'))
        batch_op.drop_index(batch_op.f('ix_user_subscriptions_plan_id'))
        batch_op.drop_index(batch_op.f('ix_user_subscriptions_stripe_subscription_id'))
        batch_op.drop_index(batch_op.f('ix_user_subscriptions_user_id'))

    op.drop_table('user_subscriptions')
    op.drop_table('upsc_reports')
    with op.batch_alter_table('content_embeddings', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_embeddings_content_id'))
        batch_op.drop_index(batch_op.f('ix_content_embeddings_id'))

    op.drop_table('content_embeddings')
    with op.batch_alter_table('course_bundles', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_course_bundles_id'))
        batch_op.drop_index(batch_op.f('ix_course_bundles_slug'))
        batch_op.drop_index(batch_op.f('ix_course_bundles_title'))

    op.drop_table('course_bundles')
    with op.batch_alter_table('two_factor_auth', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_two_factor_auth_id'))
        batch_op.drop_index(batch_op.f('ix_two_factor_auth_user_id'))

    op.drop_table('two_factor_auth')
    op.drop_table('user_roles')
    with op.batch_alter_table('live_classes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_classes_course_id'))
        batch_op.drop_index(batch_op.f('ix_live_classes_id'))
        batch_op.drop_index(batch_op.f('ix_live_classes_scheduled_at'))
        batch_op.drop_index(batch_op.f('ix_live_classes_status'))

    op.drop_table('live_classes')
    with op.batch_alter_table('tags', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_tags_id'))
        batch_op.drop_index(batch_op.f('ix_tags_name'))
        batch_op.drop_index(batch_op.f('ix_tags_slug'))

    op.drop_table('tags')
    op.drop_table('upsc_content')
    with op.batch_alter_table('two_factor_backup_codes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_two_factor_backup_codes_id'))
        batch_op.drop_index(batch_op.f('ix_two_factor_backup_codes_two_factor_auth_id'))
        batch_op.drop_index(batch_op.f('ix_two_factor_backup_codes_user_id'))

    op.drop_table('two_factor_backup_codes')
    with op.batch_alter_table('instructor_payment_info', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_instructor_payment_info_id'))
        batch_op.drop_index(batch_op.f('ix_instructor_payment_info_instructor_id'))

    op.drop_table('instructor_payment_info')
    with op.batch_alter_table('payment_methods', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_payment_methods_id'))
        batch_op.drop_index(batch_op.f('ix_payment_methods_user_id'))

    op.drop_table('payment_methods')
    op.drop_table('upsc_timer_configs')
    with op.batch_alter_table('groups', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_groups_id'))
        batch_op.drop_index(batch_op.f('ix_groups_name'))

    op.drop_table('groups')
    with op.batch_alter_table('orders', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_orders_guest_email'))
        batch_op.drop_index(batch_op.f('ix_orders_id'))
        batch_op.drop_index(batch_op.f('ix_orders_order_number'))
        batch_op.drop_index(batch_op.f('ix_orders_status'))
        batch_op.drop_index(batch_op.f('ix_orders_user_id'))

    op.drop_table('orders')
    with op.batch_alter_table('data_masking_configs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_data_masking_configs_id'))
        batch_op.drop_index(batch_op.f('ix_data_masking_configs_role'))
        batch_op.drop_index(batch_op.f('ix_data_masking_configs_user_id'))

    op.drop_table('data_masking_configs')
    with op.batch_alter_table('peer_reviews', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_peer_reviews_id'))

    op.drop_table('peer_reviews')
    with op.batch_alter_table('group_posts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_group_posts_id'))

    op.drop_table('group_posts')
    with op.batch_alter_table('meditation_process_completions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_meditation_process_completions_id'))

    op.drop_table('meditation_process_completions')
    with op.batch_alter_table('discussion_threads', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_discussion_threads_id'))
        batch_op.drop_index(batch_op.f('ix_discussion_threads_title'))

    op.drop_table('discussion_threads')
    with op.batch_alter_table('retention_reviews', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_retention_reviews_id'))

    op.drop_table('retention_reviews')
    with op.batch_alter_table('graphotherapy_day_completions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_graphotherapy_day_completions_id'))

    op.drop_table('graphotherapy_day_completions')
    with op.batch_alter_table('direct_messages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_direct_messages_id'))
        batch_op.drop_index(batch_op.f('ix_direct_messages_receiver_id'))
        batch_op.drop_index(batch_op.f('ix_direct_messages_sender_id'))

    op.drop_table('direct_messages')
    with op.batch_alter_table('meditation_day_completions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_meditation_day_completions_id'))

    op.drop_table('meditation_day_completions')
    with op.batch_alter_table('friendships', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_friendships_friend_id'))
        batch_op.drop_index(batch_op.f('ix_friendships_id'))
        batch_op.drop_index(batch_op.f('ix_friendships_user_id'))

    op.drop_table('friendships')
    with op.batch_alter_table('course_reviews', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_course_reviews_course_id'))
        batch_op.drop_index(batch_op.f('ix_course_reviews_id'))
        batch_op.drop_index(batch_op.f('ix_course_reviews_user_id'))

    op.drop_table('course_reviews')
    with op.batch_alter_table('batch1_segments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_batch1_segments_id'))
        batch_op.drop_index(batch_op.f('ix_batch1_segments_segment_key'))

    op.drop_table('batch1_segments')
    with op.batch_alter_table('analytics_events', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_analytics_events_event_type'))
        batch_op.drop_index(batch_op.f('ix_analytics_events_id'))
        batch_op.drop_index(batch_op.f('ix_analytics_events_timestamp'))

    op.drop_table('analytics_events')
    with op.batch_alter_table('daily_tasks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_daily_tasks_date'))
        batch_op.drop_index(batch_op.f('ix_daily_tasks_user_id'))

    op.drop_table('daily_tasks')
    with op.batch_alter_table('organizations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_organizations_domain'))
        batch_op.drop_index(batch_op.f('ix_organizations_id'))
        batch_op.drop_index(batch_op.f('ix_organizations_slug'))

    op.drop_table('organizations')
    with op.batch_alter_table('tax_exemptions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_tax_exemptions_id'))
        batch_op.drop_index(batch_op.f('ix_tax_exemptions_organization_id'))
        batch_op.drop_index(batch_op.f('ix_tax_exemptions_user_id'))

    op.drop_table('tax_exemptions')
    with op.batch_alter_table('project_team_members', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_project_team_members_id'))

    op.drop_table('project_team_members')
    with op.batch_alter_table('ai_debug_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_debug_logs_session_id'))

    op.drop_table('ai_debug_logs')
    with op.batch_alter_table('user_email_preferences', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_email_preferences_id'))
        batch_op.drop_index(batch_op.f('ix_user_email_preferences_user_id'))

    op.drop_table('user_email_preferences')
    with op.batch_alter_table('content_difficulty_analyses', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_difficulty_analyses_content_id'))
        batch_op.drop_index(batch_op.f('ix_content_difficulty_analyses_id'))

    op.drop_table('content_difficulty_analyses')
    with op.batch_alter_table('course_announcements', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_course_announcements_id'))

    op.drop_table('course_announcements')
    with op.batch_alter_table('discussion_categories', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_discussion_categories_id'))

    op.drop_table('discussion_categories')
    op.drop_table('course_tags')
    with op.batch_alter_table('handwriting_submissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_handwriting_submissions_id'))
        batch_op.drop_index(batch_op.f('ix_handwriting_submissions_user_id'))

    op.drop_table('handwriting_submissions')
    with op.batch_alter_table('quizzes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_quizzes_id'))
        batch_op.drop_index(batch_op.f('ix_quizzes_title'))

    op.drop_table('quizzes')
    with op.batch_alter_table('post_votes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_post_votes_id'))

    op.drop_table('post_votes')
    with op.batch_alter_table('subscription_invoices', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_subscription_invoices_id'))
        batch_op.drop_index(batch_op.f('ix_subscription_invoices_subscription_id'))

    op.drop_table('subscription_invoices')
    with op.batch_alter_table('modules', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_modules_course_id'))
        batch_op.drop_index(batch_op.f('ix_modules_id'))
        batch_op.drop_index(batch_op.f('ix_modules_order_index'))

    op.drop_table('modules')
    with op.batch_alter_table('user_topic_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_topic_logs_id'))
        batch_op.drop_index(batch_op.f('ix_user_topic_logs_topic_id'))
        batch_op.drop_index(batch_op.f('ix_user_topic_logs_user_id'))

    op.drop_table('user_topic_logs')
    op.drop_table('upsc_student_progress')
    with op.batch_alter_table('live_class_polls', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_class_polls_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_polls_live_class_id'))

    op.drop_table('live_class_polls')
    with op.batch_alter_table('user_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_sessions_id'))
        batch_op.drop_index(batch_op.f('ix_user_sessions_session_token'))
        batch_op.drop_index(batch_op.f('ix_user_sessions_user_id'))

    op.drop_table('user_sessions')
    with op.batch_alter_table('certificates', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_certificates_certificate_number'))
        batch_op.drop_index(batch_op.f('ix_certificates_course_id'))
        batch_op.drop_index(batch_op.f('ix_certificates_id'))
        batch_op.drop_index(batch_op.f('ix_certificates_user_id'))

    op.drop_table('certificates')
    with op.batch_alter_table('ai_generated_quizzes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_generated_quizzes_course_id'))
        batch_op.drop_index(batch_op.f('ix_ai_generated_quizzes_id'))
        batch_op.drop_index(batch_op.f('ix_ai_generated_quizzes_lesson_id'))

    op.drop_table('ai_generated_quizzes')
    with op.batch_alter_table('realtime_chat_messages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_realtime_chat_messages_id'))
        batch_op.drop_index(batch_op.f('ix_realtime_chat_messages_sender_id'))

    op.drop_table('realtime_chat_messages')
    with op.batch_alter_table('ai_grading_results', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_grading_results_id'))

    op.drop_table('ai_grading_results')
    with op.batch_alter_table('blockchain_blocks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_blockchain_blocks_hash'))
        batch_op.drop_index(batch_op.f('ix_blockchain_blocks_id'))
        batch_op.drop_index(batch_op.f('ix_blockchain_blocks_index'))

    op.drop_table('blockchain_blocks')
    with op.batch_alter_table('sso_audit_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_sso_audit_logs_created_at'))
        batch_op.drop_index(batch_op.f('ix_sso_audit_logs_event_type'))
        batch_op.drop_index(batch_op.f('ix_sso_audit_logs_id'))
        batch_op.drop_index(batch_op.f('ix_sso_audit_logs_organization_id'))
        batch_op.drop_index(batch_op.f('ix_sso_audit_logs_user_id'))

    op.drop_table('sso_audit_logs')
    with op.batch_alter_table('subscription_coupons', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_subscription_coupons_code'))
        batch_op.drop_index(batch_op.f('ix_subscription_coupons_id'))

    op.drop_table('subscription_coupons')
    with op.batch_alter_table('realtime_user_presence', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_realtime_user_presence_id'))
        batch_op.drop_index(batch_op.f('ix_realtime_user_presence_user_id'))

    op.drop_table('realtime_user_presence')
    with op.batch_alter_table('student_analytics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_student_analytics_id'))

    op.drop_table('student_analytics')
    with op.batch_alter_table('rewards', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_rewards_id'))
        batch_op.drop_index(batch_op.f('ix_rewards_name'))

    op.drop_table('rewards')
    with op.batch_alter_table('languages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_languages_code'))
        batch_op.drop_index(batch_op.f('ix_languages_id'))

    op.drop_table('languages')
    with op.batch_alter_table('study_groups', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_study_groups_id'))
        batch_op.drop_index(batch_op.f('ix_study_groups_name'))

    op.drop_table('study_groups')
    with op.batch_alter_table('curriculum_insights', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_curriculum_insights_date'))
        batch_op.drop_index(batch_op.f('ix_curriculum_insights_gs_paper'))

    op.drop_table('curriculum_insights')
    with op.batch_alter_table('live_class_reactions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_class_reactions_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_reactions_live_class_id'))

    op.drop_table('live_class_reactions')
    op.drop_table('question_bank_questions')
    with op.batch_alter_table('enquiries', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_enquiries_email'))
        batch_op.drop_index(batch_op.f('ix_enquiries_id'))
        batch_op.drop_index(batch_op.f('ix_enquiries_name'))

    op.drop_table('enquiries')
    with op.batch_alter_table('notifications', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_notifications_created_at'))
        batch_op.drop_index(batch_op.f('ix_notifications_id'))
        batch_op.drop_index(batch_op.f('ix_notifications_is_read'))
        batch_op.drop_index(batch_op.f('ix_notifications_priority'))
        batch_op.drop_index(batch_op.f('ix_notifications_type'))
        batch_op.drop_index(batch_op.f('ix_notifications_user_id'))

    op.drop_table('notifications')
    with op.batch_alter_table('ai_usage_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_created_at'))
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_feature'))
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_id'))
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_user_id'))

    op.drop_table('ai_usage_logs')
    with op.batch_alter_table('permissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_permissions_action'))
        batch_op.drop_index(batch_op.f('ix_permissions_id'))
        batch_op.drop_index(batch_op.f('ix_permissions_name'))
        batch_op.drop_index(batch_op.f('ix_permissions_resource'))

    op.drop_table('permissions')
    op.drop_table('course_bundle_items')
    with op.batch_alter_table('submissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_submissions_id'))

    op.drop_table('submissions')
    with op.batch_alter_table('lesson_drip_settings', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_lesson_drip_settings_id'))

    op.drop_table('lesson_drip_settings')
    op.drop_table('upsc_questions')
    with op.batch_alter_table('subscription_plans', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_subscription_plans_id'))
        batch_op.drop_index(batch_op.f('ix_subscription_plans_slug'))

    op.drop_table('subscription_plans')
    with op.batch_alter_table('habits', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_habits_user_id'))

    op.drop_table('habits')
    with op.batch_alter_table('course_recommendations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_course_recommendations_id'))

    op.drop_table('course_recommendations')
    with op.batch_alter_table('translations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_translations_id'))
        batch_op.drop_index(batch_op.f('ix_translations_key'))
        batch_op.drop_index(batch_op.f('ix_translations_language_code'))
        batch_op.drop_index(batch_op.f('ix_translations_namespace'))

    op.drop_table('translations')
    with op.batch_alter_table('workflow_executions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_workflow_executions_id'))
        batch_op.drop_index(batch_op.f('ix_workflow_executions_lead_id'))
        batch_op.drop_index(batch_op.f('ix_workflow_executions_status'))
        batch_op.drop_index(batch_op.f('ix_workflow_executions_workflow_id'))

    op.drop_table('workflow_executions')
    with op.batch_alter_table('review_helpful', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_review_helpful_id'))
        batch_op.drop_index(batch_op.f('ix_review_helpful_review_id'))
        batch_op.drop_index(batch_op.f('ix_review_helpful_user_id'))

    op.drop_table('review_helpful')
    with op.batch_alter_table('coupons', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_coupons_code'))
        batch_op.drop_index(batch_op.f('ix_coupons_id'))

    op.drop_table('coupons')
    with op.batch_alter_table('sso_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_sso_sessions_id'))
        batch_op.drop_index(batch_op.f('ix_sso_sessions_provider_session_id'))
        batch_op.drop_index(batch_op.f('ix_sso_sessions_session_id'))
        batch_op.drop_index(batch_op.f('ix_sso_sessions_user_id'))

    op.drop_table('sso_sessions')
    with op.batch_alter_table('admin_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_admin_logs_action'))
        batch_op.drop_index(batch_op.f('ix_admin_logs_admin_id'))
        batch_op.drop_index(batch_op.f('ix_admin_logs_created_at'))
        batch_op.drop_index(batch_op.f('ix_admin_logs_id'))

    op.drop_table('admin_logs')
    with op.batch_alter_table('tax_rates', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_tax_rates_country_code'))
        batch_op.drop_index(batch_op.f('ix_tax_rates_id'))
        batch_op.drop_index(batch_op.f('ix_tax_rates_state_code'))

    op.drop_table('tax_rates')
    with op.batch_alter_table('discussion_posts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_discussion_posts_id'))

    op.drop_table('discussion_posts')
    with op.batch_alter_table('shadow_mode_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_shadow_mode_sessions_id'))
        batch_op.drop_index(batch_op.f('ix_shadow_mode_sessions_user_id'))

    op.drop_table('shadow_mode_sessions')
    with op.batch_alter_table('quiz_question_pools', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_quiz_question_pools_id'))

    op.drop_table('quiz_question_pools')
    with op.batch_alter_table('learning_groups', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_learning_groups_id'))

    op.drop_table('learning_groups')
    with op.batch_alter_table('sso_configs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_sso_configs_id'))

    op.drop_table('sso_configs')
    with op.batch_alter_table('ai_coaching_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_coaching_sessions_id'))

    op.drop_table('ai_coaching_sessions')
    with op.batch_alter_table('users', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_users_email'))
        batch_op.drop_index(batch_op.f('ix_users_full_name'))
        batch_op.drop_index(batch_op.f('ix_users_group_id'))
        batch_op.drop_index(batch_op.f('ix_users_id'))
        batch_op.drop_index(batch_op.f('ix_users_organization_id'))
        batch_op.drop_index(batch_op.f('ix_users_role'))
        batch_op.drop_index(batch_op.f('ix_users_sso_external_id'))
        batch_op.drop_index(batch_op.f('ix_users_username'))

    op.drop_table('users')
    with op.batch_alter_table('plagiarism_checks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_plagiarism_checks_id'))
        batch_op.drop_index(batch_op.f('ix_plagiarism_checks_submission_id'))

    op.drop_table('plagiarism_checks')
    with op.batch_alter_table('achievements', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_achievements_category'))
        batch_op.drop_index(batch_op.f('ix_achievements_id'))
        batch_op.drop_index(batch_op.f('ix_achievements_name'))

    op.drop_table('achievements')
    with op.batch_alter_table('user_challenges', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_challenges_challenge_id'))
        batch_op.drop_index(batch_op.f('ix_user_challenges_id'))
        batch_op.drop_index(batch_op.f('ix_user_challenges_user_id'))

    op.drop_table('user_challenges')
    with op.batch_alter_table('cart_items', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_cart_items_cart_id'))
        batch_op.drop_index(batch_op.f('ix_cart_items_id'))

    op.drop_table('cart_items')
    with op.batch_alter_table('project_submissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_project_submissions_id'))

    op.drop_table('project_submissions')
    with op.batch_alter_table('graphotherapy_progress', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_graphotherapy_progress_id'))

    op.drop_table('graphotherapy_progress')
    with op.batch_alter_table('revenue_transactions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_revenue_transactions_course_id'))
        batch_op.drop_index(batch_op.f('ix_revenue_transactions_id'))
        batch_op.drop_index(batch_op.f('ix_revenue_transactions_instructor_id'))
        batch_op.drop_index(batch_op.f('ix_revenue_transactions_student_id'))

    op.drop_table('revenue_transactions')
    with op.batch_alter_table('mood_entries', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_mood_entries_id'))

    op.drop_table('mood_entries')
    with op.batch_alter_table('announcement_reads', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_announcement_reads_id'))

    op.drop_table('announcement_reads')
    with op.batch_alter_table('lesson_progress', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_lesson_progress_id'))
        batch_op.drop_index(batch_op.f('ix_lesson_progress_lesson_id'))
        batch_op.drop_index(batch_op.f('ix_lesson_progress_status'))
        batch_op.drop_index(batch_op.f('ix_lesson_progress_user_id'))

    op.drop_table('lesson_progress')
    with op.batch_alter_table('challenges', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_challenges_end_date'))
        batch_op.drop_index(batch_op.f('ix_challenges_id'))
        batch_op.drop_index(batch_op.f('ix_challenges_start_date'))
        batch_op.drop_index(batch_op.f('ix_challenges_type'))

    op.drop_table('challenges')
    with op.batch_alter_table('daily_reflections', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_daily_reflections_date'))
        batch_op.drop_index(batch_op.f('ix_daily_reflections_user_id'))

    op.drop_table('daily_reflections')
    op.drop_table('upsc_rubrics')
    with op.batch_alter_table('coin_transactions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_coin_transactions_created_at'))
        batch_op.drop_index(batch_op.f('ix_coin_transactions_id'))
        batch_op.drop_index(batch_op.f('ix_coin_transactions_type'))
        batch_op.drop_index(batch_op.f('ix_coin_transactions_user_id'))

    op.drop_table('coin_transactions')
    with op.batch_alter_table('quiz_attempt_analytics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_quiz_attempt_analytics_id'))

    op.drop_table('quiz_attempt_analytics')
    with op.batch_alter_table('course_payments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_course_payments_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_instamojo_payment_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_instamojo_payment_request_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_razorpay_order_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_razorpay_payment_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_stripe_checkout_session_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_stripe_customer_id'))
        batch_op.drop_index(batch_op.f('ix_course_payments_stripe_payment_intent_id'))

    op.drop_table('course_payments')
    with op.batch_alter_table('affiliate_referrals', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_affiliate_referrals_affiliate_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_referrals_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_referrals_referred_user_id'))

    op.drop_table('affiliate_referrals')
    with op.batch_alter_table('platform_analytics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_platform_analytics_date'))
        batch_op.drop_index(batch_op.f('ix_platform_analytics_id'))

    op.drop_table('platform_analytics')
    with op.batch_alter_table('question_options', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_question_options_id'))

    op.drop_table('question_options')
    with op.batch_alter_table('student_activities', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_student_activities_session_id'))
        batch_op.drop_index(batch_op.f('ix_student_activities_student_id'))
        batch_op.drop_index(batch_op.f('ix_student_activities_timestamp'))

    op.drop_table('student_activities')
    with op.batch_alter_table('user_activities', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_activities_created_at'))
        batch_op.drop_index(batch_op.f('ix_user_activities_id'))

    op.drop_table('user_activities')
    with op.batch_alter_table('quiz_attempts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_quiz_attempts_id'))

    op.drop_table('quiz_attempts')
    with op.batch_alter_table('activity_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_activity_logs_action'))
        batch_op.drop_index(batch_op.f('ix_activity_logs_id'))
        batch_op.drop_index(batch_op.f('ix_activity_logs_user_id'))

    op.drop_table('activity_logs')
    with op.batch_alter_table('live_class_poll_responses', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_class_poll_responses_id'))
        batch_op.drop_index(batch_op.f('ix_live_class_poll_responses_poll_id'))

    op.drop_table('live_class_poll_responses')
    with op.batch_alter_table('marketplace_listings', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_marketplace_listings_course_id'))
        batch_op.drop_index(batch_op.f('ix_marketplace_listings_id'))

    op.drop_table('marketplace_listings')
    with op.batch_alter_table('course_bookmarks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_course_bookmarks_id'))

    op.drop_table('course_bookmarks')
    with op.batch_alter_table('meditation_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_meditation_sessions_id'))

    op.drop_table('meditation_sessions')
    op.drop_table('drill_content')
    op.drop_table('upsc_student_profiles')
    with op.batch_alter_table('study_rooms', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_study_rooms_id'))
        batch_op.drop_index(batch_op.f('ix_study_rooms_name'))

    op.drop_table('study_rooms')
    with op.batch_alter_table('content_translations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_translations_content_id'))
        batch_op.drop_index(batch_op.f('ix_content_translations_content_type'))
        batch_op.drop_index(batch_op.f('ix_content_translations_id'))
        batch_op.drop_index(batch_op.f('ix_content_translations_language_code'))

    op.drop_table('content_translations')
    with op.batch_alter_table('question_banks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_question_banks_id'))
        batch_op.drop_index(batch_op.f('ix_question_banks_title'))

    op.drop_table('question_banks')
    with op.batch_alter_table('student_answers', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_student_answers_id'))

    op.drop_table('student_answers')
    with op.batch_alter_table('communication_templates', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_communication_templates_category'))
        batch_op.drop_index(batch_op.f('ix_communication_templates_channel'))
        batch_op.drop_index(batch_op.f('ix_communication_templates_id'))
        batch_op.drop_index(batch_op.f('ix_communication_templates_name'))

    op.drop_table('communication_templates')
    with op.batch_alter_table('affiliate_clicks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_affiliate_clicks_affiliate_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_clicks_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_clicks_referral_code'))
        batch_op.drop_index(batch_op.f('ix_affiliate_clicks_tracking_cookie'))

    op.drop_table('affiliate_clicks')
    with op.batch_alter_table('marketing_workflows', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_marketing_workflows_id'))
        batch_op.drop_index(batch_op.f('ix_marketing_workflows_name'))
        batch_op.drop_index(batch_op.f('ix_marketing_workflows_status'))

    op.drop_table('marketing_workflows')
    with op.batch_alter_table('revenue_shares', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_revenue_shares_course_id'))
        batch_op.drop_index(batch_op.f('ix_revenue_shares_id'))
        batch_op.drop_index(batch_op.f('ix_revenue_shares_instructor_id'))

    op.drop_table('revenue_shares')
    op.drop_table('group_members')
    with op.batch_alter_table('meditation_processes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_meditation_processes_id'))

    op.drop_table('meditation_processes')
    with op.batch_alter_table('assets', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_assets_filename'))
        batch_op.drop_index(batch_op.f('ix_assets_id'))

    op.drop_table('assets')
    with op.batch_alter_table('tasks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_tasks_id'))
        batch_op.drop_index(batch_op.f('ix_tasks_scheduled_date'))
        batch_op.drop_index(batch_op.f('ix_tasks_title'))
        batch_op.drop_index(batch_op.f('ix_tasks_user_id'))

    op.drop_table('tasks')
    with op.batch_alter_table('affiliate_partners', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_affiliate_partners_id'))
        batch_op.drop_index(batch_op.f('ix_affiliate_partners_referral_code'))
        batch_op.drop_index(batch_op.f('ix_affiliate_partners_user_id'))

    op.drop_table('affiliate_partners')
    with op.batch_alter_table('enrollments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_enrollments_course_id'))
        batch_op.drop_index(batch_op.f('ix_enrollments_enrolled_at'))
        batch_op.drop_index(batch_op.f('ix_enrollments_id'))
        batch_op.drop_index(batch_op.f('ix_enrollments_status'))

    op.drop_table('enrollments')
    with op.batch_alter_table('ai_avatars', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_avatars_id'))
        batch_op.drop_index(batch_op.f('ix_ai_avatars_user_id'))

    op.drop_table('ai_avatars')
    with op.batch_alter_table('assessment_rubrics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_assessment_rubrics_id'))

    op.drop_table('assessment_rubrics')
    with op.batch_alter_table('coupon_usages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_coupon_usages_id'))

    op.drop_table('coupon_usages')
    with op.batch_alter_table('learning_paths', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_learning_paths_id'))
        batch_op.drop_index(batch_op.f('ix_learning_paths_slug'))
        batch_op.drop_index(batch_op.f('ix_learning_paths_title'))

    op.drop_table('learning_paths')
    with op.batch_alter_table('path_enrollments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_path_enrollments_id'))
        batch_op.drop_index(batch_op.f('ix_path_enrollments_path_id'))
        batch_op.drop_index(batch_op.f('ix_path_enrollments_student_id'))

    op.drop_table('path_enrollments')
    with op.batch_alter_table('workflow_steps', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_workflow_steps_id'))
        batch_op.drop_index(batch_op.f('ix_workflow_steps_workflow_id'))

    op.drop_table('workflow_steps')
    with op.batch_alter_table('digital_products', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_digital_products_id'))
        batch_op.drop_index(batch_op.f('ix_digital_products_title'))

    op.drop_table('digital_products')
    with op.batch_alter_table('roles', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_roles_id'))
        batch_op.drop_index(batch_op.f('ix_roles_name'))

    op.drop_table('roles')
    with op.batch_alter_table('invoices', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_invoices_id'))
        batch_op.drop_index(batch_op.f('ix_invoices_invoice_number'))
        batch_op.drop_index(batch_op.f('ix_invoices_order_id'))

    op.drop_table('invoices')
    with op.batch_alter_table('group_post_comments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_group_post_comments_id'))

    op.drop_table('group_post_comments')
    with op.batch_alter_table('habit_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_habit_logs_date'))
        batch_op.drop_index(batch_op.f('ix_habit_logs_habit_id'))

    op.drop_table('habit_logs')
    with op.batch_alter_table('lesson_bookmarks', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_lesson_bookmarks_id'))

    op.drop_table('lesson_bookmarks')
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('lesson_bookmarks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('lesson_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('note', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('lesson_bookmarks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_lesson_bookmarks_id'), ['id'], unique=False)

    op.create_table('habit_logs',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('habit_id', sa.NUMERIC(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('completed', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['habit_id'], ['habits.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('habit_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_habit_logs_habit_id'), ['habit_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_habit_logs_date'), ['date'], unique=False)

    op.create_table('group_post_comments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('post_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['post_id'], ['group_posts.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('group_post_comments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_group_post_comments_id'), ['id'], unique=False)

    op.create_table('invoices',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('order_id', sa.INTEGER(), nullable=False),
    sa.Column('invoice_number', sa.VARCHAR(length=50), nullable=False),
    sa.Column('issued_date', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('due_date', sa.DATETIME(), nullable=True),
    sa.Column('pdf_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('pdf_generated', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('billing_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('billing_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('billing_address', sa.TEXT(), nullable=True),
    sa.Column('items_json', sa.TEXT(), nullable=True),
    sa.Column('subtotal', sa.FLOAT(), nullable=False),
    sa.Column('discount', sa.FLOAT(), nullable=False),
    sa.Column('tax', sa.FLOAT(), nullable=False),
    sa.Column('total', sa.FLOAT(), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=False),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('paid_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('invoices', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_invoices_order_id'), ['order_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_invoices_invoice_number'), ['invoice_number'], unique=1)
        batch_op.create_index(batch_op.f('ix_invoices_id'), ['id'], unique=False)

    op.create_table('roles',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=50), nullable=False),
    sa.Column('display_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('is_system_role', sa.BOOLEAN(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('roles', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_roles_name'), ['name'], unique=1)
        batch_op.create_index(batch_op.f('ix_roles_id'), ['id'], unique=False)

    op.create_table('digital_products',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('price', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('file_url', sa.VARCHAR(), nullable=False),
    sa.Column('file_type', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('sales_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('digital_products', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_digital_products_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_digital_products_id'), ['id'], unique=False)

    op.create_table('workflow_steps',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('workflow_id', sa.INTEGER(), nullable=False),
    sa.Column('order_index', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('step_type', sa.VARCHAR(), nullable=False),
    sa.Column('channel', sa.VARCHAR(), nullable=True),
    sa.Column('template_id', sa.INTEGER(), nullable=True),
    sa.Column('wait_duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('wait_until_date', sa.DATETIME(), nullable=True),
    sa.Column('wait_for_event', sa.VARCHAR(), nullable=True),
    sa.Column('condition_config', sqlite.JSON(), nullable=True),
    sa.Column('true_next_step', sa.INTEGER(), nullable=True),
    sa.Column('false_next_step', sa.INTEGER(), nullable=True),
    sa.Column('field_updates', sqlite.JSON(), nullable=True),
    sa.Column('assign_to_user_id', sa.INTEGER(), nullable=True),
    sa.Column('assign_to_team', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['assign_to_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['communication_templates.id'], ),
    sa.ForeignKeyConstraint(['workflow_id'], ['marketing_workflows.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('workflow_steps', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_workflow_steps_workflow_id'), ['workflow_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_workflow_steps_id'), ['id'], unique=False)

    op.create_table('path_enrollments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('path_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('current_course_id', sa.INTEGER(), nullable=True),
    sa.Column('completed_courses', sa.INTEGER(), nullable=True),
    sa.Column('total_courses', sa.INTEGER(), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('is_completed', sa.BOOLEAN(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('has_paid', sa.BOOLEAN(), nullable=True),
    sa.Column('payment_id', sa.INTEGER(), nullable=True),
    sa.Column('enrolled_at', sa.DATETIME(), nullable=True),
    sa.Column('last_accessed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['current_course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['path_id'], ['learning_paths.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['payment_id'], ['course_payments.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('path_enrollments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_path_enrollments_student_id'), ['student_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_path_enrollments_path_id'), ['path_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_path_enrollments_id'), ['id'], unique=False)

    op.create_table('learning_paths',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('slug', sa.VARCHAR(), nullable=True),
    sa.Column('thumbnail_url', sa.VARCHAR(), nullable=True),
    sa.Column('cover_image_url', sa.VARCHAR(), nullable=True),
    sa.Column('difficulty_level', sa.VARCHAR(), nullable=True),
    sa.Column('estimated_duration_hours', sa.INTEGER(), nullable=True),
    sa.Column('price', sa.FLOAT(), nullable=True),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('creator_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['creator_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('learning_paths', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_learning_paths_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_learning_paths_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_learning_paths_id'), ['id'], unique=False)

    op.create_table('coupon_usages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('coupon_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('payment_id', sa.INTEGER(), nullable=True),
    sa.Column('original_price', sa.FLOAT(), nullable=False),
    sa.Column('discount_amount', sa.FLOAT(), nullable=False),
    sa.Column('final_price', sa.FLOAT(), nullable=False),
    sa.Column('used_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['coupon_id'], ['coupons.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['payment_id'], ['course_payments.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('coupon_usages', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_coupon_usages_id'), ['id'], unique=False)

    op.create_table('assessment_rubrics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('question_id', sa.INTEGER(), nullable=False),
    sa.Column('criteria_name', sa.VARCHAR(), nullable=False),
    sa.Column('max_points', sa.INTEGER(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('levels', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('assessment_rubrics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_assessment_rubrics_id'), ['id'], unique=False)

    op.create_table('ai_avatars',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('purpose', sa.VARCHAR(length=50), nullable=False),
    sa.Column('personality', sa.TEXT(), nullable=True),
    sa.Column('tone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('response_style', sa.VARCHAR(length=50), nullable=True),
    sa.Column('knowledge_base', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_avatars', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_avatars_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_avatars_id'), ['id'], unique=False)

    op.create_table('enrollments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('progress_percentage', sa.FLOAT(), nullable=True),
    sa.Column('last_accessed_lesson_id', sa.INTEGER(), nullable=True),
    sa.Column('enrolled_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('last_accessed_at', sa.DATETIME(), nullable=True),
    sa.Column('payment_id', sa.INTEGER(), nullable=True),
    sa.Column('price_paid', sa.FLOAT(), nullable=True),
    sa.Column('certificate_issued', sa.BOOLEAN(), nullable=True),
    sa.Column('certificate_issued_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['last_accessed_lesson_id'], ['lessons.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('enrollments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_enrollments_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_enrollments_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_enrollments_enrolled_at'), ['enrolled_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_enrollments_course_id'), ['course_id'], unique=False)

    op.create_table('affiliate_partners',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('referral_code', sa.VARCHAR(length=50), nullable=False),
    sa.Column('custom_slug', sa.VARCHAR(length=100), nullable=True),
    sa.Column('commission_percentage', sa.NUMERIC(precision=5, scale=2), nullable=True),
    sa.Column('commission_tier', sa.VARCHAR(length=20), nullable=True),
    sa.Column('total_earnings', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('pending_earnings', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('paid_earnings', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('total_clicks', sa.INTEGER(), nullable=True),
    sa.Column('total_conversions', sa.INTEGER(), nullable=True),
    sa.Column('conversion_rate', sa.NUMERIC(precision=5, scale=2), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('is_verified', sa.BOOLEAN(), nullable=True),
    sa.Column('minimum_payout', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('payout_method', sa.VARCHAR(length=20), nullable=True),
    sa.Column('payout_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('last_click_date', sa.DATETIME(), nullable=True),
    sa.Column('last_conversion_date', sa.DATETIME(), nullable=True),
    sa.Column('last_payout_date', sa.DATETIME(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('custom_slug')
    )
    with op.batch_alter_table('affiliate_partners', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_affiliate_partners_user_id'), ['user_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_affiliate_partners_referral_code'), ['referral_code'], unique=1)
        batch_op.create_index(batch_op.f('ix_affiliate_partners_id'), ['id'], unique=False)

    op.create_table('tasks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=True),
    sa.Column('description', sa.VARCHAR(), nullable=True),
    sa.Column('task_type', sa.VARCHAR(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('is_master', sa.BOOLEAN(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('scheduled_date', sa.DATETIME(), nullable=True),
    sa.Column('is_completed', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('tasks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_tasks_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tasks_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_tasks_scheduled_date'), ['scheduled_date'], unique=False)
        batch_op.create_index(batch_op.f('ix_tasks_id'), ['id'], unique=False)

    op.create_table('assets',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('filename', sa.VARCHAR(), nullable=False),
    sa.Column('original_name', sa.VARCHAR(), nullable=False),
    sa.Column('file_type', sa.VARCHAR(), nullable=False),
    sa.Column('url', sa.VARCHAR(), nullable=False),
    sa.Column('size', sa.INTEGER(), nullable=True),
    sa.Column('mime_type', sa.VARCHAR(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('assets', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_assets_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_assets_filename'), ['filename'], unique=False)

    op.create_table('meditation_processes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('order', sa.INTEGER(), nullable=True),
    sa.Column('video_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('video_filename', sa.VARCHAR(length=255), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('level', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('announcement_audio_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('background_music_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('bell_sound_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('meditation_processes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_meditation_processes_id'), ['id'], unique=False)

    op.create_table('group_members',
    sa.Column('group_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('joined_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['group_id'], ['study_groups.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('group_id', 'user_id')
    )
    op.create_table('revenue_shares',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('platform_fee_percentage', sa.NUMERIC(precision=5, scale=2), nullable=False),
    sa.Column('instructor_percentage', sa.NUMERIC(precision=5, scale=2), nullable=False),
    sa.Column('total_revenue', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('platform_earnings', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('instructor_earnings', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('pending_payout', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('total_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('last_sale_date', sa.DATETIME(), nullable=True),
    sa.Column('last_payout_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('revenue_shares', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_revenue_shares_instructor_id'), ['instructor_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_revenue_shares_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_revenue_shares_course_id'), ['course_id'], unique=False)

    op.create_table('marketing_workflows',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('trigger_type', sa.VARCHAR(), nullable=False),
    sa.Column('trigger_config', sqlite.JSON(), nullable=True),
    sa.Column('audience_filters', sqlite.JSON(), nullable=True),
    sa.Column('allow_re_entry', sa.BOOLEAN(), nullable=True),
    sa.Column('exit_on_conversion', sa.BOOLEAN(), nullable=True),
    sa.Column('total_enrolled', sa.INTEGER(), nullable=True),
    sa.Column('total_completed', sa.INTEGER(), nullable=True),
    sa.Column('total_converted', sa.INTEGER(), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('marketing_workflows', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_marketing_workflows_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_marketing_workflows_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_marketing_workflows_id'), ['id'], unique=False)

    op.create_table('affiliate_clicks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('affiliate_id', sa.INTEGER(), nullable=False),
    sa.Column('referral_code', sa.VARCHAR(length=50), nullable=False),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.TEXT(), nullable=True),
    sa.Column('referrer_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('landing_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('tracking_cookie', sa.VARCHAR(length=100), nullable=True),
    sa.Column('cookie_expires_at', sa.DATETIME(), nullable=True),
    sa.Column('converted', sa.BOOLEAN(), nullable=True),
    sa.Column('converted_at', sa.DATETIME(), nullable=True),
    sa.Column('conversion_value', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('country', sa.VARCHAR(length=2), nullable=True),
    sa.Column('city', sa.VARCHAR(length=100), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['affiliate_id'], ['affiliate_partners.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('affiliate_clicks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_affiliate_clicks_tracking_cookie'), ['tracking_cookie'], unique=1)
        batch_op.create_index(batch_op.f('ix_affiliate_clicks_referral_code'), ['referral_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_clicks_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_clicks_affiliate_id'), ['affiliate_id'], unique=False)

    op.create_table('communication_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('channel', sa.VARCHAR(), nullable=False),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('body', sa.TEXT(), nullable=False),
    sa.Column('html_body', sa.TEXT(), nullable=True),
    sa.Column('available_tokens', sqlite.JSON(), nullable=True),
    sa.Column('media_url', sa.VARCHAR(), nullable=True),
    sa.Column('media_type', sa.VARCHAR(), nullable=True),
    sa.Column('category', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('communication_templates', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_communication_templates_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_communication_templates_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_communication_templates_channel'), ['channel'], unique=False)
        batch_op.create_index(batch_op.f('ix_communication_templates_category'), ['category'], unique=False)

    op.create_table('student_answers',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('attempt_id', sa.INTEGER(), nullable=True),
    sa.Column('question_id', sa.INTEGER(), nullable=True),
    sa.Column('selected_option_id', sa.INTEGER(), nullable=True),
    sa.Column('text_response', sa.TEXT(), nullable=True),
    sa.Column('is_correct', sa.BOOLEAN(), nullable=True),
    sa.Column('points_awarded', sa.FLOAT(), nullable=True),
    sa.Column('time_spent_seconds', sa.INTEGER(), nullable=True),
    sa.Column('submitted_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['attempt_id'], ['quiz_attempts.id'], ),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ),
    sa.ForeignKeyConstraint(['selected_option_id'], ['question_options.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('student_answers', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_student_answers_id'), ['id'], unique=False)

    op.create_table('question_banks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('category', sa.VARCHAR(length=100), nullable=True),
    sa.Column('difficulty_level', sa.VARCHAR(length=20), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('question_banks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_question_banks_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_question_banks_id'), ['id'], unique=False)

    op.create_table('content_translations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('content_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('content_id', sa.INTEGER(), nullable=False),
    sa.Column('field_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('language_code', sa.VARCHAR(length=10), nullable=False),
    sa.Column('translated_value', sa.TEXT(), nullable=False),
    sa.Column('is_machine_translated', sa.BOOLEAN(), nullable=True),
    sa.Column('translator_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('content_type', 'content_id', 'field_name', 'language_code', name=op.f('uix_content_translation'))
    )
    with op.batch_alter_table('content_translations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_content_translations_language_code'), ['language_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_translations_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_translations_content_type'), ['content_type'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_translations_content_id'), ['content_id'], unique=False)

    op.create_table('study_rooms',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=True),
    sa.Column('topic', sa.VARCHAR(), nullable=True),
    sa.Column('participants_count', sa.INTEGER(), nullable=True),
    sa.Column('thumbnail_url', sa.VARCHAR(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('study_rooms', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_study_rooms_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_study_rooms_id'), ['id'], unique=False)

    op.create_table('upsc_student_profiles',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('batch_id', sa.NUMERIC(), nullable=True),
    sa.Column('enrollment_date', sa.DATE(), nullable=False),
    sa.Column('target_year', sa.INTEGER(), nullable=True),
    sa.Column('preferred_language', sa.VARCHAR(), nullable=True),
    sa.Column('profile_data', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['batch_id'], ['upsc_batches.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('drill_content',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('question_id', sa.VARCHAR(length=36), nullable=True),
    sa.Column('title', sa.VARCHAR(length=255), nullable=False),
    sa.Column('sections', sqlite.JSON(), nullable=False),
    sa.Column('estimated_reading_time', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['drill_questions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('question_id')
    )
    op.create_table('meditation_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('minutes_listened', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('meditation_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_meditation_sessions_id'), ['id'], unique=False)

    op.create_table('course_bookmarks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('note', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('course_bookmarks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_course_bookmarks_id'), ['id'], unique=False)

    op.create_table('marketplace_listings',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('is_promoted', sa.BOOLEAN(), nullable=True),
    sa.Column('marketplace_category', sa.VARCHAR(length=100), nullable=True),
    sa.Column('target_audience', sa.VARCHAR(length=255), nullable=True),
    sa.Column('learning_outcomes', sa.TEXT(), nullable=True),
    sa.Column('prerequisites', sa.TEXT(), nullable=True),
    sa.Column('seo_title', sa.VARCHAR(length=255), nullable=True),
    sa.Column('seo_description', sa.TEXT(), nullable=True),
    sa.Column('seo_keywords', sa.TEXT(), nullable=True),
    sa.Column('featured_until', sa.DATETIME(), nullable=True),
    sa.Column('promotion_start', sa.DATETIME(), nullable=True),
    sa.Column('promotion_end', sa.DATETIME(), nullable=True),
    sa.Column('view_count', sa.INTEGER(), nullable=True),
    sa.Column('click_count', sa.INTEGER(), nullable=True),
    sa.Column('conversion_rate', sa.NUMERIC(precision=5, scale=2), nullable=True),
    sa.Column('quality_score', sa.NUMERIC(precision=3, scale=2), nullable=True),
    sa.Column('marketplace_rank', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('marketplace_listings', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_marketplace_listings_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_marketplace_listings_course_id'), ['course_id'], unique=1)

    op.create_table('live_class_poll_responses',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('poll_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('selected_option_index', sa.INTEGER(), nullable=False),
    sa.Column('responded_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['poll_id'], ['live_class_polls.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_class_poll_responses', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_class_poll_responses_poll_id'), ['poll_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_poll_responses_id'), ['id'], unique=False)

    op.create_table('activity_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('action', sa.VARCHAR(), nullable=True),
    sa.Column('details', sa.VARCHAR(), nullable=True),
    sa.Column('timestamp', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('activity_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_activity_logs_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_activity_logs_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_activity_logs_action'), ['action'], unique=False)

    op.create_table('quiz_attempts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('quiz_id', sa.INTEGER(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('score', sa.FLOAT(), nullable=True),
    sa.Column('passed', sa.BOOLEAN(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['quiz_id'], ['quizzes.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('quiz_attempts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_quiz_attempts_id'), ['id'], unique=False)

    op.create_table('user_activities',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('activity_type', sa.VARCHAR(), nullable=False),
    sa.Column('target_type', sa.VARCHAR(), nullable=False),
    sa.Column('target_id', sa.INTEGER(), nullable=False),
    sa.Column('meta_data', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_activities', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_activities_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_activities_created_at'), ['created_at'], unique=False)

    op.create_table('student_activities',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('session_id', sa.VARCHAR(length=36), nullable=True),
    sa.Column('activity_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('activity_data', sqlite.JSON(), nullable=True),
    sa.Column('timestamp', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['drill_sessions.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('student_activities', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_student_activities_timestamp'), ['timestamp'], unique=False)
        batch_op.create_index(batch_op.f('ix_student_activities_student_id'), ['student_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_student_activities_session_id'), ['session_id'], unique=False)

    op.create_table('question_options',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('question_id', sa.INTEGER(), nullable=True),
    sa.Column('text', sa.TEXT(), nullable=False),
    sa.Column('is_correct', sa.BOOLEAN(), nullable=True),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('match_text', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('question_options', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_question_options_id'), ['id'], unique=False)

    op.create_table('platform_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('total_users', sa.INTEGER(), nullable=True),
    sa.Column('active_users', sa.INTEGER(), nullable=True),
    sa.Column('new_users', sa.INTEGER(), nullable=True),
    sa.Column('dau', sa.INTEGER(), nullable=True),
    sa.Column('mau', sa.INTEGER(), nullable=True),
    sa.Column('wau', sa.INTEGER(), nullable=True),
    sa.Column('total_students', sa.INTEGER(), nullable=True),
    sa.Column('total_instructors', sa.INTEGER(), nullable=True),
    sa.Column('new_students', sa.INTEGER(), nullable=True),
    sa.Column('new_instructors', sa.INTEGER(), nullable=True),
    sa.Column('total_courses', sa.INTEGER(), nullable=True),
    sa.Column('active_courses', sa.INTEGER(), nullable=True),
    sa.Column('published_courses', sa.INTEGER(), nullable=True),
    sa.Column('new_courses', sa.INTEGER(), nullable=True),
    sa.Column('total_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('enrollments_today', sa.INTEGER(), nullable=True),
    sa.Column('active_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('completions_today', sa.INTEGER(), nullable=True),
    sa.Column('total_completions', sa.INTEGER(), nullable=True),
    sa.Column('revenue_today', sa.FLOAT(), nullable=True),
    sa.Column('revenue_mtd', sa.FLOAT(), nullable=True),
    sa.Column('total_revenue', sa.FLOAT(), nullable=True),
    sa.Column('mrr', sa.FLOAT(), nullable=True),
    sa.Column('arr', sa.FLOAT(), nullable=True),
    sa.Column('quiz_attempts', sa.INTEGER(), nullable=True),
    sa.Column('assignments_submitted', sa.INTEGER(), nullable=True),
    sa.Column('discussion_posts', sa.INTEGER(), nullable=True),
    sa.Column('live_class_attendees', sa.INTEGER(), nullable=True),
    sa.Column('certificates_issued', sa.INTEGER(), nullable=True),
    sa.Column('total_lessons', sa.INTEGER(), nullable=True),
    sa.Column('total_quizzes', sa.INTEGER(), nullable=True),
    sa.Column('total_assignments', sa.INTEGER(), nullable=True),
    sa.Column('video_hours_watched', sa.FLOAT(), nullable=True),
    sa.Column('avg_response_time', sa.FLOAT(), nullable=True),
    sa.Column('error_rate', sa.FLOAT(), nullable=True),
    sa.Column('uptime', sa.FLOAT(), nullable=True),
    sa.Column('avg_course_rating', sa.FLOAT(), nullable=True),
    sa.Column('total_reviews', sa.INTEGER(), nullable=True),
    sa.Column('new_reviews', sa.INTEGER(), nullable=True),
    sa.Column('user_growth_rate', sa.FLOAT(), nullable=True),
    sa.Column('revenue_growth_rate', sa.FLOAT(), nullable=True),
    sa.Column('enrollment_growth_rate', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('platform_analytics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_platform_analytics_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_platform_analytics_date'), ['date'], unique=1)

    op.create_table('affiliate_referrals',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('affiliate_id', sa.INTEGER(), nullable=False),
    sa.Column('referred_user_id', sa.INTEGER(), nullable=False),
    sa.Column('referral_code', sa.VARCHAR(length=50), nullable=False),
    sa.Column('tracking_cookie', sa.VARCHAR(length=100), nullable=True),
    sa.Column('purchase_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('purchase_id', sa.INTEGER(), nullable=False),
    sa.Column('purchase_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('commission_percentage', sa.NUMERIC(precision=5, scale=2), nullable=False),
    sa.Column('commission_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('commission_status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('payment_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('first_click_date', sa.DATETIME(), nullable=True),
    sa.Column('conversion_date', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('is_refunded', sa.BOOLEAN(), nullable=True),
    sa.Column('refunded_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['affiliate_id'], ['affiliate_partners.id'], ),
    sa.ForeignKeyConstraint(['referred_user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('affiliate_referrals', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_affiliate_referrals_referred_user_id'), ['referred_user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_referrals_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_referrals_affiliate_id'), ['affiliate_id'], unique=False)

    op.create_table('course_payments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('enrollment_id', sa.INTEGER(), nullable=True),
    sa.Column('amount', sa.FLOAT(), nullable=False),
    sa.Column('currency', sa.VARCHAR(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=False),
    sa.Column('payment_provider', sa.VARCHAR(), nullable=False),
    sa.Column('stripe_payment_intent_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_checkout_session_id', sa.VARCHAR(), nullable=True),
    sa.Column('stripe_customer_id', sa.VARCHAR(), nullable=True),
    sa.Column('razorpay_order_id', sa.VARCHAR(), nullable=True),
    sa.Column('razorpay_payment_id', sa.VARCHAR(), nullable=True),
    sa.Column('razorpay_signature', sa.VARCHAR(), nullable=True),
    sa.Column('instamojo_payment_request_id', sa.VARCHAR(), nullable=True),
    sa.Column('instamojo_payment_id', sa.VARCHAR(), nullable=True),
    sa.Column('payment_method', sa.VARCHAR(), nullable=True),
    sa.Column('failure_reason', sa.TEXT(), nullable=True),
    sa.Column('refund_reason', sa.TEXT(), nullable=True),
    sa.Column('refunded_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('succeeded_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['enrollment_id'], ['enrollments.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('course_payments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_course_payments_stripe_payment_intent_id'), ['stripe_payment_intent_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_payments_stripe_customer_id'), ['stripe_customer_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_course_payments_stripe_checkout_session_id'), ['stripe_checkout_session_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_payments_razorpay_payment_id'), ['razorpay_payment_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_payments_razorpay_order_id'), ['razorpay_order_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_payments_instamojo_payment_request_id'), ['instamojo_payment_request_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_payments_instamojo_payment_id'), ['instamojo_payment_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_payments_id'), ['id'], unique=False)

    op.create_table('quiz_attempt_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('attempt_id', sa.INTEGER(), nullable=True),
    sa.Column('time_spent_seconds', sa.INTEGER(), nullable=True),
    sa.Column('average_time_per_question', sa.FLOAT(), nullable=True),
    sa.Column('questions_answered', sa.INTEGER(), nullable=True),
    sa.Column('questions_correct', sa.INTEGER(), nullable=True),
    sa.Column('questions_incorrect', sa.INTEGER(), nullable=True),
    sa.Column('questions_skipped', sa.INTEGER(), nullable=True),
    sa.Column('questions_reviewed', sa.INTEGER(), nullable=True),
    sa.Column('difficulty_rating', sa.FLOAT(), nullable=True),
    sa.Column('confidence_score', sa.FLOAT(), nullable=True),
    sa.Column('times_backtracked', sa.INTEGER(), nullable=True),
    sa.Column('hints_used', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['attempt_id'], ['quiz_attempts.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('attempt_id')
    )
    with op.batch_alter_table('quiz_attempt_analytics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_quiz_attempt_analytics_id'), ['id'], unique=False)

    op.create_table('coin_transactions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('amount', sa.INTEGER(), nullable=False),
    sa.Column('type', sa.VARCHAR(length=16), nullable=False),
    sa.Column('reason', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('reference_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('reference_id', sa.INTEGER(), nullable=True),
    sa.Column('balance_after', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('coin_transactions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_coin_transactions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_coin_transactions_type'), ['type'], unique=False)
        batch_op.create_index(batch_op.f('ix_coin_transactions_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_coin_transactions_created_at'), ['created_at'], unique=False)

    op.create_table('upsc_rubrics',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('batch_id', sa.NUMERIC(), nullable=True),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('rubric_data', sqlite.JSON(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['batch_id'], ['upsc_batches.id'], ),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('daily_reflections',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('user_id', sa.NUMERIC(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('daily_reflections', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_daily_reflections_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_daily_reflections_date'), ['date'], unique=False)

    op.create_table('challenges',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('type', sa.VARCHAR(length=7), nullable=False),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=False),
    sa.Column('requirement', sqlite.JSON(), nullable=False),
    sa.Column('reward_coins', sa.INTEGER(), nullable=True),
    sa.Column('reward_achievement_id', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('difficulty', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['reward_achievement_id'], ['achievements.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('challenges', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_challenges_type'), ['type'], unique=False)
        batch_op.create_index(batch_op.f('ix_challenges_start_date'), ['start_date'], unique=False)
        batch_op.create_index(batch_op.f('ix_challenges_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_challenges_end_date'), ['end_date'], unique=False)

    op.create_table('lesson_progress',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('lesson_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=11), nullable=True),
    sa.Column('time_spent_seconds', sa.INTEGER(), nullable=True),
    sa.Column('first_accessed_at', sa.DATETIME(), nullable=True),
    sa.Column('last_accessed_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('video_progress_seconds', sa.INTEGER(), nullable=True),
    sa.Column('video_completed_percentage', sa.FLOAT(), nullable=True),
    sa.Column('result_data', sqlite.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('lesson_progress', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_lesson_progress_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_lesson_progress_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_lesson_progress_lesson_id'), ['lesson_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_lesson_progress_id'), ['id'], unique=False)

    op.create_table('announcement_reads',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('announcement_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('read_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['announcement_id'], ['course_announcements.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('announcement_reads', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_announcement_reads_id'), ['id'], unique=False)

    op.create_table('mood_entries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('mood', sa.VARCHAR(), nullable=True),
    sa.Column('note', sa.VARCHAR(), nullable=True),
    sa.Column('timestamp', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('mood_entries', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_mood_entries_id'), ['id'], unique=False)

    op.create_table('revenue_transactions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('transaction_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('total_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('platform_fee', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('instructor_earnings', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('payment_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_payment_intent', sa.VARCHAR(length=100), nullable=True),
    sa.Column('is_refunded', sa.BOOLEAN(), nullable=True),
    sa.Column('refunded_at', sa.DATETIME(), nullable=True),
    sa.Column('refund_amount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('coupon_code', sa.VARCHAR(length=50), nullable=True),
    sa.Column('discount_amount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('affiliate_id', sa.INTEGER(), nullable=True),
    sa.Column('affiliate_commission', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['affiliate_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('revenue_transactions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_revenue_transactions_student_id'), ['student_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_revenue_transactions_instructor_id'), ['instructor_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_revenue_transactions_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_revenue_transactions_course_id'), ['course_id'], unique=False)

    op.create_table('graphotherapy_progress',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('current_level', sa.INTEGER(), nullable=True),
    sa.Column('current_day', sa.INTEGER(), nullable=True),
    sa.Column('total_streak', sa.INTEGER(), nullable=True),
    sa.Column('last_practice_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('graphotherapy_progress', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_graphotherapy_progress_id'), ['id'], unique=False)

    op.create_table('project_submissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('project_id', sa.INTEGER(), nullable=False),
    sa.Column('team_id', sa.INTEGER(), nullable=False),
    sa.Column('file_url', sa.VARCHAR(), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('submitted_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('grade', sa.FLOAT(), nullable=True),
    sa.Column('feedback', sa.TEXT(), nullable=True),
    sa.Column('graded_by', sa.INTEGER(), nullable=True),
    sa.Column('graded_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['graded_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['project_id'], ['collaborative_projects.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['team_id'], ['project_teams.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('project_submissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_project_submissions_id'), ['id'], unique=False)

    op.create_table('cart_items',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('cart_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('bundle_id', sa.INTEGER(), nullable=True),
    sa.Column('quantity', sa.INTEGER(), nullable=False),
    sa.Column('unit_price', sa.FLOAT(), nullable=False),
    sa.Column('coupon_id', sa.INTEGER(), nullable=True),
    sa.Column('discount_amount', sa.FLOAT(), nullable=True),
    sa.Column('added_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['bundle_id'], ['course_bundles.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['cart_id'], ['shopping_carts.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['coupon_id'], ['coupons.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('cart_items', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_cart_items_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_cart_items_cart_id'), ['cart_id'], unique=False)

    op.create_table('user_challenges',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('challenge_id', sa.INTEGER(), nullable=False),
    sa.Column('progress_data', sqlite.JSON(), nullable=True),
    sa.Column('progress_percentage', sa.INTEGER(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('reward_claimed', sa.BOOLEAN(), nullable=True),
    sa.Column('claimed_at', sa.DATETIME(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['challenge_id'], ['challenges.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_challenges', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_challenges_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_challenges_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_challenges_challenge_id'), ['challenge_id'], unique=False)

    op.create_table('achievements',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=False),
    sa.Column('category', sa.VARCHAR(length=9), nullable=False),
    sa.Column('rarity', sa.VARCHAR(length=9), nullable=True),
    sa.Column('icon', sa.VARCHAR(length=50), nullable=True),
    sa.Column('coin_reward', sa.INTEGER(), nullable=True),
    sa.Column('unlock_condition', sqlite.JSON(), nullable=False),
    sa.Column('is_hidden', sa.BOOLEAN(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('display_order', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('achievements', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_achievements_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_achievements_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_achievements_category'), ['category'], unique=False)

    op.create_table('plagiarism_checks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('submission_id', sa.INTEGER(), nullable=False),
    sa.Column('assignment_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('similarity_percentage', sa.FLOAT(), nullable=False),
    sa.Column('originality_score', sa.FLOAT(), nullable=False),
    sa.Column('matches', sqlite.JSON(), nullable=True),
    sa.Column('is_plagiarized', sa.BOOLEAN(), nullable=True),
    sa.Column('review_required', sa.BOOLEAN(), nullable=True),
    sa.Column('reviewed_by_instructor', sa.BOOLEAN(), nullable=True),
    sa.Column('instructor_notes', sa.TEXT(), nullable=True),
    sa.Column('check_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('checked_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['assignment_id'], ['assignments.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['submission_id'], ['submissions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('plagiarism_checks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_plagiarism_checks_submission_id'), ['submission_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_plagiarism_checks_id'), ['id'], unique=False)

    op.create_table('users',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('email', sa.VARCHAR(), nullable=True),
    sa.Column('username', sa.VARCHAR(), nullable=True),
    sa.Column('hashed_password', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_superuser', sa.BOOLEAN(), nullable=True),
    sa.Column('full_name', sa.VARCHAR(), nullable=True),
    sa.Column('coins', sa.INTEGER(), nullable=True),
    sa.Column('streak_days', sa.INTEGER(), nullable=True),
    sa.Column('token_version', sa.INTEGER(), nullable=True),
    sa.Column('group_id', sa.INTEGER(), nullable=True),
    sa.Column('role', sa.VARCHAR(), nullable=True),
    sa.Column('last_login', sa.DATETIME(), nullable=True),
    sa.Column('is_banned', sa.BOOLEAN(), nullable=True),
    sa.Column('email_notifications', sa.BOOLEAN(), nullable=True),
    sa.Column('is_premium', sa.BOOLEAN(), nullable=True),
    sa.Column('stripe_customer_id', sa.VARCHAR(), nullable=True),
    sa.Column('subscription_status', sa.VARCHAR(), nullable=True),
    sa.Column('organization_id', sa.INTEGER(), nullable=True),
    sa.Column('is_sso_user', sa.BOOLEAN(), nullable=True),
    sa.Column('sso_external_id', sa.VARCHAR(), nullable=True),
    sa.Column('is_verified', sa.BOOLEAN(), nullable=True),
    sa.Column('is_approved', sa.BOOLEAN(), server_default=sa.text('1'), nullable=True),
    sa.ForeignKeyConstraint(['group_id'], ['groups.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('users', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_users_username'), ['username'], unique=1)
        batch_op.create_index(batch_op.f('ix_users_sso_external_id'), ['sso_external_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_role'), ['role'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_organization_id'), ['organization_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_group_id'), ['group_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_full_name'), ['full_name'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_email'), ['email'], unique=1)

    op.create_table('ai_coaching_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('topic', sa.VARCHAR(), nullable=False),
    sa.Column('context_data', sqlite.JSON(), nullable=True),
    sa.Column('messages', sqlite.JSON(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_coaching_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_coaching_sessions_id'), ['id'], unique=False)

    op.create_table('sso_configs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=False),
    sa.Column('provider_type', sa.VARCHAR(length=5), nullable=False),
    sa.Column('provider_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('entity_id', sa.VARCHAR(length=500), nullable=True),
    sa.Column('idp_entity_id', sa.VARCHAR(length=500), nullable=True),
    sa.Column('sso_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('slo_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('x509_cert', sa.TEXT(), nullable=True),
    sa.Column('certificate_expires_at', sa.DATETIME(), nullable=True),
    sa.Column('client_id', sa.VARCHAR(length=500), nullable=True),
    sa.Column('client_secret', sa.VARCHAR(length=500), nullable=True),
    sa.Column('authorization_endpoint', sa.VARCHAR(length=500), nullable=True),
    sa.Column('token_endpoint', sa.VARCHAR(length=500), nullable=True),
    sa.Column('userinfo_endpoint', sa.VARCHAR(length=500), nullable=True),
    sa.Column('scopes', sqlite.JSON(), nullable=True),
    sa.Column('attribute_mapping', sqlite.JSON(), nullable=True),
    sa.Column('role_mapping', sqlite.JSON(), nullable=True),
    sa.Column('settings', sqlite.JSON(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('jit_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('auto_assign_roles', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_tested_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('sso_configs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_sso_configs_id'), ['id'], unique=False)

    op.create_table('learning_groups',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('group_type', sa.VARCHAR(length=12), nullable=True),
    sa.Column('privacy', sa.VARCHAR(length=11), nullable=True),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('max_members', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('learning_groups', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_learning_groups_id'), ['id'], unique=False)

    op.create_table('quiz_question_pools',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('quiz_id', sa.INTEGER(), nullable=False),
    sa.Column('question_bank_id', sa.INTEGER(), nullable=False),
    sa.Column('num_questions', sa.INTEGER(), nullable=False),
    sa.Column('difficulty_filter', sa.VARCHAR(length=20), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['question_bank_id'], ['question_banks.id'], ),
    sa.ForeignKeyConstraint(['quiz_id'], ['quizzes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('quiz_question_pools', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_quiz_question_pools_id'), ['id'], unique=False)

    op.create_table('shadow_mode_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('day_number', sa.INTEGER(), nullable=True),
    sa.Column('start_time', sa.DATETIME(), nullable=True),
    sa.Column('end_time', sa.DATETIME(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('goals_completed', sa.INTEGER(), nullable=True),
    sa.Column('total_goals', sa.INTEGER(), nullable=True),
    sa.Column('focus_score', sa.FLOAT(), nullable=True),
    sa.Column('notes', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('shadow_mode_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_shadow_mode_sessions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_shadow_mode_sessions_id'), ['id'], unique=False)

    op.create_table('discussion_posts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('thread_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('parent_post_id', sa.INTEGER(), nullable=True),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('is_answer', sa.BOOLEAN(), nullable=True),
    sa.Column('is_edited', sa.BOOLEAN(), nullable=True),
    sa.Column('upvotes', sa.INTEGER(), nullable=True),
    sa.Column('downvotes', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['parent_post_id'], ['discussion_posts.id'], ),
    sa.ForeignKeyConstraint(['thread_id'], ['discussion_threads.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('discussion_posts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_discussion_posts_id'), ['id'], unique=False)

    op.create_table('tax_rates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('country_code', sa.VARCHAR(length=2), nullable=False),
    sa.Column('state_code', sa.VARCHAR(length=10), nullable=True),
    sa.Column('region_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('tax_name', sa.VARCHAR(length=50), nullable=False),
    sa.Column('tax_rate', sa.NUMERIC(precision=5, scale=4), nullable=False),
    sa.Column('tax_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('applies_to_digital_goods', sa.BOOLEAN(), nullable=True),
    sa.Column('applies_to_physical_goods', sa.BOOLEAN(), nullable=True),
    sa.Column('applies_to_services', sa.BOOLEAN(), nullable=True),
    sa.Column('applies_to_subscriptions', sa.BOOLEAN(), nullable=True),
    sa.Column('is_compound', sa.BOOLEAN(), nullable=True),
    sa.Column('compound_order', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('effective_from', sa.DATETIME(), nullable=True),
    sa.Column('effective_until', sa.DATETIME(), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('tax_id_required', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('tax_rates', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_tax_rates_state_code'), ['state_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_rates_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_rates_country_code'), ['country_code'], unique=False)

    op.create_table('admin_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('admin_id', sa.INTEGER(), nullable=True),
    sa.Column('action', sa.VARCHAR(), nullable=False),
    sa.Column('target_type', sa.VARCHAR(), nullable=True),
    sa.Column('target_id', sa.INTEGER(), nullable=True),
    sa.Column('details', sa.TEXT(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['admin_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('admin_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_admin_logs_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_admin_logs_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_admin_logs_admin_id'), ['admin_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_admin_logs_action'), ['action'], unique=False)

    op.create_table('sso_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=False),
    sa.Column('session_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('provider_session_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('name_id', sa.VARCHAR(length=500), nullable=True),
    sa.Column('provider_type', sa.VARCHAR(length=5), nullable=False),
    sa.Column('login_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=50), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=False),
    sa.Column('last_activity_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('logged_out_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('sso_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_sso_sessions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_sso_sessions_session_id'), ['session_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_sso_sessions_provider_session_id'), ['provider_session_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_sso_sessions_id'), ['id'], unique=False)

    op.create_table('coupons',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('code', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('discount_type', sa.VARCHAR(), nullable=False),
    sa.Column('discount_value', sa.FLOAT(), nullable=False),
    sa.Column('min_purchase_amount', sa.FLOAT(), nullable=True),
    sa.Column('max_discount_amount', sa.FLOAT(), nullable=True),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('category_id', sa.INTEGER(), nullable=True),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('usage_limit', sa.INTEGER(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=False),
    sa.Column('usage_per_user_limit', sa.INTEGER(), nullable=False),
    sa.Column('valid_from', sa.DATETIME(), nullable=False),
    sa.Column('valid_until', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['category_id'], ['categories.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('coupons', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_coupons_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_coupons_code'), ['code'], unique=1)

    op.create_table('review_helpful',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('review_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['review_id'], ['course_reviews.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('review_helpful', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_review_helpful_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_review_helpful_review_id'), ['review_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_review_helpful_id'), ['id'], unique=False)

    op.create_table('workflow_executions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('workflow_id', sa.INTEGER(), nullable=False),
    sa.Column('lead_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('current_step_id', sa.INTEGER(), nullable=True),
    sa.Column('started_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('next_action_at', sa.DATETIME(), nullable=True),
    sa.Column('execution_log', sqlite.JSON(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['current_step_id'], ['workflow_steps.id'], ),
    sa.ForeignKeyConstraint(['lead_id'], ['leads.id'], ),
    sa.ForeignKeyConstraint(['workflow_id'], ['marketing_workflows.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('workflow_executions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_workflow_executions_workflow_id'), ['workflow_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_workflow_executions_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_workflow_executions_lead_id'), ['lead_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_workflow_executions_id'), ['id'], unique=False)

    op.create_table('translations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('key', sa.VARCHAR(length=255), nullable=False),
    sa.Column('language_code', sa.VARCHAR(length=10), nullable=False),
    sa.Column('value', sa.TEXT(), nullable=False),
    sa.Column('namespace', sa.VARCHAR(length=100), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('is_html', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('key', 'language_code', 'namespace', name=op.f('uix_translation_key_lang_ns'))
    )
    with op.batch_alter_table('translations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_translations_namespace'), ['namespace'], unique=False)
        batch_op.create_index(batch_op.f('ix_translations_language_code'), ['language_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_translations_key'), ['key'], unique=False)
        batch_op.create_index(batch_op.f('ix_translations_id'), ['id'], unique=False)

    op.create_table('course_recommendations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('score', sa.FLOAT(), nullable=False),
    sa.Column('reason', sa.VARCHAR(), nullable=True),
    sa.Column('algorithm', sa.VARCHAR(), nullable=False),
    sa.Column('meta_data', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked', sa.DATETIME(), nullable=True),
    sa.Column('enrolled', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('course_recommendations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_course_recommendations_id'), ['id'], unique=False)

    op.create_table('habits',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('user_id', sa.NUMERIC(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('habits', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_habits_user_id'), ['user_id'], unique=False)

    op.create_table('subscription_plans',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('slug', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('short_description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('monthly_price', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('yearly_price', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('trial_days', sa.INTEGER(), nullable=True),
    sa.Column('access_level', sa.VARCHAR(length=20), nullable=True),
    sa.Column('max_courses', sa.INTEGER(), nullable=True),
    sa.Column('max_live_classes', sa.INTEGER(), nullable=True),
    sa.Column('features', sa.TEXT(), nullable=True),
    sa.Column('included_features', sa.TEXT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('is_popular', sa.BOOLEAN(), nullable=True),
    sa.Column('display_order', sa.INTEGER(), nullable=True),
    sa.Column('stripe_price_id_monthly', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_price_id_yearly', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_product_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('total_subscriptions', sa.INTEGER(), nullable=True),
    sa.Column('active_subscriptions', sa.INTEGER(), nullable=True),
    sa.Column('total_revenue', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    with op.batch_alter_table('subscription_plans', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_subscription_plans_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_subscription_plans_id'), ['id'], unique=False)

    op.create_table('upsc_questions',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('plan_id', sa.NUMERIC(), nullable=True),
    sa.Column('question_number', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('question_text', sa.TEXT(), nullable=False),
    sa.Column('marks', sa.INTEGER(), nullable=False),
    sa.Column('subject', sa.VARCHAR(), nullable=False),
    sa.Column('topic', sa.VARCHAR(), nullable=True),
    sa.Column('microtopics', sqlite.JSON(), nullable=False),
    sa.Column('keywords', sqlite.JSON(), nullable=True),
    sa.Column('pyq_reference', sa.VARCHAR(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['plan_id'], ['upsc_plans.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('lesson_drip_settings',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('lesson_id', sa.INTEGER(), nullable=False),
    sa.Column('unlock_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('unlock_date', sa.DATETIME(), nullable=True),
    sa.Column('unlock_after_days', sa.INTEGER(), nullable=True),
    sa.Column('prerequisite_lesson_id', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['prerequisite_lesson_id'], ['lessons.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('lesson_id')
    )
    with op.batch_alter_table('lesson_drip_settings', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_lesson_drip_settings_id'), ['id'], unique=False)

    op.create_table('submissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('assignment_id', sa.INTEGER(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('submitted_files', sqlite.JSON(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('grade', sa.FLOAT(), nullable=True),
    sa.Column('feedback', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('submitted_at', sa.DATETIME(), nullable=True),
    sa.Column('graded_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['assignment_id'], ['assignments.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('submissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_submissions_id'), ['id'], unique=False)

    op.create_table('course_bundle_items',
    sa.Column('bundle_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['bundle_id'], ['course_bundles.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('bundle_id', 'course_id')
    )
    op.create_table('permissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('display_name', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('resource', sa.VARCHAR(length=50), nullable=False),
    sa.Column('action', sa.VARCHAR(length=50), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('permissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_permissions_resource'), ['resource'], unique=False)
        batch_op.create_index(batch_op.f('ix_permissions_name'), ['name'], unique=1)
        batch_op.create_index(batch_op.f('ix_permissions_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_permissions_action'), ['action'], unique=False)

    op.create_table('ai_usage_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('feature', sa.VARCHAR(length=50), nullable=False),
    sa.Column('model_used', sa.VARCHAR(length=50), nullable=False),
    sa.Column('tokens_used', sa.INTEGER(), nullable=False),
    sa.Column('estimated_cost', sa.FLOAT(), nullable=False),
    sa.Column('request_data', sqlite.JSON(), nullable=True),
    sa.Column('response_time', sa.FLOAT(), nullable=True),
    sa.Column('success', sa.BOOLEAN(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_usage_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_feature'), ['feature'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_created_at'), ['created_at'], unique=False)

    op.create_table('notifications',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('message', sa.TEXT(), nullable=False),
    sa.Column('data', sqlite.JSON(), nullable=True),
    sa.Column('action_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('priority', sa.VARCHAR(length=6), nullable=True),
    sa.Column('is_read', sa.BOOLEAN(), nullable=True),
    sa.Column('read_at', sa.DATETIME(), nullable=True),
    sa.Column('delivered_realtime', sa.BOOLEAN(), nullable=True),
    sa.Column('delivered_push', sa.BOOLEAN(), nullable=True),
    sa.Column('delivered_email', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('notifications', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_notifications_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_type'), ['type'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_priority'), ['priority'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_is_read'), ['is_read'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_created_at'), ['created_at'], unique=False)

    op.create_table('enquiries',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=True),
    sa.Column('email', sa.VARCHAR(), nullable=False),
    sa.Column('subject', sa.VARCHAR(), nullable=False),
    sa.Column('message', sa.TEXT(), nullable=False),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('enquiries', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_enquiries_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_enquiries_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_enquiries_email'), ['email'], unique=False)

    op.create_table('question_bank_questions',
    sa.Column('question_bank_id', sa.INTEGER(), nullable=False),
    sa.Column('question_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['question_bank_id'], ['question_banks.id'], ),
    sa.ForeignKeyConstraint(['question_id'], ['bank_questions.id'], ),
    sa.PrimaryKeyConstraint('question_bank_id', 'question_id')
    )
    op.create_table('live_class_reactions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('live_class_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('reaction_type', sa.VARCHAR(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['live_class_id'], ['live_classes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_class_reactions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_class_reactions_live_class_id'), ['live_class_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_reactions_id'), ['id'], unique=False)

    op.create_table('curriculum_insights',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('gs_paper', sa.VARCHAR(length=10), nullable=True),
    sa.Column('total_students', sa.INTEGER(), nullable=True),
    sa.Column('average_score', sa.FLOAT(), nullable=True),
    sa.Column('common_challenges', sqlite.JSON(), nullable=True),
    sa.Column('high_performing_topics', sqlite.JSON(), nullable=True),
    sa.Column('low_performing_topics', sqlite.JSON(), nullable=True),
    sa.Column('ai_recommendations', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('curriculum_insights', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_curriculum_insights_gs_paper'), ['gs_paper'], unique=False)
        batch_op.create_index(batch_op.f('ix_curriculum_insights_date'), ['date'], unique=False)

    op.create_table('study_groups',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('creator_id', sa.INTEGER(), nullable=False),
    sa.Column('is_private', sa.BOOLEAN(), nullable=True),
    sa.Column('max_members', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['creator_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('study_groups', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_study_groups_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_study_groups_id'), ['id'], unique=False)

    op.create_table('languages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('code', sa.VARCHAR(length=10), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('native_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('is_rtl', sa.BOOLEAN(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('flag_emoji', sa.VARCHAR(length=10), nullable=True),
    sa.Column('sort_order', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('languages', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_languages_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_languages_code'), ['code'], unique=1)

    op.create_table('rewards',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=True),
    sa.Column('description', sa.VARCHAR(), nullable=True),
    sa.Column('cost', sa.INTEGER(), nullable=True),
    sa.Column('type', sa.VARCHAR(), nullable=True),
    sa.Column('image_url', sa.VARCHAR(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('rewards', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_rewards_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_rewards_id'), ['id'], unique=False)

    op.create_table('student_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('preferred_time_slot', sa.VARCHAR(length=20), nullable=True),
    sa.Column('avg_session_duration', sa.FLOAT(), nullable=True),
    sa.Column('total_time_spent', sa.INTEGER(), nullable=True),
    sa.Column('sessions_count', sa.INTEGER(), nullable=True),
    sa.Column('last_active', sa.DATETIME(), nullable=True),
    sa.Column('video_completion_rate', sa.FLOAT(), nullable=True),
    sa.Column('reading_completion_rate', sa.FLOAT(), nullable=True),
    sa.Column('quiz_preference', sa.FLOAT(), nullable=True),
    sa.Column('discussion_engagement', sa.FLOAT(), nullable=True),
    sa.Column('completion_rate', sa.FLOAT(), nullable=True),
    sa.Column('avg_quiz_score', sa.FLOAT(), nullable=True),
    sa.Column('quiz_attempts', sa.INTEGER(), nullable=True),
    sa.Column('assignments_completed', sa.INTEGER(), nullable=True),
    sa.Column('avg_assignment_score', sa.FLOAT(), nullable=True),
    sa.Column('discussion_posts', sa.INTEGER(), nullable=True),
    sa.Column('questions_asked', sa.INTEGER(), nullable=True),
    sa.Column('peer_reviews_given', sa.INTEGER(), nullable=True),
    sa.Column('notes_created', sa.INTEGER(), nullable=True),
    sa.Column('bookmarks_created', sa.INTEGER(), nullable=True),
    sa.Column('estimated_completion_date', sa.DATE(), nullable=True),
    sa.Column('estimated_days_to_complete', sa.INTEGER(), nullable=True),
    sa.Column('at_risk_flag', sa.BOOLEAN(), nullable=True),
    sa.Column('engagement_score', sa.FLOAT(), nullable=True),
    sa.Column('progress_percentile', sa.FLOAT(), nullable=True),
    sa.Column('performance_percentile', sa.FLOAT(), nullable=True),
    sa.Column('engagement_percentile', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('last_calculated', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('student_analytics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_student_analytics_id'), ['id'], unique=False)

    op.create_table('realtime_user_presence',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('status_message', sa.VARCHAR(length=200), nullable=True),
    sa.Column('last_seen', sa.DATETIME(), nullable=True),
    sa.Column('last_activity', sa.DATETIME(), nullable=True),
    sa.Column('current_location', sa.VARCHAR(length=100), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('fk_presence_user')),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('realtime_user_presence', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_realtime_user_presence_user_id'), ['user_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_realtime_user_presence_id'), ['id'], unique=False)

    op.create_table('subscription_coupons',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('code', sa.VARCHAR(length=50), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('discount_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('discount_value', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('applies_to_plans', sa.TEXT(), nullable=True),
    sa.Column('duration', sa.VARCHAR(length=20), nullable=False),
    sa.Column('duration_months', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('valid_from', sa.DATETIME(), nullable=True),
    sa.Column('valid_until', sa.DATETIME(), nullable=True),
    sa.Column('max_redemptions', sa.INTEGER(), nullable=True),
    sa.Column('max_redemptions_per_user', sa.INTEGER(), nullable=True),
    sa.Column('times_redeemed', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('subscription_coupons', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_subscription_coupons_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_subscription_coupons_code'), ['code'], unique=1)

    op.create_table('sso_audit_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('event_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('event_status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('provider_type', sa.VARCHAR(length=20), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=50), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.Column('details', sqlite.JSON(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('sso_audit_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_sso_audit_logs_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_sso_audit_logs_organization_id'), ['organization_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_sso_audit_logs_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_sso_audit_logs_event_type'), ['event_type'], unique=False)
        batch_op.create_index(batch_op.f('ix_sso_audit_logs_created_at'), ['created_at'], unique=False)

    op.create_table('blockchain_blocks',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('index', sa.INTEGER(), nullable=False),
    sa.Column('timestamp', sa.DATETIME(), nullable=False),
    sa.Column('data', sqlite.JSON(), nullable=False),
    sa.Column('previous_hash', sa.VARCHAR(), nullable=False),
    sa.Column('hash', sa.VARCHAR(), nullable=False),
    sa.Column('nonce', sa.INTEGER(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('blockchain_blocks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_blockchain_blocks_index'), ['index'], unique=1)
        batch_op.create_index(batch_op.f('ix_blockchain_blocks_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_blockchain_blocks_hash'), ['hash'], unique=1)

    op.create_table('ai_grading_results',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('student_answer_id', sa.INTEGER(), nullable=True),
    sa.Column('ai_score', sa.FLOAT(), nullable=True),
    sa.Column('ai_feedback', sa.TEXT(), nullable=True),
    sa.Column('confidence', sa.FLOAT(), nullable=True),
    sa.Column('rubric_scores', sa.TEXT(), nullable=True),
    sa.Column('needs_manual_review', sa.BOOLEAN(), nullable=True),
    sa.Column('instructor_override_score', sa.FLOAT(), nullable=True),
    sa.Column('instructor_feedback', sa.TEXT(), nullable=True),
    sa.Column('reviewed_by_instructor', sa.BOOLEAN(), nullable=True),
    sa.Column('model_used', sa.VARCHAR(), nullable=True),
    sa.Column('grading_time_seconds', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['student_answer_id'], ['student_answers.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('student_answer_id')
    )
    with op.batch_alter_table('ai_grading_results', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_grading_results_id'), ['id'], unique=False)

    op.create_table('realtime_chat_messages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('message_type', sa.VARCHAR(length=6), nullable=True),
    sa.Column('sender_id', sa.INTEGER(), nullable=False),
    sa.Column('study_room_id', sa.INTEGER(), nullable=True),
    sa.Column('study_group_id', sa.INTEGER(), nullable=True),
    sa.Column('discussion_thread_id', sa.INTEGER(), nullable=True),
    sa.Column('attachment_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('attachment_name', sa.VARCHAR(length=200), nullable=True),
    sa.Column('attachment_size', sa.INTEGER(), nullable=True),
    sa.Column('is_edited', sa.BOOLEAN(), nullable=True),
    sa.Column('edited_at', sa.DATETIME(), nullable=True),
    sa.Column('is_deleted', sa.BOOLEAN(), nullable=True),
    sa.Column('deleted_at', sa.DATETIME(), nullable=True),
    sa.Column('reactions', sa.TEXT(), nullable=True),
    sa.Column('parent_id', sa.INTEGER(), nullable=True),
    sa.Column('read_by', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['discussion_thread_id'], ['discussion_threads.id'], ),
    sa.ForeignKeyConstraint(['parent_id'], ['realtime_chat_messages.id'], ),
    sa.ForeignKeyConstraint(['sender_id'], ['users.id'], name=op.f('fk_chat_sender')),
    sa.ForeignKeyConstraint(['study_group_id'], ['study_groups.id'], ),
    sa.ForeignKeyConstraint(['study_room_id'], ['study_rooms.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('realtime_chat_messages', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_realtime_chat_messages_sender_id'), ['sender_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_realtime_chat_messages_id'), ['id'], unique=False)

    op.create_table('ai_generated_quizzes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('lesson_id', sa.INTEGER(), nullable=True),
    sa.Column('quiz_id', sa.INTEGER(), nullable=True),
    sa.Column('source_content', sa.TEXT(), nullable=False),
    sa.Column('difficulty_level', sa.VARCHAR(length=20), nullable=True),
    sa.Column('num_questions', sa.INTEGER(), nullable=False),
    sa.Column('question_types', sqlite.JSON(), nullable=True),
    sa.Column('questions', sqlite.JSON(), nullable=False),
    sa.Column('quality_score', sa.FLOAT(), nullable=True),
    sa.Column('instructor_rating', sa.INTEGER(), nullable=True),
    sa.Column('used_in_course', sa.BOOLEAN(), nullable=True),
    sa.Column('review_notes', sa.TEXT(), nullable=True),
    sa.Column('model_used', sa.VARCHAR(length=50), nullable=True),
    sa.Column('generation_cost', sa.FLOAT(), nullable=True),
    sa.Column('generation_time', sa.FLOAT(), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['quiz_id'], ['quizzes.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_generated_quizzes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_generated_quizzes_lesson_id'), ['lesson_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_generated_quizzes_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_generated_quizzes_course_id'), ['course_id'], unique=False)

    op.create_table('certificates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('enrollment_id', sa.INTEGER(), nullable=False),
    sa.Column('certificate_number', sa.VARCHAR(), nullable=False),
    sa.Column('issued_at', sa.DATETIME(), nullable=False),
    sa.Column('student_name', sa.VARCHAR(), nullable=False),
    sa.Column('student_email', sa.VARCHAR(), nullable=False),
    sa.Column('course_title', sa.VARCHAR(), nullable=False),
    sa.Column('instructor_name', sa.VARCHAR(), nullable=False),
    sa.Column('pdf_url', sa.VARCHAR(), nullable=True),
    sa.Column('completion_percentage', sa.FLOAT(), nullable=True),
    sa.Column('total_lessons_completed', sa.INTEGER(), nullable=True),
    sa.Column('time_spent_hours', sa.FLOAT(), nullable=True),
    sa.Column('template_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['enrollment_id'], ['enrollments.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['certificate_templates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('enrollment_id')
    )
    with op.batch_alter_table('certificates', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_certificates_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_certificates_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_certificates_course_id'), ['course_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_certificates_certificate_number'), ['certificate_number'], unique=1)

    op.create_table('user_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('session_token', sa.VARCHAR(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(), nullable=True),
    sa.Column('device_info', sa.VARCHAR(), nullable=True),
    sa.Column('location', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('login_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('logout_at', sa.DATETIME(), nullable=True),
    sa.Column('last_activity_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_sessions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_sessions_session_token'), ['session_token'], unique=1)
        batch_op.create_index(batch_op.f('ix_user_sessions_id'), ['id'], unique=False)

    op.create_table('live_class_polls',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('live_class_id', sa.INTEGER(), nullable=False),
    sa.Column('question', sa.VARCHAR(), nullable=False),
    sa.Column('options', sqlite.JSON(), nullable=False),
    sa.Column('correct_option_index', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=7), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('ended_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['live_class_id'], ['live_classes.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_class_polls', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_class_polls_live_class_id'), ['live_class_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_polls_id'), ['id'], unique=False)

    op.create_table('upsc_student_progress',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=True),
    sa.Column('plan_id', sa.NUMERIC(), nullable=True),
    sa.Column('is_locked', sa.BOOLEAN(), nullable=True),
    sa.Column('unlocked_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('completion_percentage', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['plan_id'], ['upsc_plans.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('student_id', 'plan_id', name=op.f('_student_plan_uc'))
    )
    op.create_table('user_topic_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('topic_id', sa.INTEGER(), nullable=False),
    sa.Column('topic_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('topic_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('stability', sa.FLOAT(), nullable=True),
    sa.Column('difficulty', sa.FLOAT(), nullable=True),
    sa.Column('retrievability', sa.FLOAT(), nullable=True),
    sa.Column('initial_encoding_score', sa.FLOAT(), nullable=True),
    sa.Column('last_recall_grade', sa.INTEGER(), nullable=True),
    sa.Column('total_reviews', sa.INTEGER(), nullable=True),
    sa.Column('successful_recalls', sa.INTEGER(), nullable=True),
    sa.Column('learned_at', sa.DATETIME(), nullable=True),
    sa.Column('last_review_date', sa.DATETIME(), nullable=True),
    sa.Column('next_due_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_topic_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_topic_logs_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_topic_logs_topic_id'), ['topic_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_topic_logs_id'), ['id'], unique=False)

    op.create_table('modules',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('quiz_id', sa.INTEGER(), nullable=True),
    sa.Column('assignment_prompts', sqlite.JSON(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['quiz_id'], ['quizzes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('modules', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_modules_order_index'), ['order_index'], unique=False)
        batch_op.create_index(batch_op.f('ix_modules_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_modules_course_id'), ['course_id'], unique=False)

    op.create_table('subscription_invoices',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('subscription_id', sa.INTEGER(), nullable=False),
    sa.Column('invoice_number', sa.VARCHAR(length=50), nullable=True),
    sa.Column('amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('stripe_invoice_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_payment_intent', sa.VARCHAR(length=100), nullable=True),
    sa.Column('invoice_date', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('due_date', sa.DATETIME(), nullable=True),
    sa.Column('paid_at', sa.DATETIME(), nullable=True),
    sa.Column('invoice_pdf_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['subscription_id'], ['user_subscriptions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('invoice_number'),
    sa.UniqueConstraint('stripe_invoice_id')
    )
    with op.batch_alter_table('subscription_invoices', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_subscription_invoices_subscription_id'), ['subscription_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_subscription_invoices_id'), ['id'], unique=False)

    op.create_table('post_votes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('post_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('vote_type', sa.VARCHAR(length=10), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['post_id'], ['discussion_posts.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('post_votes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_post_votes_id'), ['id'], unique=False)

    op.create_table('quizzes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('lesson_id', sa.INTEGER(), nullable=True),
    sa.Column('time_limit_minutes', sa.INTEGER(), nullable=True),
    sa.Column('passing_score', sa.FLOAT(), nullable=True),
    sa.Column('max_attempts', sa.INTEGER(), nullable=True),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('shuffle_questions', sa.BOOLEAN(), nullable=True),
    sa.Column('show_correct_answers', sa.BOOLEAN(), nullable=True),
    sa.Column('instant_feedback', sa.BOOLEAN(), nullable=True),
    sa.Column('show_score_immediately', sa.BOOLEAN(), nullable=True),
    sa.Column('randomize_options', sa.BOOLEAN(), nullable=True),
    sa.Column('allow_review_answers', sa.BOOLEAN(), nullable=True),
    sa.Column('show_hints', sa.BOOLEAN(), nullable=True),
    sa.Column('require_all_questions', sa.BOOLEAN(), nullable=True),
    sa.Column('allow_backtrack', sa.BOOLEAN(), nullable=True),
    sa.Column('enable_ai_grading', sa.BOOLEAN(), nullable=True),
    sa.Column('ai_grading_model', sa.VARCHAR(), nullable=True),
    sa.Column('manual_review_threshold', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('quizzes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_quizzes_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_quizzes_id'), ['id'], unique=False)

    op.create_table('handwriting_submissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('image_url', sa.VARCHAR(), nullable=False),
    sa.Column('quiz_data', sa.TEXT(), nullable=True),
    sa.Column('report_content', sa.TEXT(), nullable=True),
    sa.Column('report_level', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('handwriting_submissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_handwriting_submissions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_handwriting_submissions_id'), ['id'], unique=False)

    op.create_table('course_tags',
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('tag_id', sa.INTEGER(), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tag_id'], ['tags.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('course_id', 'tag_id')
    )
    op.create_table('discussion_categories',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('discussion_categories', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_discussion_categories_id'), ['id'], unique=False)

    op.create_table('course_announcements',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('is_pinned', sa.BOOLEAN(), nullable=True),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('send_notification', sa.BOOLEAN(), nullable=True),
    sa.Column('send_email', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('published_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('course_announcements', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_course_announcements_id'), ['id'], unique=False)

    op.create_table('content_difficulty_analyses',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('content_id', sa.INTEGER(), nullable=False),
    sa.Column('content_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('flesch_reading_ease', sa.FLOAT(), nullable=True),
    sa.Column('flesch_kincaid_grade', sa.FLOAT(), nullable=True),
    sa.Column('gunning_fog_index', sa.FLOAT(), nullable=True),
    sa.Column('smog_index', sa.FLOAT(), nullable=True),
    sa.Column('avg_sentence_length', sa.FLOAT(), nullable=True),
    sa.Column('avg_word_length', sa.FLOAT(), nullable=True),
    sa.Column('vocabulary_complexity', sa.FLOAT(), nullable=True),
    sa.Column('concept_density', sa.FLOAT(), nullable=True),
    sa.Column('recommended_level', sa.VARCHAR(length=50), nullable=True),
    sa.Column('target_audience', sa.VARCHAR(length=100), nullable=True),
    sa.Column('estimated_reading_time', sa.INTEGER(), nullable=True),
    sa.Column('simplification_suggestions', sqlite.JSON(), nullable=True),
    sa.Column('difficult_terms', sqlite.JSON(), nullable=True),
    sa.Column('analyzed_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('content_difficulty_analyses', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_content_difficulty_analyses_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_difficulty_analyses_content_id'), ['content_id'], unique=False)

    op.create_table('user_email_preferences',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('enrollment_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('assignment_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('quiz_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('certificate_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('announcement_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('review_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('course_update_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('general_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('all_emails_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_email_preferences', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_email_preferences_user_id'), ['user_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_user_email_preferences_id'), ['id'], unique=False)

    op.create_table('ai_debug_logs',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('session_id', sa.VARCHAR(length=100), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('step_number', sa.INTEGER(), nullable=False),
    sa.Column('step_name', sa.VARCHAR(length=100), nullable=False),
    sa.Column('step_description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('input_summary', sa.TEXT(), nullable=True),
    sa.Column('input_full', sa.TEXT(), nullable=True),
    sa.Column('output_summary', sa.TEXT(), nullable=True),
    sa.Column('output_full', sa.TEXT(), nullable=True),
    sa.Column('model_used', sa.VARCHAR(length=50), nullable=True),
    sa.Column('provider', sa.VARCHAR(length=50), nullable=True),
    sa.Column('tokens_used', sa.INTEGER(), nullable=True),
    sa.Column('estimated_cost', sa.FLOAT(), nullable=True),
    sa.Column('duration_ms', sa.INTEGER(), nullable=True),
    sa.Column('success', sa.BOOLEAN(), nullable=True),
    sa.Column('is_fallback', sa.BOOLEAN(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('context_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('related_entity_id', sa.VARCHAR(length=100), nullable=True),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_debug_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_debug_logs_session_id'), ['session_id'], unique=False)

    op.create_table('project_team_members',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('team_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('role', sa.VARCHAR(length=6), nullable=False),
    sa.Column('joined_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['team_id'], ['project_teams.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('project_team_members', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_project_team_members_id'), ['id'], unique=False)

    op.create_table('tax_exemptions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('organization_id', sa.INTEGER(), nullable=True),
    sa.Column('exemption_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('exemption_certificate', sa.VARCHAR(length=100), nullable=True),
    sa.Column('tax_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('country_code', sa.VARCHAR(length=2), nullable=True),
    sa.Column('state_code', sa.VARCHAR(length=10), nullable=True),
    sa.Column('applies_to_all', sa.BOOLEAN(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('verified', sa.BOOLEAN(), nullable=True),
    sa.Column('verified_at', sa.DATETIME(), nullable=True),
    sa.Column('valid_from', sa.DATETIME(), nullable=True),
    sa.Column('valid_until', sa.DATETIME(), nullable=True),
    sa.Column('certificate_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('tax_exemptions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_tax_exemptions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_exemptions_organization_id'), ['organization_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_exemptions_id'), ['id'], unique=False)

    op.create_table('organizations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=200), nullable=False),
    sa.Column('domain', sa.VARCHAR(length=255), nullable=False),
    sa.Column('slug', sa.VARCHAR(length=100), nullable=False),
    sa.Column('sso_enabled', sa.BOOLEAN(), nullable=True),
    sa.Column('sso_provider', sa.VARCHAR(length=50), nullable=True),
    sa.Column('sso_enforced', sa.BOOLEAN(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('max_users', sa.INTEGER(), nullable=True),
    sa.Column('settings', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('organizations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_organizations_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_organizations_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_organizations_domain'), ['domain'], unique=1)

    op.create_table('daily_tasks',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('user_id', sa.NUMERIC(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=255), nullable=False),
    sa.Column('completed', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('daily_tasks', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_daily_tasks_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_daily_tasks_date'), ['date'], unique=False)

    op.create_table('analytics_events',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('event_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('event_data', sa.TEXT(), nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), nullable=True),
    sa.Column('timestamp', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('analytics_events', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_analytics_events_timestamp'), ['timestamp'], unique=False)
        batch_op.create_index(batch_op.f('ix_analytics_events_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_analytics_events_event_type'), ['event_type'], unique=False)

    op.create_table('batch1_segments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('cycle_id', sa.INTEGER(), nullable=False),
    sa.Column('day_number', sa.INTEGER(), nullable=False),
    sa.Column('part_number', sa.INTEGER(), nullable=False),
    sa.Column('segment_number', sa.INTEGER(), nullable=False),
    sa.Column('segment_key', sa.VARCHAR(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('video_url', sa.VARCHAR(), nullable=True),
    sa.Column('transcription_text', sa.VARCHAR(), nullable=True),
    sa.Column('key_points', sa.VARCHAR(), nullable=True),
    sa.Column('is_processed', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('segment_key', name=op.f('uq_batch1_segment_key'))
    )
    with op.batch_alter_table('batch1_segments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_batch1_segments_segment_key'), ['segment_key'], unique=1)
        batch_op.create_index(batch_op.f('ix_batch1_segments_id'), ['id'], unique=False)

    op.create_table('course_reviews',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('rating', sa.FLOAT(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=True),
    sa.Column('review_text', sa.TEXT(), nullable=True),
    sa.Column('helpful_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('is_approved', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('course_reviews', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_course_reviews_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_course_reviews_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_course_reviews_course_id'), ['course_id'], unique=False)

    op.create_table('friendships',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('friend_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=8), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('accepted_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['friend_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('friendships', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_friendships_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_friendships_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_friendships_friend_id'), ['friend_id'], unique=False)

    op.create_table('meditation_day_completions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('progress_id', sa.INTEGER(), nullable=False),
    sa.Column('level', sa.INTEGER(), nullable=False),
    sa.Column('day_number', sa.INTEGER(), nullable=False),
    sa.Column('session_type', sa.VARCHAR(length=20), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('total_duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['progress_id'], ['meditation_progress.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('meditation_day_completions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_meditation_day_completions_id'), ['id'], unique=False)

    op.create_table('direct_messages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('sender_id', sa.INTEGER(), nullable=False),
    sa.Column('receiver_id', sa.INTEGER(), nullable=False),
    sa.Column('message', sa.TEXT(), nullable=False),
    sa.Column('is_read', sa.BOOLEAN(), nullable=True),
    sa.Column('read_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['receiver_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['sender_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('direct_messages', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_direct_messages_sender_id'), ['sender_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_direct_messages_receiver_id'), ['receiver_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_direct_messages_id'), ['id'], unique=False)

    op.create_table('graphotherapy_day_completions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('progress_id', sa.INTEGER(), nullable=False),
    sa.Column('level', sa.INTEGER(), nullable=False),
    sa.Column('day_number', sa.INTEGER(), nullable=False),
    sa.Column('completed_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('upload_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('upload_filename', sa.VARCHAR(length=255), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['progress_id'], ['graphotherapy_progress.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('graphotherapy_day_completions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_graphotherapy_day_completions_id'), ['id'], unique=False)

    op.create_table('retention_reviews',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('topic_log_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('review_type', sa.VARCHAR(length=30), nullable=True),
    sa.Column('grade', sa.INTEGER(), nullable=True),
    sa.Column('score', sa.FLOAT(), nullable=True),
    sa.Column('stability_before', sa.FLOAT(), nullable=True),
    sa.Column('stability_after', sa.FLOAT(), nullable=True),
    sa.Column('retrievability_at_review', sa.FLOAT(), nullable=True),
    sa.Column('user_input', sa.TEXT(), nullable=True),
    sa.Column('ai_feedback', sa.TEXT(), nullable=True),
    sa.Column('reviewed_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['topic_log_id'], ['user_topic_logs.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('retention_reviews', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_retention_reviews_id'), ['id'], unique=False)

    op.create_table('discussion_threads',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('category_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('is_pinned', sa.BOOLEAN(), nullable=True),
    sa.Column('is_locked', sa.BOOLEAN(), nullable=True),
    sa.Column('is_resolved', sa.BOOLEAN(), nullable=True),
    sa.Column('view_count', sa.INTEGER(), nullable=True),
    sa.Column('reply_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_activity_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['category_id'], ['discussion_categories.id'], ),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('discussion_threads', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_discussion_threads_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_discussion_threads_id'), ['id'], unique=False)

    op.create_table('meditation_process_completions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('day_completion_id', sa.INTEGER(), nullable=False),
    sa.Column('process_id', sa.INTEGER(), nullable=False),
    sa.Column('completed_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('watched_video', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['day_completion_id'], ['meditation_day_completions.id'], ),
    sa.ForeignKeyConstraint(['process_id'], ['meditation_processes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('meditation_process_completions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_meditation_process_completions_id'), ['id'], unique=False)

    op.create_table('group_posts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('group_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('is_pinned', sa.BOOLEAN(), nullable=True),
    sa.Column('likes_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['group_id'], ['learning_groups.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('group_posts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_group_posts_id'), ['id'], unique=False)

    op.create_table('peer_reviews',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('peer_review_assignment_id', sa.INTEGER(), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('score', sa.FLOAT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['peer_review_assignment_id'], ['peer_review_assignments.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('peer_review_assignment_id')
    )
    with op.batch_alter_table('peer_reviews', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_peer_reviews_id'), ['id'], unique=False)

    op.create_table('data_masking_configs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('role', sa.VARCHAR(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('mask_email', sa.BOOLEAN(), nullable=True),
    sa.Column('mask_phone', sa.BOOLEAN(), nullable=True),
    sa.Column('mask_address', sa.BOOLEAN(), nullable=True),
    sa.Column('mask_financial', sa.BOOLEAN(), nullable=True),
    sa.Column('custom_masked_fields', sqlite.JSON(), nullable=True),
    sa.Column('masking_pattern', sa.VARCHAR(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('data_masking_configs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_data_masking_configs_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_data_masking_configs_role'), ['role'], unique=False)
        batch_op.create_index(batch_op.f('ix_data_masking_configs_id'), ['id'], unique=False)

    op.create_table('orders',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('order_number', sa.VARCHAR(length=50), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('guest_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('cart_id', sa.INTEGER(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=10), nullable=False),
    sa.Column('subtotal', sa.FLOAT(), nullable=False),
    sa.Column('discount', sa.FLOAT(), nullable=False),
    sa.Column('tax', sa.FLOAT(), nullable=False),
    sa.Column('total', sa.FLOAT(), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=False),
    sa.Column('billing_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('billing_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('billing_address', sa.TEXT(), nullable=True),
    sa.Column('payment_id', sa.INTEGER(), nullable=True),
    sa.Column('customer_notes', sa.TEXT(), nullable=True),
    sa.Column('admin_notes', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('cancelled_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['cart_id'], ['shopping_carts.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['payment_id'], ['course_payments.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('orders', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_orders_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_orders_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_orders_order_number'), ['order_number'], unique=1)
        batch_op.create_index(batch_op.f('ix_orders_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_orders_guest_email'), ['guest_email'], unique=False)

    op.create_table('groups',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=True),
    sa.Column('description', sa.VARCHAR(), nullable=True),
    sa.Column('avatar_url', sa.VARCHAR(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('groups', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_groups_name'), ['name'], unique=1)
        batch_op.create_index(batch_op.f('ix_groups_id'), ['id'], unique=False)

    op.create_table('upsc_timer_configs',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('batch_id', sa.NUMERIC(), nullable=True),
    sa.Column('phase', sa.VARCHAR(), nullable=False),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['batch_id'], ['upsc_batches.id'], ),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('batch_id', 'phase', name=op.f('_batch_phase_uc'))
    )
    op.create_table('payment_methods',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('gateway', sa.VARCHAR(length=9), nullable=False),
    sa.Column('method_type', sa.VARCHAR(length=12), nullable=False),
    sa.Column('gateway_token', sa.VARCHAR(length=255), nullable=False),
    sa.Column('gateway_customer_id', sa.VARCHAR(length=255), nullable=True),
    sa.Column('display_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('last_four', sa.VARCHAR(length=4), nullable=True),
    sa.Column('card_brand', sa.VARCHAR(length=20), nullable=True),
    sa.Column('expiry_month', sa.INTEGER(), nullable=True),
    sa.Column('expiry_year', sa.INTEGER(), nullable=True),
    sa.Column('paypal_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), nullable=False),
    sa.Column('is_active', sa.BOOLEAN(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('last_used_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('payment_methods', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_payment_methods_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_payment_methods_id'), ['id'], unique=False)

    op.create_table('instructor_payment_info',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('stripe_account_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('paypal_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('bank_account_encrypted', sa.TEXT(), nullable=True),
    sa.Column('tax_country', sa.VARCHAR(length=2), nullable=True),
    sa.Column('tax_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('tax_form_type', sa.VARCHAR(length=20), nullable=True),
    sa.Column('tax_form_submitted', sa.BOOLEAN(), nullable=True),
    sa.Column('tax_form_verified', sa.BOOLEAN(), nullable=True),
    sa.Column('minimum_payout_amount', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('payout_frequency', sa.VARCHAR(length=20), nullable=True),
    sa.Column('verified', sa.BOOLEAN(), nullable=True),
    sa.Column('verified_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('instructor_payment_info', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_instructor_payment_info_instructor_id'), ['instructor_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_instructor_payment_info_id'), ['id'], unique=False)

    op.create_table('two_factor_backup_codes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('two_factor_auth_id', sa.INTEGER(), nullable=False),
    sa.Column('code_hash', sa.VARCHAR(length=255), nullable=False),
    sa.Column('is_used', sa.BOOLEAN(), nullable=False),
    sa.Column('used_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.ForeignKeyConstraint(['two_factor_auth_id'], ['two_factor_auth.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('two_factor_backup_codes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_two_factor_backup_codes_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_two_factor_backup_codes_two_factor_auth_id'), ['two_factor_auth_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_two_factor_backup_codes_id'), ['id'], unique=False)

    op.create_table('upsc_content',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('question_id', sa.NUMERIC(), nullable=True),
    sa.Column('content_type', sa.VARCHAR(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=True),
    sa.Column('content_text', sa.TEXT(), nullable=True),
    sa.Column('file_url', sa.VARCHAR(), nullable=True),
    sa.Column('microtopics', sqlite.JSON(), nullable=True),
    sa.Column('keywords', sqlite.JSON(), nullable=True),
    sa.Column('current_affairs', sqlite.JSON(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['question_id'], ['upsc_questions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('tags',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('slug', sa.VARCHAR(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('tags', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_tags_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_tags_name'), ['name'], unique=1)
        batch_op.create_index(batch_op.f('ix_tags_id'), ['id'], unique=False)

    op.create_table('live_classes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('scheduled_at', sa.DATETIME(), nullable=False),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('meeting_url', sa.VARCHAR(), nullable=True),
    sa.Column('meeting_password', sa.VARCHAR(), nullable=True),
    sa.Column('platform', sa.VARCHAR(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=9), nullable=True),
    sa.Column('recording_url', sa.VARCHAR(), nullable=True),
    sa.Column('recording_available', sa.BOOLEAN(), nullable=True),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('whiteboard_data', sqlite.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_classes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_classes_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_classes_scheduled_at'), ['scheduled_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_classes_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_classes_course_id'), ['course_id'], unique=False)

    op.create_table('user_roles',
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('role_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('user_id', 'role_id')
    )
    op.create_table('two_factor_auth',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('secret', sa.VARCHAR(length=255), nullable=False),
    sa.Column('is_enabled', sa.BOOLEAN(), nullable=False),
    sa.Column('verified_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('two_factor_auth', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_two_factor_auth_user_id'), ['user_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_two_factor_auth_id'), ['id'], unique=False)

    op.create_table('course_bundles',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=255), nullable=False),
    sa.Column('slug', sa.VARCHAR(length=255), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('short_description', sa.VARCHAR(length=500), nullable=True),
    sa.Column('price', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('original_price', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('discount_percentage', sa.NUMERIC(precision=5, scale=2), nullable=True),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('thumbnail_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('banner_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('total_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('total_revenue', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('view_count', sa.INTEGER(), nullable=True),
    sa.Column('valid_from', sa.DATETIME(), nullable=True),
    sa.Column('valid_until', sa.DATETIME(), nullable=True),
    sa.Column('meta_title', sa.VARCHAR(length=255), nullable=True),
    sa.Column('meta_description', sa.TEXT(), nullable=True),
    sa.Column('meta_keywords', sa.VARCHAR(length=500), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('course_bundles', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_course_bundles_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_course_bundles_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_course_bundles_id'), ['id'], unique=False)

    op.create_table('content_embeddings',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('content_id', sa.INTEGER(), nullable=False),
    sa.Column('content_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('embedding_model', sa.VARCHAR(length=50), nullable=True),
    sa.Column('embedding_dimension', sa.INTEGER(), nullable=True),
    sa.Column('embedding_vector', sqlite.JSON(), nullable=False),
    sa.Column('content_title', sa.VARCHAR(length=500), nullable=True),
    sa.Column('content_excerpt', sa.TEXT(), nullable=True),
    sa.Column('last_updated', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('content_embeddings', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_content_embeddings_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_embeddings_content_id'), ['content_id'], unique=False)

    op.create_table('upsc_reports',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('attempt_before_id', sa.NUMERIC(), nullable=True),
    sa.Column('attempt_after_id', sa.NUMERIC(), nullable=True),
    sa.Column('student_id', sa.INTEGER(), nullable=True),
    sa.Column('question_id', sa.NUMERIC(), nullable=True),
    sa.Column('coverage_before', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('similarity_before', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('keyword_recall_before', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('structure_score_before', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('language_score_before', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('estimated_marks_before', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('coverage_after', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('similarity_after', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('keyword_recall_after', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('structure_score_after', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('language_score_after', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('estimated_marks_after', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('missed_points', sqlite.JSON(), nullable=True),
    sa.Column('suggestions', sqlite.JSON(), nullable=True),
    sa.Column('common_mistakes', sqlite.JSON(), nullable=True),
    sa.Column('tone_feedback', sa.TEXT(), nullable=True),
    sa.Column('ai_model_version', sa.VARCHAR(), nullable=True),
    sa.Column('raw_ai_output', sqlite.JSON(), nullable=True),
    sa.Column('generated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('reviewed_by_id', sa.INTEGER(), nullable=True),
    sa.Column('reviewed_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['attempt_after_id'], ['upsc_attempts.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['attempt_before_id'], ['upsc_attempts.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['question_id'], ['upsc_questions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['reviewed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('user_subscriptions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('plan_id', sa.INTEGER(), nullable=False),
    sa.Column('billing_cycle', sa.VARCHAR(length=20), nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('started_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('trial_ends_at', sa.DATETIME(), nullable=True),
    sa.Column('current_period_start', sa.DATETIME(), nullable=True),
    sa.Column('current_period_end', sa.DATETIME(), nullable=True),
    sa.Column('cancelled_at', sa.DATETIME(), nullable=True),
    sa.Column('ended_at', sa.DATETIME(), nullable=True),
    sa.Column('stripe_subscription_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_customer_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('stripe_latest_invoice', sa.VARCHAR(length=100), nullable=True),
    sa.Column('price_paid', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('auto_renew', sa.BOOLEAN(), nullable=True),
    sa.Column('cancel_at_period_end', sa.BOOLEAN(), nullable=True),
    sa.Column('last_payment_date', sa.DATETIME(), nullable=True),
    sa.Column('next_payment_date', sa.DATETIME(), nullable=True),
    sa.Column('payment_failed_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['plan_id'], ['subscription_plans.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_subscriptions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_subscriptions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_subscriptions_stripe_subscription_id'), ['stripe_subscription_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_user_subscriptions_plan_id'), ['plan_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_subscriptions_id'), ['id'], unique=False)

    op.create_table('group_memberships',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('group_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('role', sa.VARCHAR(length=9), nullable=True),
    sa.Column('joined_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['group_id'], ['learning_groups.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('group_memberships', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_group_memberships_id'), ['id'], unique=False)

    op.create_table('tax_calculations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('order_id', sa.INTEGER(), nullable=True),
    sa.Column('payment_id', sa.INTEGER(), nullable=True),
    sa.Column('subscription_id', sa.INTEGER(), nullable=True),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('tax_rate_id', sa.INTEGER(), nullable=False),
    sa.Column('subtotal', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('tax_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('total_amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=False),
    sa.Column('billing_country', sa.VARCHAR(length=2), nullable=True),
    sa.Column('billing_state', sa.VARCHAR(length=10), nullable=True),
    sa.Column('billing_zip', sa.VARCHAR(length=20), nullable=True),
    sa.Column('tax_id', sa.VARCHAR(length=50), nullable=True),
    sa.Column('tax_exempt', sa.BOOLEAN(), nullable=True),
    sa.Column('tax_exempt_reason', sa.VARCHAR(length=200), nullable=True),
    sa.Column('calculation_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('is_inclusive', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ),
    sa.ForeignKeyConstraint(['payment_id'], ['course_payments.id'], ),
    sa.ForeignKeyConstraint(['subscription_id'], ['user_subscriptions.id'], ),
    sa.ForeignKeyConstraint(['tax_rate_id'], ['tax_rates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('tax_calculations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_tax_calculations_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_calculations_subscription_id'), ['subscription_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_calculations_payment_id'), ['payment_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_calculations_order_id'), ['order_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_tax_calculations_id'), ['id'], unique=False)

    op.create_table('midnight_test_questions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('topic_id', sa.INTEGER(), nullable=False),
    sa.Column('topic_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('question_text', sa.TEXT(), nullable=False),
    sa.Column('question_type', sa.VARCHAR(length=30), nullable=True),
    sa.Column('correct_answer', sa.TEXT(), nullable=True),
    sa.Column('key_concepts', sa.TEXT(), nullable=True),
    sa.Column('difficulty', sa.FLOAT(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('midnight_test_questions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_midnight_test_questions_topic_id'), ['topic_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_midnight_test_questions_id'), ['id'], unique=False)

    op.create_table('instructor_payouts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('payment_method', sa.VARCHAR(length=20), nullable=False),
    sa.Column('payment_details', sa.TEXT(), nullable=True),
    sa.Column('stripe_transfer_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('transaction_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('requested_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('admin_notes', sa.TEXT(), nullable=True),
    sa.Column('failure_reason', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('instructor_payouts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_instructor_payouts_instructor_id'), ['instructor_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_instructor_payouts_id'), ['id'], unique=False)

    op.create_table('categories',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('slug', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('icon', sa.VARCHAR(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('categories', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_categories_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_categories_name'), ['name'], unique=1)
        batch_op.create_index(batch_op.f('ix_categories_id'), ['id'], unique=False)

    op.create_table('peer_review_assignments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('assignment_id', sa.INTEGER(), nullable=False),
    sa.Column('reviewer_id', sa.INTEGER(), nullable=False),
    sa.Column('reviewee_id', sa.INTEGER(), nullable=False),
    sa.Column('submission_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('due_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['assignment_id'], ['assignments.id'], ),
    sa.ForeignKeyConstraint(['reviewee_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['reviewer_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['submission_id'], ['submissions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('peer_review_assignments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_peer_review_assignments_id'), ['id'], unique=False)

    op.create_table('path_courses',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('path_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('prerequisite_course_id', sa.INTEGER(), nullable=True),
    sa.Column('is_required', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['path_id'], ['learning_paths.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['prerequisite_course_id'], ['courses.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('path_courses', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_path_courses_path_id'), ['path_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_path_courses_order_index'), ['order_index'], unique=False)
        batch_op.create_index(batch_op.f('ix_path_courses_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_path_courses_course_id'), ['course_id'], unique=False)

    op.create_table('upsc_plans',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('batch_id', sa.NUMERIC(), nullable=True),
    sa.Column('plan_type', sa.VARCHAR(), nullable=False),
    sa.Column('parent_plan_id', sa.NUMERIC(), nullable=True),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=False),
    sa.Column('sequence_order', sa.INTEGER(), nullable=False),
    sa.Column('ai_generated', sa.BOOLEAN(), nullable=True),
    sa.Column('approved_by_id', sa.INTEGER(), nullable=True),
    sa.Column('approved_at', sa.DATETIME(), nullable=True),
    sa.Column('version', sa.INTEGER(), nullable=True),
    sa.Column('plan_data', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['batch_id'], ['upsc_batches.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['parent_plan_id'], ['upsc_plans.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('lesson_notes',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('lesson_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=True),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('timestamp', sa.INTEGER(), nullable=True),
    sa.Column('is_private', sa.BOOLEAN(), nullable=True),
    sa.Column('color', sa.VARCHAR(length=20), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('lesson_notes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_lesson_notes_id'), ['id'], unique=False)

    op.create_table('upsc_batches',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('start_date', sa.DATE(), nullable=False),
    sa.Column('end_date', sa.DATE(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ai_debug_sessions',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('session_id', sa.VARCHAR(length=100), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('operation_type', sa.VARCHAR(length=50), nullable=True),
    sa.Column('operation_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('total_steps', sa.INTEGER(), nullable=True),
    sa.Column('total_tokens', sa.INTEGER(), nullable=True),
    sa.Column('total_duration_ms', sa.INTEGER(), nullable=True),
    sa.Column('total_cost', sa.FLOAT(), nullable=True),
    sa.Column('final_result_summary', sa.TEXT(), nullable=True),
    sa.Column('had_errors', sa.BOOLEAN(), nullable=True),
    sa.Column('had_fallbacks', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_debug_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_debug_sessions_session_id'), ['session_id'], unique=1)

    op.create_table('live_class_attendance',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('live_class_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('joined_at', sa.DATETIME(), nullable=False),
    sa.Column('left_at', sa.DATETIME(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('asked_questions', sa.INTEGER(), nullable=True),
    sa.Column('reactions_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['live_class_id'], ['live_classes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_class_attendance', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_class_attendance_student_id'), ['student_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_attendance_live_class_id'), ['live_class_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_attendance_id'), ['id'], unique=False)

    op.create_table('project_teams',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('project_id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['collaborative_projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('project_teams', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_project_teams_id'), ['id'], unique=False)

    op.create_table('instructor_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('total_students', sa.INTEGER(), nullable=True),
    sa.Column('active_students', sa.INTEGER(), nullable=True),
    sa.Column('new_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('completions', sa.INTEGER(), nullable=True),
    sa.Column('avg_progress', sa.FLOAT(), nullable=True),
    sa.Column('avg_quiz_score', sa.FLOAT(), nullable=True),
    sa.Column('quiz_attempts', sa.INTEGER(), nullable=True),
    sa.Column('assignments_submitted', sa.INTEGER(), nullable=True),
    sa.Column('avg_assignment_score', sa.FLOAT(), nullable=True),
    sa.Column('total_revenue', sa.FLOAT(), nullable=True),
    sa.Column('new_revenue', sa.FLOAT(), nullable=True),
    sa.Column('refunds', sa.INTEGER(), nullable=True),
    sa.Column('refund_amount', sa.FLOAT(), nullable=True),
    sa.Column('total_time_spent', sa.INTEGER(), nullable=True),
    sa.Column('avg_session_duration', sa.FLOAT(), nullable=True),
    sa.Column('discussion_posts', sa.INTEGER(), nullable=True),
    sa.Column('questions_asked', sa.INTEGER(), nullable=True),
    sa.Column('peer_reviews_completed', sa.INTEGER(), nullable=True),
    sa.Column('avg_rating', sa.FLOAT(), nullable=True),
    sa.Column('new_reviews', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('instructor_analytics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_instructor_analytics_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_instructor_analytics_date'), ['date'], unique=False)

    op.create_table('affiliate_payouts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('affiliate_id', sa.INTEGER(), nullable=False),
    sa.Column('amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('payment_method', sa.VARCHAR(length=20), nullable=False),
    sa.Column('payment_details', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('stripe_transfer_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('paypal_transaction_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('transaction_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('requested_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('processed_at', sa.DATETIME(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('admin_notes', sa.TEXT(), nullable=True),
    sa.Column('failure_reason', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['affiliate_id'], ['affiliate_partners.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('affiliate_payouts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_affiliate_payouts_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_payouts_affiliate_id'), ['affiliate_id'], unique=False)

    op.create_table('lessons',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('module_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('type', sa.VARCHAR(length=11), nullable=True),
    sa.Column('content', sqlite.JSON(), nullable=True),
    sa.Column('video_url', sa.VARCHAR(), nullable=True),
    sa.Column('video_duration_seconds', sa.INTEGER(), nullable=True),
    sa.Column('video_provider', sa.VARCHAR(), nullable=True),
    sa.Column('video_id', sa.VARCHAR(), nullable=True),
    sa.Column('video_thumbnail_url', sa.VARCHAR(), nullable=True),
    sa.Column('video_status', sa.VARCHAR(), nullable=True),
    sa.Column('video_uploaded_at', sa.DATETIME(), nullable=True),
    sa.Column('attachments', sqlite.JSON(), nullable=True),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('is_preview', sa.BOOLEAN(), nullable=True),
    sa.Column('available_after_days', sa.INTEGER(), nullable=True),
    sa.Column('prerequisite_lesson_ids', sqlite.JSON(), nullable=True),
    sa.Column('duration_minutes', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['module_id'], ['modules.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('lessons', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_lessons_type'), ['type'], unique=False)
        batch_op.create_index(batch_op.f('ix_lessons_order_index'), ['order_index'], unique=False)
        batch_op.create_index(batch_op.f('ix_lessons_module_id'), ['module_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_lessons_id'), ['id'], unique=False)

    op.create_table('user_language_preferences',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('preferred_language', sa.VARCHAR(length=10), nullable=False),
    sa.Column('content_languages', sa.VARCHAR(length=255), nullable=True),
    sa.Column('auto_translate', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_language_preferences', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_language_preferences_user_id'), ['user_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_user_language_preferences_id'), ['id'], unique=False)

    op.create_table('upsc_attempts',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=True),
    sa.Column('question_id', sa.NUMERIC(), nullable=True),
    sa.Column('attempt_type', sa.VARCHAR(), nullable=False),
    sa.Column('answer_text', sa.TEXT(), nullable=True),
    sa.Column('image_url', sa.VARCHAR(), nullable=True),
    sa.Column('audio_url', sa.VARCHAR(), nullable=True),
    sa.Column('transcription', sa.TEXT(), nullable=True),
    sa.Column('word_count', sa.INTEGER(), nullable=True),
    sa.Column('time_taken_seconds', sa.INTEGER(), nullable=True),
    sa.Column('ocr_confidence', sa.DECIMAL(precision=5, scale=2), nullable=True),
    sa.Column('submitted_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('drill_session_id', sa.NUMERIC(), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['upsc_questions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('shopping_carts',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('expires_at', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('shopping_carts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_shopping_carts_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_shopping_carts_session_id'), ['session_id'], unique=1)
        batch_op.create_index(batch_op.f('ix_shopping_carts_id'), ['id'], unique=False)

    op.create_table('quiz_feedback',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('question_id', sa.INTEGER(), nullable=False),
    sa.Column('feedback_text', sa.TEXT(), nullable=True),
    sa.Column('feedback_for_correct', sa.TEXT(), nullable=True),
    sa.Column('feedback_for_incorrect', sa.TEXT(), nullable=True),
    sa.Column('hint_text', sa.TEXT(), nullable=True),
    sa.Column('explanation_url', sa.VARCHAR(), nullable=True),
    sa.Column('media_url', sa.VARCHAR(), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('quiz_feedback', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_quiz_feedback_id'), ['id'], unique=False)

    op.create_table('drill_model_answers',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('question_id', sa.VARCHAR(length=36), nullable=True),
    sa.Column('title', sa.VARCHAR(length=255), nullable=False),
    sa.Column('answer_text', sa.TEXT(), nullable=False),
    sa.Column('key_points', sqlite.JSON(), nullable=True),
    sa.Column('word_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['drill_questions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('question_id')
    )
    op.create_table('email_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('display_name', sa.VARCHAR(), nullable=False),
    sa.Column('subject', sa.VARCHAR(), nullable=False),
    sa.Column('body_html', sa.TEXT(), nullable=False),
    sa.Column('body_text', sa.TEXT(), nullable=True),
    sa.Column('variables', sqlite.JSON(), nullable=True),
    sa.Column('is_system', sa.BOOLEAN(), nullable=True),
    sa.Column('notification_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('email_templates', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_email_templates_notification_type'), ['notification_type'], unique=False)
        batch_op.create_index(batch_op.f('ix_email_templates_name'), ['name'], unique=1)
        batch_op.create_index(batch_op.f('ix_email_templates_id'), ['id'], unique=False)

    op.create_table('chatbot_messages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('session_id', sa.INTEGER(), nullable=False),
    sa.Column('role', sa.VARCHAR(), nullable=False),
    sa.Column('content', sa.TEXT(), nullable=False),
    sa.Column('meta_data', sqlite.JSON(), nullable=True),
    sa.Column('tokens_used', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['chat_sessions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('chatbot_messages', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_chatbot_messages_id'), ['id'], unique=False)

    op.create_table('collaborative_projects',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('group_id', sa.INTEGER(), nullable=True),
    sa.Column('deadline', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=11), nullable=False),
    sa.Column('max_team_size', sa.INTEGER(), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['group_id'], ['learning_groups.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('collaborative_projects', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_collaborative_projects_id'), ['id'], unique=False)

    op.create_table('automation_analytics',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATETIME(), nullable=False),
    sa.Column('workflow_id', sa.INTEGER(), nullable=True),
    sa.Column('emails_sent', sa.INTEGER(), nullable=True),
    sa.Column('emails_delivered', sa.INTEGER(), nullable=True),
    sa.Column('emails_opened', sa.INTEGER(), nullable=True),
    sa.Column('emails_clicked', sa.INTEGER(), nullable=True),
    sa.Column('sms_sent', sa.INTEGER(), nullable=True),
    sa.Column('sms_delivered', sa.INTEGER(), nullable=True),
    sa.Column('whatsapp_sent', sa.INTEGER(), nullable=True),
    sa.Column('whatsapp_delivered', sa.INTEGER(), nullable=True),
    sa.Column('whatsapp_read', sa.INTEGER(), nullable=True),
    sa.Column('push_sent', sa.INTEGER(), nullable=True),
    sa.Column('push_clicked', sa.INTEGER(), nullable=True),
    sa.Column('workflow_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('workflow_completions', sa.INTEGER(), nullable=True),
    sa.Column('conversions', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['workflow_id'], ['marketing_workflows.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('automation_analytics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_automation_analytics_workflow_id'), ['workflow_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_automation_analytics_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_automation_analytics_date'), ['date'], unique=False)

    op.create_table('user_rewards',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('reward_id', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['reward_id'], ['rewards.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_rewards', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_rewards_id'), ['id'], unique=False)

    op.create_table('upsc_drills',
    sa.Column('id', sa.NUMERIC(), nullable=False),
    sa.Column('batch_id', sa.NUMERIC(), nullable=True),
    sa.Column('plan_id', sa.NUMERIC(), nullable=True),
    sa.Column('scheduled_at', sa.DATETIME(), nullable=False),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('created_by_id', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['batch_id'], ['upsc_batches.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['plan_id'], ['upsc_plans.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('email_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('template_id', sa.INTEGER(), nullable=True),
    sa.Column('recipient_email', sa.VARCHAR(), nullable=False),
    sa.Column('subject', sa.VARCHAR(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=7), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('body_html', sa.TEXT(), nullable=True),
    sa.Column('body_text', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['template_id'], ['email_templates.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('email_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_email_logs_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_email_logs_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_email_logs_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_email_logs_created_at'), ['created_at'], unique=False)

    op.create_table('chat_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('title', sa.VARCHAR(), nullable=True),
    sa.Column('context_type', sa.VARCHAR(), nullable=True),
    sa.Column('context_id', sa.INTEGER(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('chat_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_chat_sessions_id'), ['id'], unique=False)

    op.create_table('live_class_questions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('live_class_id', sa.INTEGER(), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('question_text', sa.TEXT(), nullable=False),
    sa.Column('is_answered', sa.BOOLEAN(), nullable=True),
    sa.Column('answer_text', sa.TEXT(), nullable=True),
    sa.Column('upvotes', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('answered_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['live_class_id'], ['live_classes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_class_questions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_class_questions_live_class_id'), ['live_class_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_questions_id'), ['id'], unique=False)

    op.create_table('exam_sessions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=True),
    sa.Column('exam_name', sa.VARCHAR(), nullable=True),
    sa.Column('start_time', sa.DATETIME(), nullable=True),
    sa.Column('end_time', sa.DATETIME(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), nullable=True),
    sa.Column('violations', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('exam_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_exam_sessions_id'), ['id'], unique=False)

    op.create_table('quiz_results',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('student_email', sa.VARCHAR(), nullable=False),
    sa.Column('segment_key', sa.VARCHAR(), nullable=False),
    sa.Column('score', sa.INTEGER(), nullable=False),
    sa.Column('total_questions', sa.INTEGER(), nullable=False),
    sa.Column('percentage', sa.FLOAT(), nullable=False),
    sa.Column('is_weak_spot', sa.BOOLEAN(), nullable=True),
    sa.Column('is_reviewed', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('quiz_results', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_quiz_results_student_email'), ['student_email'], unique=False)
        batch_op.create_index(batch_op.f('ix_quiz_results_segment_key'), ['segment_key'], unique=False)
        batch_op.create_index(batch_op.f('ix_quiz_results_id'), ['id'], unique=False)

    op.create_table('drill_sessions',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('question_id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('question_number', sa.INTEGER(), nullable=False),
    sa.Column('before_answer_text', sa.TEXT(), nullable=True),
    sa.Column('before_answer_image_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('after_answer_text', sa.TEXT(), nullable=True),
    sa.Column('after_answer_image_url', sa.VARCHAR(length=500), nullable=True),
    sa.Column('question_read_time', sa.INTEGER(), nullable=True),
    sa.Column('before_writing_time', sa.INTEGER(), nullable=True),
    sa.Column('content_reading_time', sa.INTEGER(), nullable=True),
    sa.Column('after_writing_time', sa.INTEGER(), nullable=True),
    sa.Column('model_answer_time', sa.INTEGER(), nullable=True),
    sa.Column('before_score', sa.INTEGER(), nullable=True),
    sa.Column('after_score', sa.INTEGER(), nullable=True),
    sa.Column('improvement', sa.INTEGER(), nullable=True),
    sa.Column('overall_score', sa.INTEGER(), nullable=True),
    sa.Column('report_data', sqlite.JSON(), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['question_id'], ['drill_questions.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('drill_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_drill_sessions_student_id'), ['student_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_drill_sessions_date'), ['date'], unique=False)

    op.create_table('affiliate_commissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('affiliate_id', sa.INTEGER(), nullable=False),
    sa.Column('referral_id', sa.INTEGER(), nullable=True),
    sa.Column('amount', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('commission_type', sa.VARCHAR(length=20), nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), nullable=False),
    sa.Column('payout_id', sa.INTEGER(), nullable=True),
    sa.Column('paid_at', sa.DATETIME(), nullable=True),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['affiliate_id'], ['affiliate_partners.id'], ),
    sa.ForeignKeyConstraint(['payout_id'], ['affiliate_payouts.id'], ),
    sa.ForeignKeyConstraint(['referral_id'], ['affiliate_referrals.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('affiliate_commissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_affiliate_commissions_referral_id'), ['referral_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_commissions_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_affiliate_commissions_affiliate_id'), ['affiliate_id'], unique=False)

    op.create_table('questions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('quiz_id', sa.INTEGER(), nullable=True),
    sa.Column('text', sa.TEXT(), nullable=False),
    sa.Column('type', sa.VARCHAR(), nullable=False),
    sa.Column('points', sa.INTEGER(), nullable=True),
    sa.Column('order_index', sa.INTEGER(), nullable=True),
    sa.Column('explanation', sa.TEXT(), nullable=True),
    sa.ForeignKeyConstraint(['quiz_id'], ['quizzes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('questions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_questions_id'), ['id'], unique=False)

    op.create_table('user_preferences',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('preferred_categories', sqlite.JSON(), nullable=True),
    sa.Column('preferred_difficulty', sa.VARCHAR(), nullable=True),
    sa.Column('preferred_duration', sa.VARCHAR(), nullable=True),
    sa.Column('learning_goals', sqlite.JSON(), nullable=True),
    sa.Column('interests', sqlite.JSON(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    with op.batch_alter_table('user_preferences', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_preferences_id'), ['id'], unique=False)

    op.create_table('message_logs',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('lead_id', sa.INTEGER(), nullable=True),
    sa.Column('workflow_execution_id', sa.INTEGER(), nullable=True),
    sa.Column('template_id', sa.INTEGER(), nullable=True),
    sa.Column('channel', sa.VARCHAR(), nullable=False),
    sa.Column('recipient', sa.VARCHAR(), nullable=False),
    sa.Column('subject', sa.VARCHAR(), nullable=True),
    sa.Column('body', sa.TEXT(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('sent_at', sa.DATETIME(), nullable=True),
    sa.Column('delivered_at', sa.DATETIME(), nullable=True),
    sa.Column('opened_at', sa.DATETIME(), nullable=True),
    sa.Column('clicked_at', sa.DATETIME(), nullable=True),
    sa.Column('replied_at', sa.DATETIME(), nullable=True),
    sa.Column('provider_message_id', sa.VARCHAR(), nullable=True),
    sa.Column('provider_response', sqlite.JSON(), nullable=True),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['lead_id'], ['leads.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['communication_templates.id'], ),
    sa.ForeignKeyConstraint(['workflow_execution_id'], ['workflow_executions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('message_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_message_logs_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_message_logs_lead_id'), ['lead_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_message_logs_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_message_logs_channel'), ['channel'], unique=False)

    op.create_table('leads',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('email', sa.VARCHAR(), nullable=False),
    sa.Column('phone', sa.VARCHAR(), nullable=True),
    sa.Column('status', sa.VARCHAR(), nullable=True),
    sa.Column('source_primary', sa.VARCHAR(), nullable=True),
    sa.Column('source_secondary', sa.VARCHAR(), nullable=True),
    sa.Column('source_tertiary', sa.VARCHAR(), nullable=True),
    sa.Column('assigned_to_id', sa.INTEGER(), nullable=True),
    sa.Column('is_verified', sa.BOOLEAN(), nullable=True),
    sa.Column('verification_method', sa.VARCHAR(), nullable=True),
    sa.Column('intent_score', sa.FLOAT(), nullable=True),
    sa.Column('location_latitude', sa.FLOAT(), nullable=True),
    sa.Column('location_longitude', sa.FLOAT(), nullable=True),
    sa.Column('location_address', sa.VARCHAR(), nullable=True),
    sa.Column('notes', sa.TEXT(), nullable=True),
    sa.Column('last_activity', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['assigned_to_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('leads', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_leads_source_primary'), ['source_primary'], unique=False)
        batch_op.create_index(batch_op.f('ix_leads_phone'), ['phone'], unique=False)
        batch_op.create_index(batch_op.f('ix_leads_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_leads_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_leads_email'), ['email'], unique=False)

    op.create_table('drill_daily_summaries',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('student_id', sa.INTEGER(), nullable=False),
    sa.Column('date', sa.DATE(), nullable=False),
    sa.Column('overall_score', sa.INTEGER(), nullable=True),
    sa.Column('average_improvement', sa.INTEGER(), nullable=True),
    sa.Column('total_time_spent', sa.INTEGER(), nullable=True),
    sa.Column('question_scores', sqlite.JSON(), nullable=True),
    sa.Column('comparison_data', sqlite.JSON(), nullable=True),
    sa.Column('strengths', sqlite.JSON(), nullable=True),
    sa.Column('challenges', sqlite.JSON(), nullable=True),
    sa.Column('recommendations', sqlite.JSON(), nullable=True),
    sa.Column('insights', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('drill_daily_summaries', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_drill_daily_summaries_student_id'), ['student_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_drill_daily_summaries_date'), ['date'], unique=False)

    op.create_table('chat_feedback',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('message_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('rating', sa.INTEGER(), nullable=True),
    sa.Column('is_helpful', sa.BOOLEAN(), nullable=True),
    sa.Column('feedback_text', sa.TEXT(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['message_id'], ['chatbot_messages.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('chat_feedback', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_chat_feedback_id'), ['id'], unique=False)

    op.create_table('drill_questions',
    sa.Column('id', sa.VARCHAR(length=36), nullable=False),
    sa.Column('gs_paper', sa.VARCHAR(length=10), nullable=False),
    sa.Column('topic', sa.VARCHAR(length=255), nullable=False),
    sa.Column('sub_topic', sa.VARCHAR(length=255), nullable=True),
    sa.Column('question_text', sa.TEXT(), nullable=False),
    sa.Column('key_points', sqlite.JSON(), nullable=True),
    sa.Column('difficulty', sa.VARCHAR(length=20), nullable=True),
    sa.Column('created_by', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('drill_questions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_drill_questions_topic'), ['topic'], unique=False)
        batch_op.create_index(batch_op.f('ix_drill_questions_gs_paper'), ['gs_paper'], unique=False)

    op.create_table('bank_questions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('text', sa.TEXT(), nullable=False),
    sa.Column('type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('points', sa.INTEGER(), nullable=True),
    sa.Column('difficulty', sa.VARCHAR(length=20), nullable=True),
    sa.Column('options', sa.TEXT(), nullable=True),
    sa.Column('correct_answer', sa.TEXT(), nullable=True),
    sa.Column('explanation', sa.TEXT(), nullable=True),
    sa.Column('tags', sa.TEXT(), nullable=True),
    sa.Column('usage_count', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('bank_questions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_bank_questions_id'), ['id'], unique=False)

    op.create_table('certificate_templates',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('name', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('background_url', sa.VARCHAR(), nullable=True),
    sa.Column('background_color', sa.VARCHAR(), nullable=True),
    sa.Column('layout', sqlite.JSON(), nullable=True),
    sa.Column('title_font', sa.VARCHAR(), nullable=True),
    sa.Column('title_font_size', sa.INTEGER(), nullable=True),
    sa.Column('title_color', sa.VARCHAR(), nullable=True),
    sa.Column('body_font', sa.VARCHAR(), nullable=True),
    sa.Column('body_font_size', sa.INTEGER(), nullable=True),
    sa.Column('body_color', sa.VARCHAR(), nullable=True),
    sa.Column('border_style', sa.VARCHAR(), nullable=True),
    sa.Column('border_color', sa.VARCHAR(), nullable=True),
    sa.Column('logo_url', sa.VARCHAR(), nullable=True),
    sa.Column('signature_url', sa.VARCHAR(), nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), nullable=True),
    sa.Column('is_public', sa.BOOLEAN(), nullable=True),
    sa.Column('creator_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['creator_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('certificate_templates', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_certificate_templates_id'), ['id'], unique=False)

    op.create_table('order_items',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('order_id', sa.INTEGER(), nullable=False),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('bundle_id', sa.INTEGER(), nullable=True),
    sa.Column('item_name', sa.VARCHAR(length=500), nullable=False),
    sa.Column('item_description', sa.TEXT(), nullable=True),
    sa.Column('quantity', sa.INTEGER(), nullable=False),
    sa.Column('unit_price', sa.FLOAT(), nullable=False),
    sa.Column('discount', sa.FLOAT(), nullable=False),
    sa.Column('total', sa.FLOAT(), nullable=False),
    sa.Column('coupon_code', sa.VARCHAR(length=50), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['bundle_id'], ['course_bundles.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('order_items', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_order_items_order_id'), ['order_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_order_items_id'), ['id'], unique=False)

    op.create_table('ai_conversations',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=True),
    sa.Column('context', sa.VARCHAR(), nullable=True),
    sa.Column('messages', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_conversations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_conversations_id'), ['id'], unique=False)

    op.create_table('live_class_chat_messages',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('live_class_id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('message', sa.TEXT(), nullable=False),
    sa.Column('is_instructor', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['live_class_id'], ['live_classes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_class_chat_messages', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_class_chat_messages_live_class_id'), ['live_class_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_class_chat_messages_id'), ['id'], unique=False)

    op.create_table('meditation_progress',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('current_level', sa.INTEGER(), nullable=True),
    sa.Column('current_day', sa.INTEGER(), nullable=True),
    sa.Column('total_streak', sa.INTEGER(), nullable=True),
    sa.Column('preferred_session', sa.VARCHAR(length=20), nullable=True),
    sa.Column('last_practice_date', sa.DATETIME(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('meditation_progress', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_meditation_progress_id'), ['id'], unique=False)

    op.create_table('role_permissions',
    sa.Column('role_id', sa.INTEGER(), nullable=False),
    sa.Column('permission_id', sa.INTEGER(), nullable=False),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['permission_id'], ['permissions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('role_id', 'permission_id')
    )
    op.create_table('bundle_enrollments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('bundle_id', sa.INTEGER(), nullable=False),
    sa.Column('enrolled_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('price_paid', sa.NUMERIC(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.VARCHAR(length=3), nullable=True),
    sa.Column('payment_id', sa.VARCHAR(length=100), nullable=True),
    sa.Column('payment_status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('coupon_code', sa.VARCHAR(length=50), nullable=True),
    sa.Column('discount_applied', sa.NUMERIC(precision=10, scale=2), nullable=True),
    sa.Column('courses_completed', sa.INTEGER(), nullable=True),
    sa.Column('completion_percentage', sa.NUMERIC(precision=5, scale=2), nullable=True),
    sa.Column('completed_at', sa.DATETIME(), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['bundle_id'], ['course_bundles.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('bundle_enrollments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_bundle_enrollments_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_bundle_enrollments_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_bundle_enrollments_bundle_id'), ['bundle_id'], unique=False)

    op.create_table('user_permissions',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('can_view_leads', sa.BOOLEAN(), nullable=True),
    sa.Column('can_edit_leads', sa.BOOLEAN(), nullable=True),
    sa.Column('can_delete_leads', sa.BOOLEAN(), nullable=True),
    sa.Column('can_reassign_leads', sa.BOOLEAN(), nullable=True),
    sa.Column('can_export_leads', sa.BOOLEAN(), nullable=True),
    sa.Column('can_manage_users', sa.BOOLEAN(), nullable=True),
    sa.Column('can_view_activity_logs', sa.BOOLEAN(), nullable=True),
    sa.Column('can_manage_permissions', sa.BOOLEAN(), nullable=True),
    sa.Column('can_send_emails', sa.BOOLEAN(), nullable=True),
    sa.Column('can_send_sms', sa.BOOLEAN(), nullable=True),
    sa.Column('can_make_calls', sa.BOOLEAN(), nullable=True),
    sa.Column('can_view_reports', sa.BOOLEAN(), nullable=True),
    sa.Column('can_export_reports', sa.BOOLEAN(), nullable=True),
    sa.Column('can_view_analytics', sa.BOOLEAN(), nullable=True),
    sa.Column('can_view_payments', sa.BOOLEAN(), nullable=True),
    sa.Column('can_process_refunds', sa.BOOLEAN(), nullable=True),
    sa.Column('custom_permissions', sqlite.JSON(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_permissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_permissions_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_permissions_id'), ['id'], unique=False)

    op.create_table('user_achievements',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('user_id', sa.INTEGER(), nullable=False),
    sa.Column('achievement_id', sa.INTEGER(), nullable=False),
    sa.Column('progress', sa.INTEGER(), nullable=True),
    sa.Column('unlocked_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('notified', sa.BOOLEAN(), nullable=True),
    sa.ForeignKeyConstraint(['achievement_id'], ['achievements.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('user_achievements', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_user_achievements_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_achievements_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_achievements_achievement_id'), ['achievement_id'], unique=False)

    op.create_table('courses',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('slug', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('long_description', sa.TEXT(), nullable=True),
    sa.Column('thumbnail_url', sa.VARCHAR(), nullable=True),
    sa.Column('preview_video_url', sa.VARCHAR(), nullable=True),
    sa.Column('instructor_id', sa.INTEGER(), nullable=False),
    sa.Column('category_id', sa.INTEGER(), nullable=True),
    sa.Column('level', sa.VARCHAR(length=12), nullable=True),
    sa.Column('prerequisites', sqlite.JSON(), nullable=True),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('is_featured', sa.BOOLEAN(), nullable=True),
    sa.Column('is_password_protected', sa.BOOLEAN(), nullable=True),
    sa.Column('password_hash', sa.VARCHAR(), nullable=True),
    sa.Column('price', sa.FLOAT(), nullable=True),
    sa.Column('currency', sa.VARCHAR(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.Column('published_at', sa.DATETIME(), nullable=True),
    sa.Column('total_enrollments', sa.INTEGER(), nullable=True),
    sa.Column('average_rating', sa.FLOAT(), nullable=True),
    sa.Column('total_reviews', sa.INTEGER(), nullable=True),
    sa.Column('total_duration_minutes', sa.INTEGER(), nullable=True),
    sa.ForeignKeyConstraint(['category_id'], ['categories.id'], ),
    sa.ForeignKeyConstraint(['instructor_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('courses', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_courses_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_courses_slug'), ['slug'], unique=1)
        batch_op.create_index(batch_op.f('ix_courses_level'), ['level'], unique=False)
        batch_op.create_index(batch_op.f('ix_courses_is_published'), ['is_published'], unique=False)
        batch_op.create_index(batch_op.f('ix_courses_instructor_id'), ['instructor_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_courses_id'), ['id'], unique=False)
        batch_op.create_index(batch_op.f('ix_courses_category_id'), ['category_id'], unique=False)

    op.create_table('project_milestones',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('project_id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(length=200), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('due_date', sa.DATETIME(), nullable=True),
    sa.Column('is_completed', sa.BOOLEAN(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['collaborative_projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('project_milestones', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_project_milestones_id'), ['id'], unique=False)

    op.create_table('assignments',
    sa.Column('id', sa.INTEGER(), nullable=False),
    sa.Column('title', sa.VARCHAR(), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('course_id', sa.INTEGER(), nullable=True),
    sa.Column('lesson_id', sa.INTEGER(), nullable=True),
    sa.Column('max_points', sa.FLOAT(), nullable=True),
    sa.Column('due_date', sa.DATETIME(), nullable=True),
    sa.Column('allow_late_submission', sa.BOOLEAN(), nullable=True),
    sa.Column('late_penalty_per_day', sa.FLOAT(), nullable=True),
    sa.Column('is_published', sa.BOOLEAN(), nullable=True),
    sa.Column('file_upload_required', sa.BOOLEAN(), nullable=True),
    sa.Column('allowed_file_types', sqlite.JSON(), nullable=True),
    sa.Column('max_file_size_mb', sa.INTEGER(), nullable=True),
    sa.Column('created_at', sa.DATETIME(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DATETIME(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['lesson_id'], ['lessons.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('assignments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_assignments_title'), ['title'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_id'), ['id'], unique=False)

    # ### end Alembic commands ###
