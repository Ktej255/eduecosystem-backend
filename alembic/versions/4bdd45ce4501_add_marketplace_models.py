"""Add marketplace models

Revision ID: 4bdd45ce4501
Revises: add_translation_models_v2
Create Date: 2025-11-26 09:37:33.784609

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import sqlite

# revision identifiers, used by Alembic.
revision: str = "4bdd45ce4501"
down_revision: Union[str, Sequence[str], None] = "add_translation_models_v2"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "platform_analytics",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("date", sa.Date(), nullable=False),
        sa.Column("total_users", sa.Integer(), nullable=True),
        sa.Column("active_users", sa.Integer(), nullable=True),
        sa.Column("new_users", sa.Integer(), nullable=True),
        sa.Column("dau", sa.Integer(), nullable=True),
        sa.Column("mau", sa.Integer(), nullable=True),
        sa.Column("wau", sa.Integer(), nullable=True),
        sa.Column("total_students", sa.Integer(), nullable=True),
        sa.Column("total_instructors", sa.Integer(), nullable=True),
        sa.Column("new_students", sa.Integer(), nullable=True),
        sa.Column("new_instructors", sa.Integer(), nullable=True),
        sa.Column("total_courses", sa.Integer(), nullable=True),
        sa.Column("active_courses", sa.Integer(), nullable=True),
        sa.Column("published_courses", sa.Integer(), nullable=True),
        sa.Column("new_courses", sa.Integer(), nullable=True),
        sa.Column("total_enrollments", sa.Integer(), nullable=True),
        sa.Column("enrollments_today", sa.Integer(), nullable=True),
        sa.Column("active_enrollments", sa.Integer(), nullable=True),
        sa.Column("completions_today", sa.Integer(), nullable=True),
        sa.Column("total_completions", sa.Integer(), nullable=True),
        sa.Column("revenue_today", sa.Float(), nullable=True),
        sa.Column("revenue_mtd", sa.Float(), nullable=True),
        sa.Column("total_revenue", sa.Float(), nullable=True),
        sa.Column("mrr", sa.Float(), nullable=True),
        sa.Column("arr", sa.Float(), nullable=True),
        sa.Column("quiz_attempts", sa.Integer(), nullable=True),
        sa.Column("assignments_submitted", sa.Integer(), nullable=True),
        sa.Column("discussion_posts", sa.Integer(), nullable=True),
        sa.Column("live_class_attendees", sa.Integer(), nullable=True),
        sa.Column("certificates_issued", sa.Integer(), nullable=True),
        sa.Column("total_lessons", sa.Integer(), nullable=True),
        sa.Column("total_quizzes", sa.Integer(), nullable=True),
        sa.Column("total_assignments", sa.Integer(), nullable=True),
        sa.Column("video_hours_watched", sa.Float(), nullable=True),
        sa.Column("avg_response_time", sa.Float(), nullable=True),
        sa.Column("error_rate", sa.Float(), nullable=True),
        sa.Column("uptime", sa.Float(), nullable=True),
        sa.Column("avg_course_rating", sa.Float(), nullable=True),
        sa.Column("total_reviews", sa.Integer(), nullable=True),
        sa.Column("new_reviews", sa.Integer(), nullable=True),
        sa.Column("user_growth_rate", sa.Float(), nullable=True),
        sa.Column("revenue_growth_rate", sa.Float(), nullable=True),
        sa.Column("enrollment_growth_rate", sa.Float(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=False,
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_platform_analytics_date"), "platform_analytics", ["date"], unique=True
    )
    op.create_index(
        op.f("ix_platform_analytics_id"), "platform_analytics", ["id"], unique=False
    )
    op.create_table(
        "subscription_coupons",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("code", sa.String(length=50), nullable=False),
        sa.Column("name", sa.String(length=100), nullable=False),
        sa.Column("description", sa.Text(), nullable=True),
        sa.Column("discount_type", sa.String(length=20), nullable=False),
        sa.Column("discount_value", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("currency", sa.String(length=3), nullable=True),
        sa.Column("applies_to_plans", sa.Text(), nullable=True),
        sa.Column("duration", sa.String(length=20), nullable=False),
        sa.Column("duration_months", sa.Integer(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=True),
        sa.Column("valid_from", sa.DateTime(timezone=True), nullable=True),
        sa.Column("valid_until", sa.DateTime(timezone=True), nullable=True),
        sa.Column("max_redemptions", sa.Integer(), nullable=True),
        sa.Column("max_redemptions_per_user", sa.Integer(), nullable=True),
        sa.Column("times_redeemed", sa.Integer(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_subscription_coupons_code"),
        "subscription_coupons",
        ["code"],
        unique=True,
    )
    op.create_index(
        op.f("ix_subscription_coupons_id"), "subscription_coupons", ["id"], unique=False
    )
    op.create_table(
        "subscription_plans",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sa.String(length=100), nullable=False),
        sa.Column("slug", sa.String(length=100), nullable=False),
        sa.Column("description", sa.Text(), nullable=True),
        sa.Column("short_description", sa.String(length=500), nullable=True),
        sa.Column("monthly_price", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("yearly_price", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("currency", sa.String(length=3), nullable=True),
        sa.Column("trial_days", sa.Integer(), nullable=True),
        sa.Column("access_level", sa.String(length=20), nullable=True),
        sa.Column("max_courses", sa.Integer(), nullable=True),
        sa.Column("max_live_classes", sa.Integer(), nullable=True),
        sa.Column("features", sa.Text(), nullable=True),
        sa.Column("included_features", sa.Text(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=True),
        sa.Column("is_featured", sa.Boolean(), nullable=True),
        sa.Column("is_popular", sa.Boolean(), nullable=True),
        sa.Column("display_order", sa.Integer(), nullable=True),
        sa.Column("stripe_price_id_monthly", sa.String(length=100), nullable=True),
        sa.Column("stripe_price_id_yearly", sa.String(length=100), nullable=True),
        sa.Column("stripe_product_id", sa.String(length=100), nullable=True),
        sa.Column("total_subscriptions", sa.Integer(), nullable=True),
        sa.Column("active_subscriptions", sa.Integer(), nullable=True),
        sa.Column("total_revenue", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("name"),
    )
    op.create_index(
        op.f("ix_subscription_plans_id"), "subscription_plans", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_subscription_plans_slug"), "subscription_plans", ["slug"], unique=True
    )
    op.create_table(
        "affiliate_partners",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("referral_code", sa.String(length=50), nullable=False),
        sa.Column("custom_slug", sa.String(length=100), nullable=True),
        sa.Column(
            "commission_percentage", sa.Numeric(precision=5, scale=2), nullable=True
        ),
        sa.Column("commission_tier", sa.String(length=20), nullable=True),
        sa.Column("total_earnings", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("pending_earnings", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("paid_earnings", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("total_clicks", sa.Integer(), nullable=True),
        sa.Column("total_conversions", sa.Integer(), nullable=True),
        sa.Column("conversion_rate", sa.Numeric(precision=5, scale=2), nullable=True),
        sa.Column("status", sa.String(length=20), nullable=True),
        sa.Column("is_verified", sa.Boolean(), nullable=True),
        sa.Column("minimum_payout", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("payout_method", sa.String(length=20), nullable=True),
        sa.Column("payout_email", sa.String(length=255), nullable=True),
        sa.Column("last_click_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("last_conversion_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("last_payout_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("notes", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("custom_slug"),
    )
    op.create_index(
        op.f("ix_affiliate_partners_id"), "affiliate_partners", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_affiliate_partners_referral_code"),
        "affiliate_partners",
        ["referral_code"],
        unique=True,
    )
    op.create_index(
        op.f("ix_affiliate_partners_user_id"),
        "affiliate_partners",
        ["user_id"],
        unique=True,
    )
    op.create_table(
        "instructor_payment_info",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("instructor_id", sa.Integer(), nullable=False),
        sa.Column("stripe_account_id", sa.String(length=100), nullable=True),
        sa.Column("paypal_email", sa.String(length=255), nullable=True),
        sa.Column("bank_account_encrypted", sa.Text(), nullable=True),
        sa.Column("tax_country", sa.String(length=2), nullable=True),
        sa.Column("tax_id", sa.String(length=50), nullable=True),
        sa.Column("tax_form_type", sa.String(length=20), nullable=True),
        sa.Column("tax_form_submitted", sa.Boolean(), nullable=True),
        sa.Column("tax_form_verified", sa.Boolean(), nullable=True),
        sa.Column(
            "minimum_payout_amount", sa.Numeric(precision=10, scale=2), nullable=True
        ),
        sa.Column("payout_frequency", sa.String(length=20), nullable=True),
        sa.Column("verified", sa.Boolean(), nullable=True),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["instructor_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_instructor_payment_info_id"),
        "instructor_payment_info",
        ["id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_instructor_payment_info_instructor_id"),
        "instructor_payment_info",
        ["instructor_id"],
        unique=True,
    )
    op.create_table(
        "instructor_payouts",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("instructor_id", sa.Integer(), nullable=False),
        sa.Column("amount", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("currency", sa.String(length=3), nullable=False),
        sa.Column("status", sa.String(length=20), nullable=False),
        sa.Column("payment_method", sa.String(length=20), nullable=False),
        sa.Column("payment_details", sa.Text(), nullable=True),
        sa.Column("stripe_transfer_id", sa.String(length=100), nullable=True),
        sa.Column("transaction_id", sa.String(length=100), nullable=True),
        sa.Column(
            "requested_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("processed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("admin_notes", sa.Text(), nullable=True),
        sa.Column("failure_reason", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["instructor_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_instructor_payouts_id"), "instructor_payouts", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_instructor_payouts_instructor_id"),
        "instructor_payouts",
        ["instructor_id"],
        unique=False,
    )
    op.create_table(
        "user_subscriptions",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("plan_id", sa.Integer(), nullable=False),
        sa.Column("billing_cycle", sa.String(length=20), nullable=False),
        sa.Column("status", sa.String(length=20), nullable=False),
        sa.Column(
            "started_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("trial_ends_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("current_period_start", sa.DateTime(timezone=True), nullable=True),
        sa.Column("current_period_end", sa.DateTime(timezone=True), nullable=True),
        sa.Column("cancelled_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("ended_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("stripe_subscription_id", sa.String(length=100), nullable=True),
        sa.Column("stripe_customer_id", sa.String(length=100), nullable=True),
        sa.Column("stripe_latest_invoice", sa.String(length=100), nullable=True),
        sa.Column("price_paid", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("currency", sa.String(length=3), nullable=True),
        sa.Column("auto_renew", sa.Boolean(), nullable=True),
        sa.Column("cancel_at_period_end", sa.Boolean(), nullable=True),
        sa.Column("last_payment_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("next_payment_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("payment_failed_count", sa.Integer(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["plan_id"],
            ["subscription_plans.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_user_subscriptions_id"), "user_subscriptions", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_user_subscriptions_plan_id"),
        "user_subscriptions",
        ["plan_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_user_subscriptions_stripe_subscription_id"),
        "user_subscriptions",
        ["stripe_subscription_id"],
        unique=True,
    )
    op.create_index(
        op.f("ix_user_subscriptions_user_id"),
        "user_subscriptions",
        ["user_id"],
        unique=False,
    )
    op.create_table(
        "affiliate_clicks",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("affiliate_id", sa.Integer(), nullable=False),
        sa.Column("referral_code", sa.String(length=50), nullable=False),
        sa.Column("ip_address", sa.String(length=45), nullable=True),
        sa.Column("user_agent", sa.Text(), nullable=True),
        sa.Column("referrer_url", sa.String(length=500), nullable=True),
        sa.Column("landing_url", sa.String(length=500), nullable=True),
        sa.Column("tracking_cookie", sa.String(length=100), nullable=True),
        sa.Column("cookie_expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("converted", sa.Boolean(), nullable=True),
        sa.Column("converted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("conversion_value", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("country", sa.String(length=2), nullable=True),
        sa.Column("city", sa.String(length=100), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.ForeignKeyConstraint(
            ["affiliate_id"],
            ["affiliate_partners.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_affiliate_clicks_affiliate_id"),
        "affiliate_clicks",
        ["affiliate_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_affiliate_clicks_id"), "affiliate_clicks", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_affiliate_clicks_referral_code"),
        "affiliate_clicks",
        ["referral_code"],
        unique=False,
    )
    op.create_index(
        op.f("ix_affiliate_clicks_tracking_cookie"),
        "affiliate_clicks",
        ["tracking_cookie"],
        unique=True,
    )
    op.create_table(
        "affiliate_payouts",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("affiliate_id", sa.Integer(), nullable=False),
        sa.Column("amount", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("currency", sa.String(length=3), nullable=True),
        sa.Column("payment_method", sa.String(length=20), nullable=False),
        sa.Column("payment_details", sa.Text(), nullable=True),
        sa.Column("status", sa.String(length=20), nullable=False),
        sa.Column("stripe_transfer_id", sa.String(length=100), nullable=True),
        sa.Column("paypal_transaction_id", sa.String(length=100), nullable=True),
        sa.Column("transaction_id", sa.String(length=100), nullable=True),
        sa.Column(
            "requested_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("processed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("admin_notes", sa.Text(), nullable=True),
        sa.Column("failure_reason", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["affiliate_id"],
            ["affiliate_partners.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_affiliate_payouts_affiliate_id"),
        "affiliate_payouts",
        ["affiliate_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_affiliate_payouts_id"), "affiliate_payouts", ["id"], unique=False
    )
    op.create_table(
        "affiliate_referrals",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("affiliate_id", sa.Integer(), nullable=False),
        sa.Column("referred_user_id", sa.Integer(), nullable=False),
        sa.Column("referral_code", sa.String(length=50), nullable=False),
        sa.Column("tracking_cookie", sa.String(length=100), nullable=True),
        sa.Column("purchase_type", sa.String(length=20), nullable=False),
        sa.Column("purchase_id", sa.Integer(), nullable=False),
        sa.Column("purchase_amount", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column(
            "commission_percentage", sa.Numeric(precision=5, scale=2), nullable=False
        ),
        sa.Column(
            "commission_amount", sa.Numeric(precision=10, scale=2), nullable=False
        ),
        sa.Column("commission_status", sa.String(length=20), nullable=True),
        sa.Column("payment_id", sa.String(length=100), nullable=True),
        sa.Column("first_click_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "conversion_date",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("is_refunded", sa.Boolean(), nullable=True),
        sa.Column("refunded_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["affiliate_id"],
            ["affiliate_partners.id"],
        ),
        sa.ForeignKeyConstraint(
            ["referred_user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_affiliate_referrals_affiliate_id"),
        "affiliate_referrals",
        ["affiliate_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_affiliate_referrals_id"), "affiliate_referrals", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_affiliate_referrals_referred_user_id"),
        "affiliate_referrals",
        ["referred_user_id"],
        unique=False,
    )
    op.create_table(
        "analytics_events",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("event_type", sa.String(length=50), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=True),
        sa.Column("course_id", sa.Integer(), nullable=True),
        sa.Column("event_data", sa.Text(), nullable=True),
        sa.Column("session_id", sa.String(length=100), nullable=True),
        sa.Column("ip_address", sa.String(length=45), nullable=True),
        sa.Column("user_agent", sa.String(length=500), nullable=True),
        sa.Column(
            "timestamp",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=False,
        ),
        sa.ForeignKeyConstraint(["course_id"], ["courses.id"], ondelete="SET NULL"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="SET NULL"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_analytics_events_event_type"),
        "analytics_events",
        ["event_type"],
        unique=False,
    )
    op.create_index(
        op.f("ix_analytics_events_id"), "analytics_events", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_analytics_events_timestamp"),
        "analytics_events",
        ["timestamp"],
        unique=False,
    )
    op.create_table(
        "instructor_analytics",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("instructor_id", sa.Integer(), nullable=False),
        sa.Column("course_id", sa.Integer(), nullable=False),
        sa.Column("date", sa.Date(), nullable=False),
        sa.Column("total_students", sa.Integer(), nullable=True),
        sa.Column("active_students", sa.Integer(), nullable=True),
        sa.Column("new_enrollments", sa.Integer(), nullable=True),
        sa.Column("completions", sa.Integer(), nullable=True),
        sa.Column("avg_progress", sa.Float(), nullable=True),
        sa.Column("avg_quiz_score", sa.Float(), nullable=True),
        sa.Column("quiz_attempts", sa.Integer(), nullable=True),
        sa.Column("assignments_submitted", sa.Integer(), nullable=True),
        sa.Column("avg_assignment_score", sa.Float(), nullable=True),
        sa.Column("total_revenue", sa.Float(), nullable=True),
        sa.Column("new_revenue", sa.Float(), nullable=True),
        sa.Column("refunds", sa.Integer(), nullable=True),
        sa.Column("refund_amount", sa.Float(), nullable=True),
        sa.Column("total_time_spent", sa.Integer(), nullable=True),
        sa.Column("avg_session_duration", sa.Float(), nullable=True),
        sa.Column("discussion_posts", sa.Integer(), nullable=True),
        sa.Column("questions_asked", sa.Integer(), nullable=True),
        sa.Column("peer_reviews_completed", sa.Integer(), nullable=True),
        sa.Column("avg_rating", sa.Float(), nullable=True),
        sa.Column("new_reviews", sa.Integer(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=False,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(["course_id"], ["courses.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["instructor_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sqlite_autoincrement=True,
    )
    op.create_index(
        op.f("ix_instructor_analytics_date"),
        "instructor_analytics",
        ["date"],
        unique=False,
    )
    op.create_index(
        op.f("ix_instructor_analytics_id"), "instructor_analytics", ["id"], unique=False
    )
    op.create_table(
        "marketplace_listings",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("course_id", sa.Integer(), nullable=False),
        sa.Column("is_published", sa.Boolean(), nullable=True),
        sa.Column("is_featured", sa.Boolean(), nullable=True),
        sa.Column("is_promoted", sa.Boolean(), nullable=True),
        sa.Column("marketplace_category", sa.String(length=100), nullable=True),
        sa.Column("target_audience", sa.String(length=255), nullable=True),
        sa.Column("learning_outcomes", sa.Text(), nullable=True),
        sa.Column("prerequisites", sa.Text(), nullable=True),
        sa.Column("seo_title", sa.String(length=255), nullable=True),
        sa.Column("seo_description", sa.Text(), nullable=True),
        sa.Column("seo_keywords", sa.Text(), nullable=True),
        sa.Column("featured_until", sa.DateTime(timezone=True), nullable=True),
        sa.Column("promotion_start", sa.DateTime(timezone=True), nullable=True),
        sa.Column("promotion_end", sa.DateTime(timezone=True), nullable=True),
        sa.Column("view_count", sa.Integer(), nullable=True),
        sa.Column("click_count", sa.Integer(), nullable=True),
        sa.Column("conversion_rate", sa.Numeric(precision=5, scale=2), nullable=True),
        sa.Column("quality_score", sa.Numeric(precision=3, scale=2), nullable=True),
        sa.Column("marketplace_rank", sa.Integer(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["course_id"],
            ["courses.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_marketplace_listings_course_id"),
        "marketplace_listings",
        ["course_id"],
        unique=True,
    )
    op.create_index(
        op.f("ix_marketplace_listings_id"), "marketplace_listings", ["id"], unique=False
    )
    op.create_table(
        "revenue_shares",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("course_id", sa.Integer(), nullable=False),
        sa.Column("instructor_id", sa.Integer(), nullable=False),
        sa.Column(
            "platform_fee_percentage", sa.Numeric(precision=5, scale=2), nullable=False
        ),
        sa.Column(
            "instructor_percentage", sa.Numeric(precision=5, scale=2), nullable=False
        ),
        sa.Column("total_revenue", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column(
            "platform_earnings", sa.Numeric(precision=10, scale=2), nullable=False
        ),
        sa.Column(
            "instructor_earnings", sa.Numeric(precision=10, scale=2), nullable=False
        ),
        sa.Column("pending_payout", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("total_enrollments", sa.Integer(), nullable=True),
        sa.Column("last_sale_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("last_payout_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["course_id"],
            ["courses.id"],
        ),
        sa.ForeignKeyConstraint(
            ["instructor_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_revenue_shares_course_id"),
        "revenue_shares",
        ["course_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_revenue_shares_id"), "revenue_shares", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_revenue_shares_instructor_id"),
        "revenue_shares",
        ["instructor_id"],
        unique=False,
    )
    op.create_table(
        "revenue_transactions",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("course_id", sa.Integer(), nullable=False),
        sa.Column("instructor_id", sa.Integer(), nullable=False),
        sa.Column("student_id", sa.Integer(), nullable=False),
        sa.Column("transaction_type", sa.String(length=20), nullable=False),
        sa.Column("total_amount", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("platform_fee", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column(
            "instructor_earnings", sa.Numeric(precision=10, scale=2), nullable=False
        ),
        sa.Column("payment_id", sa.String(length=100), nullable=True),
        sa.Column("stripe_payment_intent", sa.String(length=100), nullable=True),
        sa.Column("is_refunded", sa.Boolean(), nullable=True),
        sa.Column("refunded_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("refund_amount", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("coupon_code", sa.String(length=50), nullable=True),
        sa.Column("discount_amount", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column("affiliate_id", sa.Integer(), nullable=True),
        sa.Column(
            "affiliate_commission", sa.Numeric(precision=10, scale=2), nullable=True
        ),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.ForeignKeyConstraint(
            ["affiliate_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["course_id"],
            ["courses.id"],
        ),
        sa.ForeignKeyConstraint(
            ["instructor_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["student_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_revenue_transactions_course_id"),
        "revenue_transactions",
        ["course_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_revenue_transactions_id"), "revenue_transactions", ["id"], unique=False
    )
    op.create_index(
        op.f("ix_revenue_transactions_instructor_id"),
        "revenue_transactions",
        ["instructor_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_revenue_transactions_student_id"),
        "revenue_transactions",
        ["student_id"],
        unique=False,
    )
    op.create_table(
        "student_analytics",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("course_id", sa.Integer(), nullable=False),
        sa.Column("preferred_time_slot", sa.String(length=20), nullable=True),
        sa.Column("avg_session_duration", sa.Float(), nullable=True),
        sa.Column("total_time_spent", sa.Integer(), nullable=True),
        sa.Column("sessions_count", sa.Integer(), nullable=True),
        sa.Column("last_active", sa.DateTime(timezone=True), nullable=True),
        sa.Column("video_completion_rate", sa.Float(), nullable=True),
        sa.Column("reading_completion_rate", sa.Float(), nullable=True),
        sa.Column("quiz_preference", sa.Float(), nullable=True),
        sa.Column("discussion_engagement", sa.Float(), nullable=True),
        sa.Column("completion_rate", sa.Float(), nullable=True),
        sa.Column("avg_quiz_score", sa.Float(), nullable=True),
        sa.Column("quiz_attempts", sa.Integer(), nullable=True),
        sa.Column("assignments_completed", sa.Integer(), nullable=True),
        sa.Column("avg_assignment_score", sa.Float(), nullable=True),
        sa.Column("discussion_posts", sa.Integer(), nullable=True),
        sa.Column("questions_asked", sa.Integer(), nullable=True),
        sa.Column("peer_reviews_given", sa.Integer(), nullable=True),
        sa.Column("notes_created", sa.Integer(), nullable=True),
        sa.Column("bookmarks_created", sa.Integer(), nullable=True),
        sa.Column("estimated_completion_date", sa.Date(), nullable=True),
        sa.Column("estimated_days_to_complete", sa.Integer(), nullable=True),
        sa.Column("at_risk_flag", sa.Boolean(), nullable=True),
        sa.Column("engagement_score", sa.Float(), nullable=True),
        sa.Column("progress_percentile", sa.Float(), nullable=True),
        sa.Column("performance_percentile", sa.Float(), nullable=True),
        sa.Column("engagement_percentile", sa.Float(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=False,
        ),
        sa.Column("last_calculated", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(["course_id"], ["courses.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_student_analytics_id"), "student_analytics", ["id"], unique=False
    )
    op.create_table(
        "subscription_invoices",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("subscription_id", sa.Integer(), nullable=False),
        sa.Column("invoice_number", sa.String(length=50), nullable=True),
        sa.Column("amount", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("currency", sa.String(length=3), nullable=True),
        sa.Column("status", sa.String(length=20), nullable=False),
        sa.Column("stripe_invoice_id", sa.String(length=100), nullable=True),
        sa.Column("stripe_payment_intent", sa.String(length=100), nullable=True),
        sa.Column(
            "invoice_date",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("due_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("paid_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("invoice_pdf_url", sa.String(length=500), nullable=True),
        sa.Column("description", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["subscription_id"],
            ["user_subscriptions.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("invoice_number"),
        sa.UniqueConstraint("stripe_invoice_id"),
    )
    op.create_index(
        op.f("ix_subscription_invoices_id"),
        "subscription_invoices",
        ["id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_subscription_invoices_subscription_id"),
        "subscription_invoices",
        ["subscription_id"],
        unique=False,
    )
    op.create_table(
        "affiliate_commissions",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("affiliate_id", sa.Integer(), nullable=False),
        sa.Column("referral_id", sa.Integer(), nullable=True),
        sa.Column("amount", sa.Numeric(precision=10, scale=2), nullable=False),
        sa.Column("currency", sa.String(length=3), nullable=True),
        sa.Column("commission_type", sa.String(length=20), nullable=False),
        sa.Column("status", sa.String(length=20), nullable=False),
        sa.Column("payout_id", sa.Integer(), nullable=True),
        sa.Column("paid_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("description", sa.Text(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("(CURRENT_TIMESTAMP)"),
            nullable=True,
        ),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["affiliate_id"],
            ["affiliate_partners.id"],
        ),
        sa.ForeignKeyConstraint(
            ["payout_id"],
            ["affiliate_payouts.id"],
        ),
        sa.ForeignKeyConstraint(
            ["referral_id"],
            ["affiliate_referrals.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_affiliate_commissions_affiliate_id"),
        "affiliate_commissions",
        ["affiliate_id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_affiliate_commissions_id"),
        "affiliate_commissions",
        ["id"],
        unique=False,
    )
    op.create_index(
        op.f("ix_affiliate_commissions_referral_id"),
        "affiliate_commissions",
        ["referral_id"],
        unique=False,
    )
    # op.drop_table('course_analytics')  # Table doesn't exist, commented out
    # Commenting out table alterations not related to marketplace to avoid SQLite compatibility issues
    # op.alter_column('ai_grading_results', 'student_answer_id',
    #            existing_type=sa.INTEGER(),
    #            nullable=True)
    # op.drop_index(op.f('ix_ai_grading_results_needs_manual_review'), table_name='ai_grading_results')
    # op.drop_index(op.f('ix_ai_grading_results_student_answer_id'), table_name='ai_grading_results')
    # op.create_index(op.f('ix_ai_grading_results_id'), 'ai_grading_results', ['id'], unique=False)
    # op.drop_constraint(None, 'ai_grading_results', type_='foreignkey')
    # op.create_foreign_key(None, 'ai_grading_results', 'student_answers', ['student_answer_id'], ['id'])
    # op.drop_index(op.f('ix_assessment_rubrics_question_id'), table_name='assessment_rubrics')
    # op.create_index(op.f('ix_assessment_rubrics_id'), 'assessment_rubrics', ['id'], unique=False)
    # op.drop_constraint(None, 'assessment_rubrics', type_='foreignkey')
    # op.create_foreign_key(None, 'assessment_rubrics', 'questions', ['question_id'], ['id'])
    pass  # Marketplace tables created above
    # Bundle, course, lesson, notification, quiz alterations commented out for SQLite compatibility
    # op.add_column('bundle_enrollments', sa.Column('currency', sa.String(length=3), nullable=True))
    # ... (rest of bundle_enrollments, course_bundles, courses, lessons, notifications, quiz alterations)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_index(op.f("idx_users_email"), "users", ["email"], unique=False)
    op.create_index(op.f("idx_users_active"), "users", ["is_active"], unique=False)
    op.drop_constraint(None, "quiz_feedback", type_="foreignkey")
    op.create_foreign_key(
        None, "quiz_feedback", "questions", ["question_id"], ["id"], ondelete="CASCADE"
    )
    op.drop_index(op.f("ix_quiz_feedback_id"), table_name="quiz_feedback")
    op.create_index(
        op.f("ix_quiz_feedback_question_id"),
        "quiz_feedback",
        ["question_id"],
        unique=False,
    )
    op.drop_constraint(None, "quiz_attempt_analytics", type_="foreignkey")
    op.create_foreign_key(
        None,
        "quiz_attempt_analytics",
        "quiz_attempts",
        ["attempt_id"],
        ["id"],
        ondelete="CASCADE",
    )
    op.drop_index(
        op.f("ix_quiz_attempt_analytics_id"), table_name="quiz_attempt_analytics"
    )
    op.create_index(
        op.f("ix_quiz_attempt_analytics_attempt_id"),
        "quiz_attempt_analytics",
        ["attempt_id"],
        unique=1,
    )
    op.alter_column(
        "quiz_attempt_analytics",
        "attempt_id",
        existing_type=sa.INTEGER(),
        nullable=False,
    )
    op.drop_index(op.f("ix_notifications_priority"), table_name="notifications")
    op.alter_column(
        "notifications",
        "created_at",
        existing_type=sa.DATETIME(),
        nullable=False,
        existing_server_default=sa.text("(now())"),
    )
    op.alter_column(
        "notifications",
        "is_read",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        existing_server_default=sa.text("'false'"),
    )
    op.drop_column("notifications", "delivered_email")
    op.drop_column("notifications", "delivered_push")
    op.drop_column("notifications", "delivered_realtime")
    op.drop_column("notifications", "priority")
    op.drop_column("lessons", "video_uploaded_at")
    op.drop_column("lessons", "video_status")
    op.drop_column("lessons", "video_thumbnail_url")
    op.drop_column("lessons", "video_id")
    op.drop_column("lessons", "video_provider")
    op.add_column("courses", sa.Column("tags", sqlite.JSON(), nullable=True))
    op.add_column(
        "courses", sa.Column("category", sa.VARCHAR(length=20), nullable=True)
    )
    op.add_column("courses", sa.Column("page_layout", sqlite.JSON(), nullable=True))
    op.drop_constraint(None, "courses", type_="foreignkey")
    op.drop_index(op.f("ix_courses_category_id"), table_name="courses")
    op.create_index(op.f("ix_courses_category"), "courses", ["category"], unique=False)
    op.drop_column("courses", "password_hash")
    op.drop_column("courses", "is_password_protected")
    op.drop_column("courses", "category_id")
    op.drop_index(op.f("ix_course_bundles_slug"), table_name="course_bundles")
    op.alter_column(
        "course_bundles",
        "price",
        existing_type=sa.Numeric(precision=10, scale=2),
        type_=sa.FLOAT(),
        existing_nullable=False,
    )
    op.alter_column(
        "course_bundles",
        "description",
        existing_type=sa.Text(),
        type_=sa.VARCHAR(),
        existing_nullable=True,
    )
    op.drop_column("course_bundles", "meta_keywords")
    op.drop_column("course_bundles", "meta_description")
    op.drop_column("course_bundles", "meta_title")
    op.drop_column("course_bundles", "valid_until")
    op.drop_column("course_bundles", "valid_from")
    op.drop_column("course_bundles", "view_count")
    op.drop_column("course_bundles", "total_revenue")
    op.drop_column("course_bundles", "total_enrollments")
    op.drop_column("course_bundles", "is_featured")
    op.drop_column("course_bundles", "is_active")
    op.drop_column("course_bundles", "banner_url")
    op.drop_column("course_bundles", "discount_percentage")
    op.drop_column("course_bundles", "original_price")
    op.drop_column("course_bundles", "short_description")
    op.drop_column("course_bundles", "slug")
    op.drop_index(
        op.f("ix_bundle_enrollments_user_id"), table_name="bundle_enrollments"
    )
    op.drop_index(
        op.f("ix_bundle_enrollments_bundle_id"), table_name="bundle_enrollments"
    )
    op.alter_column(
        "bundle_enrollments",
        "price_paid",
        existing_type=sa.Numeric(precision=10, scale=2),
        type_=sa.FLOAT(),
        existing_nullable=False,
    )
    op.drop_column("bundle_enrollments", "updated_at")
    op.drop_column("bundle_enrollments", "created_at")
    op.drop_column("bundle_enrollments", "status")
    op.drop_column("bundle_enrollments", "completed_at")
    op.drop_column("bundle_enrollments", "completion_percentage")
    op.drop_column("bundle_enrollments", "courses_completed")
    op.drop_column("bundle_enrollments", "discount_applied")
    op.drop_column("bundle_enrollments", "coupon_code")
    op.drop_column("bundle_enrollments", "payment_status")
    op.drop_column("bundle_enrollments", "currency")
    op.drop_constraint(None, "assessment_rubrics", type_="foreignkey")
    op.create_foreign_key(
        None,
        "assessment_rubrics",
        "questions",
        ["question_id"],
        ["id"],
        ondelete="CASCADE",
    )
    op.drop_index(op.f("ix_assessment_rubrics_id"), table_name="assessment_rubrics")
    op.create_index(
        op.f("ix_assessment_rubrics_question_id"),
        "assessment_rubrics",
        ["question_id"],
        unique=False,
    )
    op.drop_constraint(None, "ai_grading_results", type_="foreignkey")
    op.create_foreign_key(
        None,
        "ai_grading_results",
        "student_answers",
        ["student_answer_id"],
        ["id"],
        ondelete="CASCADE",
    )
    op.drop_index(op.f("ix_ai_grading_results_id"), table_name="ai_grading_results")
    op.create_index(
        op.f("ix_ai_grading_results_student_answer_id"),
        "ai_grading_results",
        ["student_answer_id"],
        unique=1,
    )
    op.create_index(
        op.f("ix_ai_grading_results_needs_manual_review"),
        "ai_grading_results",
        ["needs_manual_review"],
        unique=False,
    )
    op.alter_column(
        "ai_grading_results",
        "student_answer_id",
        existing_type=sa.INTEGER(),
        nullable=False,
    )
    op.create_table(
        "course_analytics",
        sa.Column("course_id", sa.INTEGER(), nullable=False),
        sa.Column("total_enrollments", sa.INTEGER(), nullable=True),
        sa.Column("enrollments_this_month", sa.INTEGER(), nullable=True),
        sa.Column("total_revenue", sa.FLOAT(), nullable=True),
        sa.Column("revenue_this_month", sa.FLOAT(), nullable=True),
        sa.Column("avg_completion_rate", sa.FLOAT(), nullable=True),
        sa.Column("avg_time_spent_minutes", sa.INTEGER(), nullable=True),
        sa.Column("average_rating", sa.FLOAT(), nullable=True),
        sa.Column("total_reviews", sa.INTEGER(), nullable=True),
        sa.Column("last_updated", sa.DATETIME(), nullable=True),
        sa.ForeignKeyConstraint(
            ["course_id"],
            ["courses.id"],
        ),
        sa.PrimaryKeyConstraint("course_id"),
    )
    op.drop_index(
        op.f("ix_affiliate_commissions_referral_id"), table_name="affiliate_commissions"
    )
    op.drop_index(
        op.f("ix_affiliate_commissions_id"), table_name="affiliate_commissions"
    )
    op.drop_index(
        op.f("ix_affiliate_commissions_affiliate_id"),
        table_name="affiliate_commissions",
    )
    op.drop_table("affiliate_commissions")
    op.drop_index(
        op.f("ix_subscription_invoices_subscription_id"),
        table_name="subscription_invoices",
    )
    op.drop_index(
        op.f("ix_subscription_invoices_id"), table_name="subscription_invoices"
    )
    op.drop_table("subscription_invoices")
    op.drop_index(op.f("ix_student_analytics_id"), table_name="student_analytics")
    op.drop_table("student_analytics")
    op.drop_index(
        op.f("ix_revenue_transactions_student_id"), table_name="revenue_transactions"
    )
    op.drop_index(
        op.f("ix_revenue_transactions_instructor_id"), table_name="revenue_transactions"
    )
    op.drop_index(op.f("ix_revenue_transactions_id"), table_name="revenue_transactions")
    op.drop_index(
        op.f("ix_revenue_transactions_course_id"), table_name="revenue_transactions"
    )
    op.drop_table("revenue_transactions")
    op.drop_index(op.f("ix_revenue_shares_instructor_id"), table_name="revenue_shares")
    op.drop_index(op.f("ix_revenue_shares_id"), table_name="revenue_shares")
    op.drop_index(op.f("ix_revenue_shares_course_id"), table_name="revenue_shares")
    op.drop_table("revenue_shares")
    op.drop_index(op.f("ix_marketplace_listings_id"), table_name="marketplace_listings")
    op.drop_index(
        op.f("ix_marketplace_listings_course_id"), table_name="marketplace_listings"
    )
    op.drop_table("marketplace_listings")
    op.drop_index(op.f("ix_instructor_analytics_id"), table_name="instructor_analytics")
    op.drop_index(
        op.f("ix_instructor_analytics_date"), table_name="instructor_analytics"
    )
    op.drop_table("instructor_analytics")
    op.drop_index(op.f("ix_analytics_events_timestamp"), table_name="analytics_events")
    op.drop_index(op.f("ix_analytics_events_id"), table_name="analytics_events")
    op.drop_index(op.f("ix_analytics_events_event_type"), table_name="analytics_events")
    op.drop_table("analytics_events")
    op.drop_index(
        op.f("ix_affiliate_referrals_referred_user_id"),
        table_name="affiliate_referrals",
    )
    op.drop_index(op.f("ix_affiliate_referrals_id"), table_name="affiliate_referrals")
    op.drop_index(
        op.f("ix_affiliate_referrals_affiliate_id"), table_name="affiliate_referrals"
    )
    op.drop_table("affiliate_referrals")
    op.drop_index(op.f("ix_affiliate_payouts_id"), table_name="affiliate_payouts")
    op.drop_index(
        op.f("ix_affiliate_payouts_affiliate_id"), table_name="affiliate_payouts"
    )
    op.drop_table("affiliate_payouts")
    op.drop_index(
        op.f("ix_affiliate_clicks_tracking_cookie"), table_name="affiliate_clicks"
    )
    op.drop_index(
        op.f("ix_affiliate_clicks_referral_code"), table_name="affiliate_clicks"
    )
    op.drop_index(op.f("ix_affiliate_clicks_id"), table_name="affiliate_clicks")
    op.drop_index(
        op.f("ix_affiliate_clicks_affiliate_id"), table_name="affiliate_clicks"
    )
    op.drop_table("affiliate_clicks")
    op.drop_index(
        op.f("ix_user_subscriptions_user_id"), table_name="user_subscriptions"
    )
    op.drop_index(
        op.f("ix_user_subscriptions_stripe_subscription_id"),
        table_name="user_subscriptions",
    )
    op.drop_index(
        op.f("ix_user_subscriptions_plan_id"), table_name="user_subscriptions"
    )
    op.drop_index(op.f("ix_user_subscriptions_id"), table_name="user_subscriptions")
    op.drop_table("user_subscriptions")
    op.drop_index(
        op.f("ix_instructor_payouts_instructor_id"), table_name="instructor_payouts"
    )
    op.drop_index(op.f("ix_instructor_payouts_id"), table_name="instructor_payouts")
    op.drop_table("instructor_payouts")
    op.drop_index(
        op.f("ix_instructor_payment_info_instructor_id"),
        table_name="instructor_payment_info",
    )
    op.drop_index(
        op.f("ix_instructor_payment_info_id"), table_name="instructor_payment_info"
    )
    op.drop_table("instructor_payment_info")
    op.drop_index(
        op.f("ix_affiliate_partners_user_id"), table_name="affiliate_partners"
    )
    op.drop_index(
        op.f("ix_affiliate_partners_referral_code"), table_name="affiliate_partners"
    )
    op.drop_index(op.f("ix_affiliate_partners_id"), table_name="affiliate_partners")
    op.drop_table("affiliate_partners")
    op.drop_index(op.f("ix_subscription_plans_slug"), table_name="subscription_plans")
    op.drop_index(op.f("ix_subscription_plans_id"), table_name="subscription_plans")
    op.drop_table("subscription_plans")
    op.drop_index(op.f("ix_subscription_coupons_id"), table_name="subscription_coupons")
    op.drop_index(
        op.f("ix_subscription_coupons_code"), table_name="subscription_coupons"
    )
    op.drop_table("subscription_coupons")
    op.drop_index(op.f("ix_platform_analytics_id"), table_name="platform_analytics")
    op.drop_index(op.f("ix_platform_analytics_date"), table_name="platform_analytics")
    op.drop_table("platform_analytics")
    # ### end Alembic commands ###
