============================= test session starts =============================
platform win32 -- Python 3.13.2, pytest-9.0.1, pluggy-1.6.0 -- C:\Users\Sarit\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: D:\Graphology\Master Software\Eduecosystem\backend
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.11.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 81 items

tests/api/test_admin.py::test_admin_stats_endpoint FAILED                [  1%]
tests/api/test_admin.py::test_admin_only_access FAILED                   [  2%]
tests/api/test_admin.py::test_list_all_users FAILED                      [  3%]
tests/api/test_admin.py::test_search_users FAILED                        [  4%]
tests/api/test_admin.py::test_ban_user FAILED                            [  6%]
tests/api/test_admin.py::test_unban_user FAILED                          [  7%]
tests/api/test_admin.py::test_promote_to_admin FAILED                    [  8%]
tests/api/test_admin.py::test_delete_user FAILED                         [  9%]
tests/api/test_admin.py::test_cannot_delete_admin FAILED                 [ 11%]
tests/api/test_admin.py::test_get_user_details FAILED                    [ 12%]
tests/api/test_admin.py::test_admin_logs FAILED                          [ 13%]
tests/api/test_admin.py::test_filter_users_by_role FAILED                [ 14%]
tests/api/test_admin.py::test_filter_banned_users FAILED                 [ 16%]
tests/api/test_admin.py::test_unauthorized_admin_access FAILED           [ 17%]
tests/api/test_analytics.py::test_dashboard_analytics_basic FAILED       [ 18%]
tests/api/test_analytics.py::test_analytics_with_shadow_sessions FAILED  [ 19%]
tests/api/test_analytics.py::test_analytics_handwriting_count FAILED     [ 20%]
tests/api/test_analytics.py::test_analytics_insights_generation FAILED   [ 22%]
tests/api/test_analytics.py::test_analytics_attention_tracking FAILED    [ 23%]
tests/api/test_analytics.py::test_detailed_analytics FAILED              [ 24%]
tests/api/test_analytics.py::test_analytics_with_activity_heatmap PASSED [ 25%]
tests/api/test_analytics.py::test_analytics_empty_state PASSED           [ 27%]
tests/api/test_analytics.py::test_unauthorized_analytics_access PASSED   [ 28%]
tests/api/test_auth.py::test_signup FAILED                               [ 29%]
tests/api/test_auth.py::test_login_access_token FAILED                   [ 30%]
tests/api/test_certificates.py::test_get_my_certificates FAILED          [ 32%]
tests/api/test_certificates.py::test_download_certificate FAILED         [ 33%]
tests/api/test_certificates_simple.py::test_simple PASSED                [ 34%]
tests/api/test_grapho.py::test_upload_handwriting FAILED                 [ 35%]
tests/api/test_groups.py::test_join_wolf_pack FAILED                     [ 37%]
tests/api/test_groups.py::test_multiple_users_same_streak_same_group FAILED [ 38%]
tests/api/test_groups.py::test_get_my_group FAILED                       [ 39%]
tests/api/test_groups.py::test_group_leaderboard FAILED                  [ 40%]
tests/api/test_groups.py::test_leaderboard_limit FAILED                  [ 41%]
tests/api/test_groups.py::test_group_stats_calculation FAILED            [ 43%]
tests/api/test_groups.py::test_group_max_members_enforcement FAILED      [ 44%]
tests/api/test_groups.py::test_join_group_twice FAILED                   [ 45%]
tests/api/test_groups.py::test_unauthorized_access FAILED                [ 46%]
tests/api/test_lms.py::test_list_courses ERROR                           [ 48%]
tests/api/test_lms.py::test_list_courses_with_category_filter ERROR      [ 49%]
tests/api/test_lms.py::test_list_courses_with_level_filter ERROR         [ 50%]
tests/api/test_lms.py::test_list_courses_with_search ERROR               [ 51%]
tests/api/test_lms.py::test_create_course_instructor_only ERROR          [ 53%]
tests/api/test_lms.py::test_create_course_student_forbidden ERROR        [ 54%]
tests/api/test_lms.py::test_get_course_details ERROR                     [ 55%]
tests/api/test_lms.py::test_update_course_instructor ERROR               [ 56%]
tests/api/test_lms.py::test_delete_course_instructor ERROR               [ 58%]
tests/api/test_lms.py::test_add_module_to_course ERROR                   [ 59%]
tests/api/test_lms.py::test_add_lesson_to_module ERROR                   [ 60%]
tests/api/test_lms.py::test_update_module ERROR                          [ 61%]
tests/api/test_lms.py::test_delete_module ERROR                          [ 62%]
tests/api/test_lms.py::test_delete_lesson ERROR                          [ 64%]
tests/api/test_lms.py::test_enroll_in_free_course ERROR                  [ 65%]
tests/api/test_lms.py::test_duplicate_enrollment_prevented ERROR         [ 66%]
tests/api/test_lms.py::test_get_my_courses ERROR                         [ 67%]
tests/api/test_lms.py::test_get_course_progress ERROR                    [ 69%]
tests/api/test_lms.py::test_update_lesson_progress ERROR                 [ 70%]
tests/api/test_lms.py::test_course_progress_percentage_updates ERROR     [ 71%]
tests/api/test_lms.py::test_enroll_requires_authentication ERROR         [ 72%]
tests/api/test_lms.py::test_enroll_in_nonexistent_course ERROR           [ 74%]
tests/api/test_lms.py::test_get_certificate_not_completed ERROR          [ 75%]
tests/api/test_lms.py::test_get_my_certificates_empty ERROR              [ 76%]
tests/api/test_lms.py::test_certificate_number_format FAILED             [ 77%]
tests/api/test_lms.py::test_certificate_requires_authentication ERROR    [ 79%]
tests/api/test_lms.py::test_download_certificate_unauthorized ERROR      [ 80%]
tests/api/test_lms.py::test_certificate_fields_present PASSED            [ 81%]
tests/api/test_lms.py::test_create_razorpay_payment SKIPPED (Requires
payment gateway mocking setup)                                           [ 82%]
tests/api/test_lms.py::test_create_stripe_payment SKIPPED (Requires
payment gateway mocking setup)                                           [ 83%]
tests/api/test_lms.py::test_verify_razorpay_payment SKIPPED (Requires
payment gateway mocking setup)                                           [ 85%]
tests/api/test_lms.py::test_get_payment_status SKIPPED (Requires payment
gateway mocking setup)                                                   [ 86%]
tests/api/test_lms.py::test_enrollment_after_payment SKIPPED (Requires
payment gateway mocking setup)                                           [ 87%]
tests/api/test_monitoring.py::test_exam_monitoring_flow FAILED           [ 88%]
tests/api/test_shadow_mode.py::test_start_shadow_session FAILED          [ 90%]
tests/api/test_shadow_mode.py::test_start_session_with_active_session FAILED [ 91%]
tests/api/test_shadow_mode.py::test_end_shadow_session FAILED            [ 92%]
tests/api/test_shadow_mode.py::test_end_session_without_active FAILED    [ 93%]
tests/api/test_shadow_mode.py::test_get_shadow_progress FAILED           [ 95%]
tests/api/test_shadow_mode.py::test_get_current_session FAILED           [ 96%]
tests/api/test_shadow_mode.py::test_coin_calculation_accuracy FAILED     [ 97%]
tests/api/test_shadow_mode.py::test_session_with_notes FAILED            [ 98%]
tests/api/test_shadow_mode.py::test_unauthorized_access PASSED           [100%]

=================================== ERRORS ====================================
_____________________ ERROR at setup of test_list_courses _____________________

db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF594F0>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD3AC0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
__________ ERROR at setup of test_list_courses_with_category_filter ___________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DEE120>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD09E0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________ ERROR at setup of test_list_courses_with_level_filter ____________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DBED50>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD2F10>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_______________ ERROR at setup of test_list_courses_with_search _______________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DBD6D0>
client = <starlette.testclient.TestClient object at 0x0000021EC8ABF570>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________ ERROR at setup of test_create_course_instructor_only _____________

db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF59C70>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD0D10>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
___________ ERROR at setup of test_create_course_student_forbidden ____________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F554F0>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD3790>

    @pytest.fixture
    def test_student(db: Session, client: TestClient):
        """Create a test student user"""
        response = client.post(
            "/api/v1/login/signup",
            json={
                "email": "student@test.com",
                "password": "StudentPass123!",
                "full_name": "Test Student"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:61: AssertionError
__________________ ERROR at setup of test_get_course_details __________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F55E50>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD2690>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_______________ ERROR at setup of test_update_course_instructor _______________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F55D60>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD1E10>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_______________ ERROR at setup of test_delete_course_instructor _______________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F54050>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD18C0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_________________ ERROR at setup of test_add_module_to_course _________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED72F0>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1A360>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_________________ ERROR at setup of test_add_lesson_to_module _________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDC140>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1BAC0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________________ ERROR at setup of test_update_module _____________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDCB90>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1B790>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________________ ERROR at setup of test_delete_module _____________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDE300>
client = <starlette.testclient.TestClient object at 0x0000021EC9F185A0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________________ ERROR at setup of test_delete_lesson _____________________

db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF156D0>
client = <starlette.testclient.TestClient object at 0x0000021EC9F186B0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
________________ ERROR at setup of test_enroll_in_free_course _________________

db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF15F40>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1A580>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________ ERROR at setup of test_duplicate_enrollment_prevented ____________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDD7C0>
client = <starlette.testclient.TestClient object at 0x0000021EC9F18380>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________________ ERROR at setup of test_get_my_courses ____________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDFE30>
client = <starlette.testclient.TestClient object at 0x0000021EC9F19D00>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_________________ ERROR at setup of test_get_course_progress __________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDD9A0>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1ABE0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
________________ ERROR at setup of test_update_lesson_progress ________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED48C0>
client = <starlette.testclient.TestClient object at 0x0000021EC9F19BF0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
__________ ERROR at setup of test_course_progress_percentage_updates __________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED4E60>
client = <starlette.testclient.TestClient object at 0x0000021EC9F18270>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
____________ ERROR at setup of test_enroll_requires_authentication ____________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F556D0>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1AF10>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
_____________ ERROR at setup of test_enroll_in_nonexistent_course _____________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F55A90>
client = <starlette.testclient.TestClient object at 0x0000021EC9F1A360>

    @pytest.fixture
    def test_student(db: Session, client: TestClient):
        """Create a test student user"""
        response = client.post(
            "/api/v1/login/signup",
            json={
                "email": "student@test.com",
                "password": "StudentPass123!",
                "full_name": "Test Student"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:61: AssertionError
____________ ERROR at setup of test_get_certificate_not_completed _____________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F57890>
client = <starlette.testclient.TestClient object at 0x0000021EC9F19150>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
______________ ERROR at setup of test_get_my_certificates_empty _______________

db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF59C70>
client = <starlette.testclient.TestClient object at 0x0000021EC9F19E10>

    @pytest.fixture
    def test_student(db: Session, client: TestClient):
        """Create a test student user"""
        response = client.post(
            "/api/v1/login/signup",
            json={
                "email": "student@test.com",
                "password": "StudentPass123!",
                "full_name": "Test Student"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:61: AssertionError
_________ ERROR at setup of test_certificate_requires_authentication __________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DBDE50>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD17B0>

    @pytest.fixture
    def test_instructor(db: Session, client: TestClient):
        """Create a test instructor user"""
        response = client.post(
            "/api/v1/login/signup",
            json={ "email": "instructor@test.com",
                "password": "InstructorPass123!",
                "full_name": "Test Instructor",
                "role": "instructor"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:37: AssertionError
__________ ERROR at setup of test_download_certificate_unauthorized ___________

db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF175C0>
client = <starlette.testclient.TestClient object at 0x0000021EC9DD16A0>

    @pytest.fixture
    def test_student(db: Session, client: TestClient):
        """Create a test student user"""
        response = client.post(
            "/api/v1/login/signup",
            json={
                "email": "student@test.com",
                "password": "StudentPass123!",
                "full_name": "Test Student"
            }
        )
>       assert response.status_code in [200, 201]
E       assert 404 in [200, 201]
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_lms.py:61: AssertionError
================================== FAILURES ===================================
__________________________ test_admin_stats_endpoint __________________________

client = <starlette.testclient.TestClient object at 0x0000021EC8AEDBE0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC8AED940>

    def test_admin_stats_endpoint(client: TestClient, db):
        """Test admin platform statistics endpoint."""
        # Create admin user
        admin = create_admin_user(db, "admin1@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin1@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Create some test data
        create_regular_user(db, "testuser1@example.com")
        create_regular_user(db, "testuser2@example.com")
    
        # Get admin stats
        r = client.get(f"{settings.API_V1_STR}/admin/stats", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:49: AssertionError
---------------------------- Captured stdout setup ----------------------------
Registered mappers: [<Mapper at 0x21e89798050; Module>, <Mapper at 0x21e8947b890; Task>, <Mapper at 0x21e8967d090; HandwritingSubmission>, <Mapper at 0x21e8967f890; Block>, <Mapper at 0x21e8967e0d0; ShadowModeSession>, <Mapper at 0x21e8979a0d0; StudyRoom>, <Mapper at 0x21e8967d950; MoodEntry>, <Mapper at 0x21e89799950; QuizAttempt>, <Mapper at 0x21e8967e990; AdminLog>, <Mapper at 0x21e8967f250; StudyGroup>, <Mapper at 0x21e89798a50; CourseReview>, <Mapper at 0x21e897982d0; Lesson>, <Mapper at 0x21e89799310; CoursePayment>, <Mapper at 0x21e897987d0; LessonProgress>, <Mapper at 0x21e89799bd0; Assignment>, <Mapper at 0x21e89555be0; User>, <Mapper at 0x21e8967d450; Reward>, <Mapper at 0x21e8967e490; Quiz>, <Mapper at 0x21e8967f4d0; Notification>, <Mapper at 0x21e89798cd0; CourseAnalytics>, <Mapper at 0x21e8967dd10; ExamSession>, <Mapper at 0x21e8967c550; MeditationSession>, <Mapper at 0x21e8967ed50; Friendship>, <Mapper at 0x21e8967c7d0; ActivityLog>, <Mapper at 0x21e89798550; Enrollment>, <Mapper at 0x21e8967fd90; Course>, <Mapper at 0x21e89799590; Certificate>, <Mapper at 0x21e89799e50; AssignmentSubmission>, <Mapper at 0x21e8947bed0; Group>, <Mapper at 0x21e8967d6d0; UserReward>, <Mapper at 0x21e8967e710; Question>, <Mapper at 0x21e8967efd0; DirectMessage>]
___________________________ test_admin_only_access ____________________________

client = <starlette.testclient.TestClient object at 0x0000021EC8C26D50>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC8C26E90>

    def test_admin_only_access(client: TestClient, db):
        """Test that only admins can access admin endpoints."""
        # Create regular user
        user = create_regular_user(db, "regular@example.com")
    
        # Login as regular user
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "regular@example.com", "password": "user123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Try to access admin stats
        r = client.get(f"{settings.API_V1_STR}/admin/stats", headers=headers)
>       assert r.status_code == 403 or r.status_code == 401  # Should be forbidden
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert (404 == 403 or 404 == 401)
E        +  where 404 = <Response [404 Not Found]>.status_code
E        +  and   404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:84: AssertionError
_____________________________ test_list_all_users _____________________________

client = <starlette.testclient.TestClient object at 0x0000021EC8C26490>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9E40F50>

    def test_list_all_users(client: TestClient, db):
        """Test listing all users with pagination."""
        # Create admin
        admin = create_admin_user(db, "admin2@example.com")
    
        # Create multiple regular users
        for i in range(15):
            create_regular_user(db, f"listuser{i}@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin2@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Get users list
        r = client.get(f"{settings.API_V1_STR}/admin/users", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:104: AssertionError
______________________________ test_search_users ______________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9E362C0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9E35810>

    def test_search_users(client: TestClient, db):
        """Test user search functionality."""
        # Create admin
        admin = create_admin_user(db, "admin3@example.com")
    
        # Create users with specific names
        user_in = UserCreate(email="john.doe@example.com", password="pass", full_name="John Doe")
        crud_user.create(db, obj_in=user_in)
    
        user_in = UserCreate(email="jane.smith@example.com", password="pass", full_name="Jane Smith")
        crud_user.create(db, obj_in=user_in)
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin3@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Search for "john"
        r = client.get(f"{settings.API_V1_STR}/admin/users?search=john", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:139: AssertionError
________________________________ test_ban_user ________________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9E369E0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9E36190>

    def test_ban_user(client: TestClient, db):
        """Test banning a user."""
        # Create admin and user
        admin = create_admin_user(db, "admin4@example.com")
        user = create_regular_user(db, "toban@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin4@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Ban the user
        r = client.put(f"{settings.API_V1_STR}/admin/users/{user.id}/ban", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:161: AssertionError
_______________________________ test_unban_user _______________________________

client = <starlette.testclient.TestClient object at 0x0000021EC8B97D10>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC8B957F0>

    def test_unban_user(client: TestClient, db):
        """Test unbanning a user."""
        # Create admin and banned user
        admin = create_admin_user(db, "admin5@example.com")
        user = create_regular_user(db, "banned@example.com")
        user.is_banned = True
        user.is_active = False
        db.commit()
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin5@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Unban the user
        r = client.put(f"{settings.API_V1_STR}/admin/users/{user.id}/unban", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:194: AssertionError
____________________________ test_promote_to_admin ____________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9DD1480>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DD1370>

    def test_promote_to_admin(client: TestClient, db):
        """Test promoting a user to admin."""
        # Create admin and user
        admin = create_admin_user(db, "admin6@example.com")
        user = create_regular_user(db, "topromote@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin6@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Promote user
        r = client.put(f"{settings.API_V1_STR}/admin/users/{user.id}/promote", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:216: AssertionError
______________________________ test_delete_user _______________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9DD3350>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DD3130>

    def test_delete_user(client: TestClient, db):
        """Test deleting a user (soft delete)."""
        # Create admin and user
        admin = create_admin_user(db, "admin7@example.com")
        user = create_regular_user(db, "todelete@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin7@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Delete user
        r = client.delete(f"{settings.API_V1_STR}/admin/users/{user.id}", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:244: AssertionError
__________________________ test_cannot_delete_admin ___________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9F187C0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EC1250>

    def test_cannot_delete_admin(client: TestClient, db):
        """Test that admins cannot delete other admins."""
        # Create two admins
        admin1 = create_admin_user(db, "admin8@example.com")
        admin2 = create_admin_user(db, "admin9@example.com")
    
        # Login as admin1
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin8@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Try to delete admin2
        r = client.delete(f"{settings.API_V1_STR}/admin/users/{admin2.id}", headers=headers)
>       assert r.status_code == 403
E       assert 404 == 403
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:265: AssertionError
____________________________ test_get_user_details ____________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9F18E20>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EC3850>

    def test_get_user_details(client: TestClient, db):
        """Test getting detailed user information."""
        # Create admin and user with activity
        admin = create_admin_user(db, "admin10@example.com")
        user = create_regular_user(db, "detailed@example.com")
    
        # Add some user activity
>       submission = HandwritingSubmission(
            user_id=user.id,
            file_path="test.jpg",
            extracted_text="test",
            analysis_results={}
        )

tests\api\test_admin.py:276: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
<string>:4: in __init__
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state.py:571: in _initialize_instance
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state.py:569: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <app.models.submission.HandwritingSubmission object at 0x0000021EC8AEDA90>
kwargs = {'analysis_results': {}, 'extracted_text': 'test', 'file_path': 'test.jpg', 'user_id': 2}
cls_ = <class 'app.models.submission.HandwritingSubmission'>, k = 'file_path'

    def _declarative_constructor(self: Any, **kwargs: Any) -> None:
        """A simple constructor that allows initialization from kwargs.
    
        Sets attributes on the constructed instance using the names and
        values in ``kwargs``.
    
        Only keys that are present as
        attributes of the instance's class are allowed. These could be,
        for example, any mapped columns or relationships.
        """
        cls_ = type(self)
        for k in kwargs:
            if not hasattr(cls_, k):
>               raise TypeError(
                    "%r is an invalid keyword argument for %s" % (k, cls_.__name__)
                )
E               TypeError: 'file_path' is an invalid keyword argument for HandwritingSubmission

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\decl_base.py:2179: TypeError
_______________________________ test_admin_logs _______________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9F1B8A0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED48C0>

    def test_admin_logs(client: TestClient, db):
        """Test retrieving admin activity logs."""
        # Create admin
        admin = create_admin_user(db, "admin11@example.com")
        user = create_regular_user(db, "logtest@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin11@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Perform some admin actions
        client.put(f"{settings.API_V1_STR}/admin/users/{user.id}/ban", headers=headers)
        client.put(f"{settings.API_V1_STR}/admin/users/{user.id}/unban", headers=headers)
    
        # Get logs
        r = client.get(f"{settings.API_V1_STR}/admin/logs", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:328: AssertionError
__________________________ test_filter_users_by_role __________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9F19150>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED63F0>

    def test_filter_users_by_role(client: TestClient, db):
        """Test filtering users by role."""
        # Create admin and users
        admin = create_admin_user(db, "admin12@example.com")
        create_regular_user(db, "roletest1@example.com")
    
        another_admin_in = UserCreate(email="roletest2@example.com", password="pass", full_name="Test Admin")
        another_admin = crud_user.create(db, obj_in=another_admin_in)
        another_admin.role = "admin"
        db.commit()
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin12@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Filter by admin role
        r = client.get(f"{settings.API_V1_STR}/admin/users?role=admin", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:362: AssertionError
__________________________ test_filter_banned_users ___________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9F19370>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED7200>

    def test_filter_banned_users(client: TestClient, db):
        """Test filtering banned users."""
        # Create admin
        admin = create_admin_user(db, "admin13@example.com")
    
        # Create banned and active users
        banned_user = create_regular_user(db, "banned1@example.com")
        banned_user.is_banned = True
        db.commit()
    
        create_regular_user(db, "active1@example.com")
    
        # Login as admin
        r = client.post(f"{settings.API_V1_STR}/login/access-token",
                       data={"username": "admin13@example.com", "password": "admin123"})
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Filter banned users
        r = client.get(f"{settings.API_V1_STR}/admin/users?is_banned=true", headers=headers)
>       assert r.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:390: AssertionError
_______________________ test_unauthorized_admin_access ________________________

client = <starlette.testclient.TestClient object at 0x0000021EC9F19590>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED46E0>

    def test_unauthorized_admin_access(client: TestClient, db):
        """Test that admin endpoints require authentication."""
        # Try to access without token
        r = client.get(f"{settings.API_V1_STR}/admin/stats")
>       assert r.status_code == 401
E       assert 404 == 401
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\api\test_admin.py:402: AssertionError
_______________________ test_dashboard_analytics_basic ________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E23110>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B590>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('analytics1@example.com', '$2b$12$rmKX8xFYthEQBlqYIMcfdOGKzPEbdb9xyhL7Hb/pv.eJo16ZbVpJ2', 1, 0, 'Analytics User 1', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA13A840>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics1@example.com', '$2b$12$rmKX8xFYthEQBlqYIMcfdOGKzPEbdb9xyhL7Hb/pv.eJo16ZbVpJ2', 1, 0, 'Analytics User 1', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B590>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: database is locked

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F198C0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDE210>

    def test_dashboard_analytics_basic(client: TestClient, db):
        """Test basic dashboard analytics retrieval."""
        # Create and login user
        email = "analytics1@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 1")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_analytics.py:21: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA13A840>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics1@example.com', '$2b$12$rmKX8xFYthEQBlqYIMcfdOGKzPEbdb9xyhL7Hb/pv.eJo16ZbVpJ2', 1, 0, 'Analytics User 1', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B590>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('analytics1@example.com', '$2b$12$rmKX8xFYthEQBlqYIMcfdOGKzPEbdb9xyhL7Hb/pv.eJo16ZbVpJ2', 1, 0, 'Analytics User 1', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_____________________ test_analytics_with_shadow_sessions _____________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E22BD0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('analytics2@example.com', '$2b$12$yMCP9L7K7fxpuKjANxUTmOyBhXh/13NOAy4F0GX5mDqIGyzVqT3n.', 1, 0, 'Analytics User 2', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAD3A9C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics2@example.com', '$2b$12$yMCP9L7K7fxpuKjANxUTmOyBhXh/13NOAy4F0GX5mDqIGyzVqT3n.', 1, 0, 'Analytics User 2', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F199D0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDE120>

    def test_analytics_with_shadow_sessions(client: TestClient, db):
        """Test analytics correctly aggregates shadow mode data."""
        # Create and login user
        email = "analytics2@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 2")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_analytics.py:65: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAD3A9C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics2@example.com', '$2b$12$yMCP9L7K7fxpuKjANxUTmOyBhXh/13NOAy4F0GX5mDqIGyzVqT3n.', 1, 0, 'Analytics User 2', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('analytics2@example.com', '$2b$12$yMCP9L7K7fxpuKjANxUTmOyBhXh/13NOAy4F0GX5mDqIGyzVqT3n.', 1, 0, 'Analytics User 2', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
______________________ test_analytics_handwriting_count _______________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC8D7B590>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B710>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('analytics3@example.com', '$2b$12$JQmB6Il8FBgN2YTeN0xoz./khYw68R6PV9./q/dsaLngZY58pAwH2', 1, 0, 'Analytics User 3', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAA5FE40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics3@example.com', '$2b$12$JQmB6Il8FBgN2YTeN0xoz./khYw68R6PV9./q/dsaLngZY58pAwH2', 1, 0, 'Analytics User 3', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B710>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1A7A0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDC8C0>

    def test_analytics_handwriting_count(client: TestClient, db):
        """Test analytics counts handwriting submissions correctly."""
        # Create and login user
        email = "analytics3@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 3")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_analytics.py:105: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAA5FE40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics3@example.com', '$2b$12$JQmB6Il8FBgN2YTeN0xoz./khYw68R6PV9./q/dsaLngZY58pAwH2', 1, 0, 'Analytics User 3', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B710>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('analytics3@example.com', '$2b$12$JQmB6Il8FBgN2YTeN0xoz./khYw68R6PV9./q/dsaLngZY58pAwH2', 1, 0, 'Analytics User 3', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_____________________ test_analytics_insights_generation ______________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E23B90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('analytics4@example.com', '$2b$12$jJMiwH9EshyISAKq9R4obO/f3zW6HFgQ29yJveGi2UJMAOQ6A3c2O', 1, 0, 'Analytics User 4', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA091240>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics4@example.com', '$2b$12$jJMiwH9EshyISAKq9R4obO/f3zW6HFgQ29yJveGi2UJMAOQ6A3c2O', 1, 0, 'Analytics User 4', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC8B4FBD0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDD4F0>

    def test_analytics_insights_generation(client: TestClient, db):
        """Test that insights are generated correctly."""
        # Create and login user
        email = "analytics4@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 4")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_analytics.py:137: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA091240>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics4@example.com', '$2b$12$jJMiwH9EshyISAKq9R4obO/f3zW6HFgQ29yJveGi2UJMAOQ6A3c2O', 1, 0, 'Analytics User 4', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('analytics4@example.com', '$2b$12$jJMiwH9EshyISAKq9R4obO/f3zW6HFgQ29yJveGi2UJMAOQ6A3c2O', 1, 0, 'Analytics User 4', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
______________________ test_analytics_attention_tracking ______________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E20C50>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E22690>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('analytics5@example.com', '$2b$12$iaMTnItxXTMHokLZIpBaUeml2aXwyxmOB6NGCevLhjvRcxa5PKYEu', 1, 0, 'Analytics User 5', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA13BAC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics5@example.com', '$2b$12$iaMTnItxXTMHokLZIpBaUeml2aXwyxmOB6NGCevLhjvRcxa5PKYEu', 1, 0, 'Analytics User 5', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E22690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC8B4F9B0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDCB90>

    def test_analytics_attention_tracking(client: TestClient, db):
        """Test attention tracking statistics in analytics."""
        # Create and login user
        email = "analytics5@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 5")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_analytics.py:176: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA13BAC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics5@example.com', '$2b$12$iaMTnItxXTMHokLZIpBaUeml2aXwyxmOB6NGCevLhjvRcxa5PKYEu', 1, 0, 'Analytics User 5', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E22690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('analytics5@example.com', '$2b$12$iaMTnItxXTMHokLZIpBaUeml2aXwyxmOB6NGCevLhjvRcxa5PKYEu', 1, 0, 'Analytics User 5', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_detailed_analytics ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC8D7B290>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7ABD0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('analytics6@example.com', '$2b$12$dDpKihTXAZsHLbHSmLVYuur4dCWG3bdwgaDFxalWJd17o7U4xM2yy', 1, 0, 'Analytics User 6', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8E46C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics6@example.com', '$2b$12$dDpKihTXAZsHLbHSmLVYuur4dCWG3bdwgaDFxalWJd17o7U4xM2yy', 1, 0, 'Analytics User 6', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7ABD0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: database is locked

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1A9C0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDC050>

    def test_detailed_analytics(client: TestClient, db):
        """Test detailed analytics endpoint with advanced charts."""
        # Create and login user
        email = "analytics6@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 6")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_analytics.py:213: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8E46C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('analytics6@example.com', '$2b$12$dDpKihTXAZsHLbHSmLVYuur4dCWG3bdwgaDFxalWJd17o7U4xM2yy', 1, 0, 'Analytics User 6', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7ABD0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('analytics6@example.com', '$2b$12$dDpKihTXAZsHLbHSmLVYuur4dCWG3bdwgaDFxalWJd17o7U4xM2yy', 1, 0, 'Analytics User 6', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_________________________________ test_signup _________________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E23C50>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E23050>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('signup@example.com', '$2b$12$TezGsxdMkbgsB3qyGbgnDupM1HgXnuKfN.JqHBYp3EPyoh3d2p/8W', 1, 0, 'Signup User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA06A2C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('signup@example.com', '$2b$12$TezGsxdMkbgsB3qyGbgnDupM1HgXnuKfN.JqHBYp3EPyoh3d2p/8W', 1, 0, 'Signup User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E23050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: database is locked

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1BDF0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9EDE210>

    def test_signup(client: TestClient, db):
>       r = client.post(f"{settings.API_V1_STR}/users/", json={
            "email": "signup@example.com",
            "password": "password123",
            "full_name": "Signup User"
        })

tests\api\test_auth.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:546: in post
    return super().post(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:445: in request
    return super().request(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:348: in handle_request
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py:162: in __exit__
    self.gen.throw(value)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_utils.py:85: in collapse_excgroups
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\middleware\security.py:12: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\cors.py:85: in __call__
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:125: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:111: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:391: in app
    raw_response = await run_endpoint_function(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:292: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\concurrency.py:32: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
app\api\api_v1\endpoints\users.py:29: in create_user
    user = crud_user.create(db=db, obj_in=user_in)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA06A2C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('signup@example.com', '$2b$12$TezGsxdMkbgsB3qyGbgnDupM1HgXnuKfN.JqHBYp3EPyoh3d2p/8W', 1, 0, 'Signup User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E23050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('signup@example.com', '$2b$12$TezGsxdMkbgsB3qyGbgnDupM1HgXnuKfN.JqHBYp3EPyoh3d2p/8W', 1, 0, 'Signup User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_login_access_token ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F2A390>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B410>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('login@example.com', '$2b$12$3SLEQg0fFdBhtyHm3MwuyOs7ZBRLjrcLzxZK.hkDI3swHT2D98xKS', 1, 0, 'Login User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC38CB40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('login@example.com', '$2b$12$3SLEQg0fFdBhtyHm3MwuyOs7ZBRLjrcLzxZK.hkDI3swHT2D98xKS', 1, 0, 'Login User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B410>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1ABE0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DEFE30>

    def test_login_access_token(client: TestClient, db):
        email = "login@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Login User")
>       crud_user.create(db, obj_in=user_in)

tests\api\test_auth.py:22: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC38CB40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('login@example.com', '$2b$12$3SLEQg0fFdBhtyHm3MwuyOs7ZBRLjrcLzxZK.hkDI3swHT2D98xKS', 1, 0, 'Login User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B410>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('login@example.com', '$2b$12$3SLEQg0fFdBhtyHm3MwuyOs7ZBRLjrcLzxZK.hkDI3swHT2D98xKS', 1, 0, 'Login User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
__________________________ test_get_my_certificates ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F2AC90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2AB10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E40410>
parameters = [('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021EC9F08940>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2AB10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1A470>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F54E60>

    def test_get_my_certificates(client: TestClient, db):
>       user, course = create_user_and_course(db)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_certificates.py:29: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests\api\test_certificates.py:12: in create_user_and_course
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021EC9F08940>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2AB10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
__________________________ test_download_certificate __________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F29A90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E40410>
parameters = [('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA7E7640>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1A360>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F566C0>

    def test_download_certificate(client: TestClient, db):
>       user, course = create_user_and_course(db)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_certificates.py:45: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
tests\api\test_certificates.py:12: in create_user_and_course
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA7E7640>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_upload_handwriting ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021ECA701FD0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A5D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('grapho@example.com', '$2b$12$6hbfa82e/y9/pDY1Jzgd4.Moet2eVgUB9JbAz6fKhBCzIKoCLM7dS', 1, 0, 'Grapho User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8381C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('grapho@example.com', '$2b$12$6hbfa82e/y9/pDY1Jzgd4.Moet2eVgUB9JbAz6fKhBCzIKoCLM7dS', 1, 0, 'Grapho User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A5D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F19AE0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F57B60>

    def test_upload_handwriting(client: TestClient, db):
        # Create user and login
        email = "grapho@example.com"
        password = "password"
        user_in = UserCreate(email=email, password=password, full_name="Grapho User")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_grapho.py:11: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8381C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('grapho@example.com', '$2b$12$6hbfa82e/y9/pDY1Jzgd4.Moet2eVgUB9JbAz6fKhBCzIKoCLM7dS', 1, 0, 'Grapho User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A5D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('grapho@example.com', '$2b$12$6hbfa82e/y9/pDY1Jzgd4.Moet2eVgUB9JbAz6fKhBCzIKoCLM7dS', 1, 0, 'Grapho User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_____________________________ test_join_wolf_pack _____________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F2A510>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8787050>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('wolf1@example.com', '$2b$12$61ypSkHDqRqNAb3IN1K7du3HHTupOeZEvq1JoSzb5tOD85MNxjozy', 1, 0, 'Wolf User 1', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAB71AC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('wolf1@example.com', '$2b$12$61ypSkHDqRqNAb3IN1K7du3HHTupOeZEvq1JoSzb5tOD85MNxjozy', 1, 0, 'Wolf User 1', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8787050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F196A0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F566C0>

    def test_join_wolf_pack(client: TestClient, db):
        """Test user joining a Wolf Pack group."""
        # Create and login user
        email = "wolf1@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Wolf User 1")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:18: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAB71AC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('wolf1@example.com', '$2b$12$61ypSkHDqRqNAb3IN1K7du3HHTupOeZEvq1JoSzb5tOD85MNxjozy', 1, 0, 'Wolf User 1', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8787050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('wolf1@example.com', '$2b$12$61ypSkHDqRqNAb3IN1K7du3HHTupOeZEvq1JoSzb5tOD85MNxjozy', 1, 0, 'Wolf User 1', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_________________ test_multiple_users_same_streak_same_group __________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021ECA700E90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29A90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('wolfpack0@example.com', '$2b$12$jzfbEGc4clAICGxRQbMbLO92OhX8EpSu/Syn7bkubAFOlLrJGlNWi', 1, 0, 'Pack User 0', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8E6740>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('wolfpack0@example.com', '$2b$12$jzfbEGc4clAICGxRQbMbLO92OhX8EpSu/Syn7bkubAFOlLrJGlNWi', 1, 0, 'Pack User 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29A90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1B460>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F554F0>

    def test_multiple_users_same_streak_same_group(client: TestClient, db):
        """Test that users with similar streaks are grouped together."""
        users_data = []
    
        # Create 3 users with similar streaks (5-7 days)
        for i in range(3):
            email = f"wolfpack{i}@example.com"
            password = "password123"
            user_in = UserCreate(email=email, password=password, full_name=f"Pack User {i}")
>           user = crud_user.create(db, obj_in=user_in)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:53: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8E6740>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('wolfpack0@example.com', '$2b$12$jzfbEGc4clAICGxRQbMbLO92OhX8EpSu/Syn7bkubAFOlLrJGlNWi', 1, 0, 'Pack User 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29A90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('wolfpack0@example.com', '$2b$12$jzfbEGc4clAICGxRQbMbLO92OhX8EpSu/Syn7bkubAFOlLrJGlNWi', 1, 0, 'Pack User 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
______________________________ test_get_my_group ______________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F2A510>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8787050>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('wolf2@example.com', '$2b$12$9PCR9Ac4LDbtQbWYzYgkYeQSEwpxArxjXPi.H5YAwaycTbXXKgqqe', 1, 0, 'Wolf User 2', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8ED9C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('wolf2@example.com', '$2b$12$9PCR9Ac4LDbtQbWYzYgkYeQSEwpxArxjXPi.H5YAwaycTbXXKgqqe', 1, 0, 'Wolf User 2', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8787050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F18270>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F57A70>

    def test_get_my_group(client: TestClient, db):
        """Test getting current user's group with stats."""
        # Create and login user
        email = "wolf2@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Wolf User 2")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:84: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8ED9C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('wolf2@example.com', '$2b$12$9PCR9Ac4LDbtQbWYzYgkYeQSEwpxArxjXPi.H5YAwaycTbXXKgqqe', 1, 0, 'Wolf User 2', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8787050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('wolf2@example.com', '$2b$12$9PCR9Ac4LDbtQbWYzYgkYeQSEwpxArxjXPi.H5YAwaycTbXXKgqqe', 1, 0, 'Wolf User 2', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_group_leaderboard ____________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021ECA701F10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('leader0@example.com', '$2b$12$Wo4sJ5oZEYAT3V4AzY8ygOQPoMD.Oui1s/4Xgil.cg5gC7j01Ag2C', 1, 0, 'Leader 0', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAFB0F40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('leader0@example.com', '$2b$12$Wo4sJ5oZEYAT3V4AzY8ygOQPoMD.Oui1s/4Xgil.cg5gC7j01Ag2C', 1, 0, 'Leader 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F18AF0>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF5A120>

    def test_group_leaderboard(client: TestClient, db):
        """Test Wolf Pack leaderboard ranking."""
        # Create multiple users and groups
        for i in range(5):
            email = f"leader{i}@example.com"
            password = "password123"
            user_in = UserCreate(email=email, password=password, full_name=f"Leader {i}")
>           user = crud_user.create(db, obj_in=user_in)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:124: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAFB0F40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('leader0@example.com', '$2b$12$Wo4sJ5oZEYAT3V4AzY8ygOQPoMD.Oui1s/4Xgil.cg5gC7j01Ag2C', 1, 0, 'Leader 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('leader0@example.com', '$2b$12$Wo4sJ5oZEYAT3V4AzY8ygOQPoMD.Oui1s/4Xgil.cg5gC7j01Ag2C', 1, 0, 'Leader 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_leaderboard_limit ____________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021ECA702990>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021ECA702690>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E43750>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAC4E340>
statement = 'SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url \nFROM groups'
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021ECA702690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: groups

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1B020>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF5A030>

    def test_leaderboard_limit(client: TestClient, db):
        """Test leaderboard respects limit parameter."""
        # Get leaderboard with limit
>       r = client.get(f"{settings.API_V1_STR}/groups/leaderboard?limit=5")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:167: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:473: in get
    return super().get(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:1053: in get
    return self.request(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:445: in request
    return super().request(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:348: in handle_request
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py:162: in __exit__
    self.gen.throw(value)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_utils.py:85: in collapse_excgroups
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\middleware\security.py:12: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\cors.py:85: in __call__
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:125: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:111: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:391: in app
    raw_response = await run_endpoint_function(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:292: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\concurrency.py:32: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
app\api\api_v1\endpoints\groups.py:69: in get_leaderboard
    groups = db.query(Group).all()
             ^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py:2704: in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2351: in execute
    return self._execute_internal(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAC4E340>
statement = 'SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url \nFROM groups'
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021ECA702690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: groups
E       [SQL: SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url 
E       FROM groups]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
________________________ test_group_stats_calculation _________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021ECA702510>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('stats0@example.com', '$2b$12$CYD/4qfD9ST/xgLuqUH8heDZ6e7iZ0s3BZkFzByX0JbBZiMwhL80W', 1, 0, 'Stats User 0', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA575440>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('stats0@example.com', '$2b$12$CYD/4qfD9ST/xgLuqUH8heDZ6e7iZ0s3BZkFzByX0JbBZiMwhL80W', 1, 0, 'Stats User 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD1480>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF5AD50>

    def test_group_stats_calculation(client: TestClient, db):
        """Test that group statistics are calculated correctly."""
        # Create multiple users for the same group
        tokens = []
        expected_total_coins = 0
        expected_streaks = []
    
        for i in range(3):
            email = f"stats{i}@example.com"
            password = "password123"
            user_in = UserCreate(email=email, password=password, full_name=f"Stats User {i}")
>           user = crud_user.create(db, obj_in=user_in)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:186: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA575440>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('stats0@example.com', '$2b$12$CYD/4qfD9ST/xgLuqUH8heDZ6e7iZ0s3BZkFzByX0JbBZiMwhL80W', 1, 0, 'Stats User 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F281D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('stats0@example.com', '$2b$12$CYD/4qfD9ST/xgLuqUH8heDZ6e7iZ0s3BZkFzByX0JbBZiMwhL80W', 1, 0, 'Stats User 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_____________________ test_group_max_members_enforcement ______________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021ECA703950>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021ECA702750>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('maxtest0@example.com', '$2b$12$0h3hIsfMpARwfW9ubIRGkOlLKGacCl3n.JeE1f8aTE2pyOBd8Jj9m', 1, 0, 'Max User 0', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECBA04740>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('maxtest0@example.com', '$2b$12$0h3hIsfMpARwfW9ubIRGkOlLKGacCl3n.JeE1f8aTE2pyOBd8Jj9m', 1, 0, 'Max User 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021ECA702750>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD3570>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF59220>

    def test_group_max_members_enforcement(client: TestClient, db):
        """Test that group max member limit (5) is respected."""
        # Create 6 users with same streak
        tokens = []
        for i in range(6):
            email = f"maxtest{i}@example.com"
            password = "password123"
            user_in = UserCreate(email=email, password=password, full_name=f"Max User {i}")
>           user = crud_user.create(db, obj_in=user_in)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:229: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECBA04740>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('maxtest0@example.com', '$2b$12$0h3hIsfMpARwfW9ubIRGkOlLKGacCl3n.JeE1f8aTE2pyOBd8Jj9m', 1, 0, 'Max User 0', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021ECA702750>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('maxtest0@example.com', '$2b$12$0h3hIsfMpARwfW9ubIRGkOlLKGacCl3n.JeE1f8aTE2pyOBd8Jj9m', 1, 0, 'Max User 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
____________________________ test_join_group_twice ____________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F28A10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29610>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('twice@example.com', '$2b$12$UkQj53XEGUAT7Jxk64vkHO8YATlh80mPHKu4sr4lwR.RrGs.GotYK', 1, 0, 'Twice User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8E6DC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('twice@example.com', '$2b$12$UkQj53XEGUAT7Jxk64vkHO8YATlh80mPHKu4sr4lwR.RrGs.GotYK', 1, 0, 'Twice User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29610>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD1AE0>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF596D0>

    def test_join_group_twice(client: TestClient, db):
        """Test that joining group again returns same group (idempotent)."""
        # Create and login user
        email = "twice@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Twice User")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:259: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8E6DC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('twice@example.com', '$2b$12$UkQj53XEGUAT7Jxk64vkHO8YATlh80mPHKu4sr4lwR.RrGs.GotYK', 1, 0, 'Twice User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29610>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('twice@example.com', '$2b$12$UkQj53XEGUAT7Jxk64vkHO8YATlh80mPHKu4sr4lwR.RrGs.GotYK', 1, 0, 'Twice User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
__________________________ test_unauthorized_access ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F2A5D0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29190>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E43750>
parameters = [()]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA7E7740>
statement = 'SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url \nFROM groups'
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29190>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: groups

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD1150>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF5B200>

    def test_unauthorized_access(client: TestClient, db):
        """Test that endpoints require authentication where needed."""
        # my-group requires auth
        r = client.get(f"{settings.API_V1_STR}/groups/my-group")
        assert r.status_code == 401
    
        # join requires auth
        r = client.post(f"{settings.API_V1_STR}/groups/join")
        assert r.status_code == 401
    
        # leaderboard is public - should work without auth
>       r = client.get(f"{settings.API_V1_STR}/groups/leaderboard")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_groups.py:291: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:473: in get
    return super().get(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:1053: in get
    return self.request(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:445: in request
    return super().request(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:348: in handle_request
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py:401: in __get_result
    raise self._exception
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\applications.py:1134: in __call__
    await super().__call__(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py:162: in __exit__
    self.gen.throw(value)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_utils.py:85: in collapse_excgroups
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\middleware\security.py:12: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\cors.py:85: in __call__
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:125: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:111: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:391: in app
    raw_response = await run_endpoint_function(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\fastapi\routing.py:292: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\starlette\concurrency.py:32: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\anyio\_backends\_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
app\api\api_v1\endpoints\groups.py:69: in get_leaderboard
    groups = db.query(Group).all()
             ^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py:2704: in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\query.py:2857: in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2351: in execute
    return self._execute_internal(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\context.py:306: in orm_execute_statement
    result = conn.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA7E7740>
statement = 'SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url \nFROM groups'
parameters = ()
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F29190>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: groups
E       [SQL: SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url 
E       FROM groups]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_______________________ test_certificate_number_format ________________________

db = <sqlalchemy.orm.session.Session object at 0x0000021EC9DBD130>

    def test_certificate_number_format(db: Session):
        """Test certificate number generation format"""
        cert_number = Certificate.generate_certificate_number()
        assert cert_number.startswith("CERT-")
>       assert len(cert_number) == 15  # CERT-YYYY-XXXXXX format
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AssertionError: assert 16 == 15
E        +  where 16 = len('CERT-2025-B8B045')

tests\api\test_lms.py:584: AssertionError
__________________________ test_exam_monitoring_flow __________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F2A690>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A510>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('monitor@example.com', '$2b$12$Znx4d3.DZdfp7XLZsnUwaeUGB5Vav1g/4sd535EuisARHzHWn67oS', 1, 0, 'Monitor User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC5A5C40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('monitor@example.com', '$2b$12$Znx4d3.DZdfp7XLZsnUwaeUGB5Vav1g/4sd535EuisARHzHWn67oS', 1, 0, 'Monitor User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A510>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD2250>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F554F0>

    def test_exam_monitoring_flow(client: TestClient, db):
        # Create user and login
        email = "monitor@example.com"
        password = "password"
        user_in = UserCreate(email=email, password=password, full_name="Monitor User")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_monitoring.py:11: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC5A5C40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('monitor@example.com', '$2b$12$Znx4d3.DZdfp7XLZsnUwaeUGB5Vav1g/4sd535EuisARHzHWn67oS', 1, 0, 'Monitor User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A510>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('monitor@example.com', '$2b$12$Znx4d3.DZdfp7XLZsnUwaeUGB5Vav1g/4sd535EuisARHzHWn67oS', 1, 0, 'Monitor User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
__________________________ test_start_shadow_session __________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC8D7ABD0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B4D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow@example.com', '$2b$12$NkaPd3asVaxgI6EOq5RpqemaGQtht00tPUDfR8hHq8NIBtqlR.wgO', 1, 0, 'Shadow User', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC38E240>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow@example.com', '$2b$12$NkaPd3asVaxgI6EOq5RpqemaGQtht00tPUDfR8hHq8NIBtqlR.wgO', 1, 0, 'Shadow User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B4D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD1260>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF589B0>

    def test_start_shadow_session(client: TestClient, db):
        """Test starting a new shadow mode session."""
        # Create and login user
        email = "shadow@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:19: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC38E240>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow@example.com', '$2b$12$NkaPd3asVaxgI6EOq5RpqemaGQtht00tPUDfR8hHq8NIBtqlR.wgO', 1, 0, 'Shadow User', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7B4D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow@example.com', '$2b$12$NkaPd3asVaxgI6EOq5RpqemaGQtht00tPUDfR8hHq8NIBtqlR.wgO', 1, 0, 'Shadow User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________ test_start_session_with_active_session ____________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E23410>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E225D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow2@example.com', '$2b$12$BhiKaDteEtjxDGrfdwwkOO0jVrVDI.FHyhxcqN/E1GmVi5kxFHdLu', 1, 0, 'Shadow User 2', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA3717C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow2@example.com', '$2b$12$BhiKaDteEtjxDGrfdwwkOO0jVrVDI.FHyhxcqN/E1GmVi5kxFHdLu', 1, 0, 'Shadow User 2', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E225D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD3020>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF588C0>

    def test_start_session_with_active_session(client: TestClient, db):
        """Test that starting a session when one is active returns error."""
        # Create and login user
        email = "shadow2@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 2")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:46: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA3717C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow2@example.com', '$2b$12$BhiKaDteEtjxDGrfdwwkOO0jVrVDI.FHyhxcqN/E1GmVi5kxFHdLu', 1, 0, 'Shadow User 2', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E225D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow2@example.com', '$2b$12$BhiKaDteEtjxDGrfdwwkOO0jVrVDI.FHyhxcqN/E1GmVi5kxFHdLu', 1, 0, 'Shadow User 2', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_end_shadow_session ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E23A10>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E23050>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow3@example.com', '$2b$12$dFc7pnBU3NPBYsQdL8o4xu7EEfGqOgAXeh8QA9o53IP2df/l7nTeu', 1, 0, 'Shadow User 3', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC38DF40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow3@example.com', '$2b$12$dFc7pnBU3NPBYsQdL8o4xu7EEfGqOgAXeh8QA9o53IP2df/l7nTeu', 1, 0, 'Shadow User 3', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E23050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD28B0>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F573E0>

    def test_end_shadow_session(client: TestClient, db):
        """Test ending a shadow mode session and coin calculation."""
        # Create and login user
        email = "shadow3@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 3")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:76: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECC38DF40>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow3@example.com', '$2b$12$dFc7pnBU3NPBYsQdL8o4xu7EEfGqOgAXeh8QA9o53IP2df/l7nTeu', 1, 0, 'Shadow User 3', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E23050>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow3@example.com', '$2b$12$dFc7pnBU3NPBYsQdL8o4xu7EEfGqOgAXeh8QA9o53IP2df/l7nTeu', 1, 0, 'Shadow User 3', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_______________________ test_end_session_without_active _______________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC8D7B410>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7AED0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow4@example.com', '$2b$12$7Ri9dvfo/C9B5YGXY3A7wu4wWGp4OHfvVf9gj0tveG.O3a7GC0QAO', 1, 0, 'Shadow User 4', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8ED940>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow4@example.com', '$2b$12$7Ri9dvfo/C9B5YGXY3A7wu4wWGp4OHfvVf9gj0tveG.O3a7GC0QAO', 1, 0, 'Shadow User 4', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7AED0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD3790>
db = <sqlalchemy.orm.session.Session object at 0x0000021ECAF5A3F0>

    def test_end_session_without_active(client: TestClient, db):
        """Test ending session when no active session exists."""
        # Create and login user
        email = "shadow4@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 4")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:111: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA8ED940>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow4@example.com', '$2b$12$7Ri9dvfo/C9B5YGXY3A7wu4wWGp4OHfvVf9gj0tveG.O3a7GC0QAO', 1, 0, 'Shadow User 4', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC8D7AED0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow4@example.com', '$2b$12$7Ri9dvfo/C9B5YGXY3A7wu4wWGp4OHfvVf9gj0tveG.O3a7GC0QAO', 1, 0, 'Shadow User 4', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
__________________________ test_get_shadow_progress ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E22F90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow5@example.com', '$2b$12$oo1eK3vts69nzJWM/YzE..XUKhIsYm9GbXfZ2YikSW1lgbKsoX4de', 1, 0, 'Shadow User 5', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAB71CC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow5@example.com', '$2b$12$oo1eK3vts69nzJWM/YzE..XUKhIsYm9GbXfZ2YikSW1lgbKsoX4de', 1, 0, 'Shadow User 5', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD1040>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F565D0>

    def test_get_shadow_progress(client: TestClient, db):
        """Test getting 7-day shadow mode progress."""
        # Create and login user
        email = "shadow5@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 5")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:133: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECAB71CC0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow5@example.com', '$2b$12$oo1eK3vts69nzJWM/YzE..XUKhIsYm9GbXfZ2YikSW1lgbKsoX4de', 1, 0, 'Shadow User 5', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20D10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow5@example.com', '$2b$12$oo1eK3vts69nzJWM/YzE..XUKhIsYm9GbXfZ2YikSW1lgbKsoX4de', 1, 0, 'Shadow User 5', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
__________________________ test_get_current_session ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC8D7B290>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20E90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow6@example.com', '$2b$12$JzT3XvBXEUWzM1lNhn0zReI9pCuEO1DH/E8gmdjoGZDy1xE.60l36', 1, 0, 'Shadow User 6', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECB300540>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow6@example.com', '$2b$12$JzT3XvBXEUWzM1lNhn0zReI9pCuEO1DH/E8gmdjoGZDy1xE.60l36', 1, 0, 'Shadow User 6', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20E90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD2250>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F558B0>

    def test_get_current_session(client: TestClient, db):
        """Test getting currently active shadow mode session."""
        # Create and login user
        email = "shadow6@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 6")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:173: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECB300540>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow6@example.com', '$2b$12$JzT3XvBXEUWzM1lNhn0zReI9pCuEO1DH/E8gmdjoGZDy1xE.60l36', 1, 0, 'Shadow User 6', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E20E90>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow6@example.com', '$2b$12$JzT3XvBXEUWzM1lNhn0zReI9pCuEO1DH/E8gmdjoGZDy1xE.60l36', 1, 0, 'Shadow User 6', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
_______________________ test_coin_calculation_accuracy ________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9F29A90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A690>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow7@example.com', '$2b$12$gHXVLxBGmuT1scoAkRpdHOJfhTLPlyTm3F05MgWZ8iwQai3hePQVi', 1, 0, 'Shadow User 7', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA2496C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow7@example.com', '$2b$12$gHXVLxBGmuT1scoAkRpdHOJfhTLPlyTm3F05MgWZ8iwQai3hePQVi', 1, 0, 'Shadow User 7', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9DD3020>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9ED63F0>

    def test_coin_calculation_accuracy(client: TestClient, db):
        """Test that coin calculation is accurate based on completion and focus."""
        # Create and login user
        email = "shadow7@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 7")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:210: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA2496C0>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow7@example.com', '$2b$12$gHXVLxBGmuT1scoAkRpdHOJfhTLPlyTm3F05MgWZ8iwQai3hePQVi', 1, 0, 'Shadow User 7', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9F2A690>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow7@example.com', '$2b$12$gHXVLxBGmuT1scoAkRpdHOJfhTLPlyTm3F05MgWZ8iwQai3hePQVi', 1, 0, 'Shadow User 7', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
___________________________ test_session_with_notes ___________________________

self = <sqlalchemy.engine.base.Connection object at 0x0000021EC9E23410>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E225D0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x0000021EC9E10EC0>
parameters = [('shadow8@example.com', '$2b$12$1wEBVwpp8ZC3GgdqvYVpaulQG79njYcpwgombSy24O/mZkBP/kbCG', 1, 0, 'Shadow User 8', 0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA7E7840>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow8@example.com', '$2b$12$1wEBVwpp8ZC3GgdqvYVpaulQG79njYcpwgombSy24O/mZkBP/kbCG', 1, 0, 'Shadow User 8', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E225D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x0000021EC9F1A470>
db = <sqlalchemy.orm.session.Session object at 0x0000021EC9F54320>

    def test_session_with_notes(client: TestClient, db):
        """Test that session notes are properly saved."""
        # Create and login user
        email = "shadow8@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Shadow User 8")
>       user = crud_user.create(db, obj_in=user_in)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\api\test_shadow_mode.py:250: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
app\crud\user.py:21: in create
    db.commit()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:1286: in _prepare_impl
    self.session.flush()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4331: in flush
    self._flush(objects)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4466: in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\util\langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\session.py:4427: in _flush
    flush_context.execute()
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\orm\persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1419: in execute
    return meth(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\sql\elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1846: in _execute_context
    return self._exec_single_context(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x0000021E8979A350>
cursor = <sqlite3.Cursor object at 0x0000021ECA7E7840>
statement = 'INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, gro...ications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('shadow8@example.com', '$2b$12$1wEBVwpp8ZC3GgdqvYVpaulQG79njYcpwgombSy24O/mZkBP/kbCG', 1, 0, 'Shadow User 8', 0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x0000021EC9E225D0>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('shadow8@example.com', '$2b$12$1wEBVwpp8ZC3GgdqvYVpaulQG79njYcpwgombSy24O/mZkBP/kbCG', 1, 0, 'Shadow User 8', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\sqlalchemy\engine\default.py:951: OperationalError
============================== warnings summary ===============================
app\db\session.py:7
  D:\Graphology\Master Software\Eduecosystem\backend\app\db\session.py:7: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\detection.py:81
  C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\detection.py:81: DeprecationWarning: torch.ao.quantization is deprecated and will be removed in 2.10. 
  For migrations of users: 
  1. Eager mode quantization (torch.ao.quantization.quantize, torch.ao.quantization.quantize_dynamic), please migrate to use torchao eager mode quantize_ API instead 
  2. FX graph mode quantization (torch.ao.quantization.quantize_fx.prepare_fx,torch.ao.quantization.quantize_fx.convert_fx, please migrate to use torchao pt2e quantization API instead (prepare_pt2e, convert_pt2e) 
  3. pt2e quantization has been migrated to torchao (https://github.com/pytorch/ao/tree/main/torchao/quantization/pt2e) 
  see https://github.com/pytorch/ao/issues/2259 for more details
    torch.quantization.quantize_dynamic(net, dtype=torch.qint8, inplace=True)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\torch\ao\quantization\quantize.py:566
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\torch\ao\quantization\quantize.py:566
  C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\torch\ao\quantization\quantize.py:566: DeprecationWarning: torch.ao.quantization is deprecated and will be removed in 2.10. 
  For migrations of users: 
  1. Eager mode quantization (torch.ao.quantization.quantize, torch.ao.quantization.quantize_dynamic), please migrate to use torchao eager mode quantize_ API instead 
  2. FX graph mode quantization (torch.ao.quantization.quantize_fx.prepare_fx,torch.ao.quantization.quantize_fx.convert_fx, please migrate to use torchao pt2e quantization API instead (prepare_pt2e, convert_pt2e) 
  3. pt2e quantization has been migrated to torchao (https://github.com/pytorch/ao/tree/main/torchao/quantization/pt2e) 
  see https://github.com/pytorch/ao/issues/2259 for more details
    convert(model, mapping, inplace=True)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\recognition.py:177
  C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\recognition.py:177: DeprecationWarning: torch.ao.quantization is deprecated and will be removed in 2.10. 
  For migrations of users: 
  1. Eager mode quantization (torch.ao.quantization.quantize, torch.ao.quantization.quantize_dynamic), please migrate to use torchao eager mode quantize_ API instead 
  2. FX graph mode quantization (torch.ao.quantization.quantize_fx.prepare_fx,torch.ao.quantization.quantize_fx.convert_fx, please migrate to use torchao pt2e quantization API instead (prepare_pt2e, convert_pt2e) 
  3. pt2e quantization has been migrated to torchao (https://github.com/pytorch/ao/tree/main/torchao/quantization/pt2e) 
  see https://github.com/pytorch/ao/issues/2259 for more details
    torch.quantization.quantize_dynamic(model, dtype=torch.qint8, inplace=True)

tests/api/test_admin.py: 12 warnings
tests/api/test_analytics.py: 2 warnings
  D:\Graphology\Master Software\Eduecosystem\backend\app\core\security.py:16: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + expires_delta

tests/api/test_analytics.py: 6 warnings
tests/api/test_auth.py: 2 warnings
tests/api/test_certificates.py: 2 warnings
tests/api/test_grapho.py: 1 warning
tests/api/test_groups.py: 7 warnings
tests/api/test_monitoring.py: 1 warning
tests/api/test_shadow_mode.py: 8 warnings
  D:\Graphology\Master Software\Eduecosystem\backend\tests\conftest.py:56: SAWarning: transaction already deassociated from connection
    transaction.rollback()

tests/api/test_analytics.py: 10 warnings
  D:\Graphology\Master Software\Eduecosystem\backend\tests\api\test_analytics.py:264: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/api/test_analytics.py::test_analytics_empty_state
  D:\Graphology\Master Software\Eduecosystem\backend\app\api\api_v1\endpoints\analytics.py:23: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    seven_days_ago = datetime.utcnow() - timedelta(days=7)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/api/test_admin.py::test_admin_stats_endpoint - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_admin_only_access - assert (404 == 403 or 404 == 401)
 +  where 404 = <Response [404 Not Found]>.status_code
 +  and   404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_list_all_users - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_search_users - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_ban_user - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_unban_user - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_promote_to_admin - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_delete_user - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_cannot_delete_admin - assert 404 == 403
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_get_user_details - TypeError: 'file_path' is an invalid keyword argument for HandwritingSubmission
FAILED tests/api/test_admin.py::test_admin_logs - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_filter_users_by_role - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_filter_banned_users - assert 404 == 200
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_admin.py::test_unauthorized_admin_access - assert 404 == 401
 +  where 404 = <Response [404 Not Found]>.status_code
FAILED tests/api/test_analytics.py::test_dashboard_analytics_basic - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('analytics1@example.com', '$2b$12$rmKX8xFYthEQBlqYIMcfdOGKzPEbdb9xyhL7Hb/pv.eJo16ZbVpJ2', 1, 0, 'Analytics User 1', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_analytics.py::test_analytics_with_shadow_sessions - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('analytics2@example.com', '$2b$12$yMCP9L7K7fxpuKjANxUTmOyBhXh/13NOAy4F0GX5mDqIGyzVqT3n.', 1, 0, 'Analytics User 2', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_analytics.py::test_analytics_handwriting_count - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('analytics3@example.com', '$2b$12$JQmB6Il8FBgN2YTeN0xoz./khYw68R6PV9./q/dsaLngZY58pAwH2', 1, 0, 'Analytics User 3', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_analytics.py::test_analytics_insights_generation - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('analytics4@example.com', '$2b$12$jJMiwH9EshyISAKq9R4obO/f3zW6HFgQ29yJveGi2UJMAOQ6A3c2O', 1, 0, 'Analytics User 4', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_analytics.py::test_analytics_attention_tracking - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('analytics5@example.com', '$2b$12$iaMTnItxXTMHokLZIpBaUeml2aXwyxmOB6NGCevLhjvRcxa5PKYEu', 1, 0, 'Analytics User 5', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_analytics.py::test_detailed_analytics - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('analytics6@example.com', '$2b$12$dDpKihTXAZsHLbHSmLVYuur4dCWG3bdwgaDFxalWJd17o7U4xM2yy', 1, 0, 'Analytics User 6', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_auth.py::test_signup - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('signup@example.com', '$2b$12$TezGsxdMkbgsB3qyGbgnDupM1HgXnuKfN.JqHBYp3EPyoh3d2p/8W', 1, 0, 'Signup User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_auth.py::test_login_access_token - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('login@example.com', '$2b$12$3SLEQg0fFdBhtyHm3MwuyOs7ZBRLjrcLzxZK.hkDI3swHT2D98xKS', 1, 0, 'Login User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_certificates.py::test_get_my_certificates - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_certificates.py::test_download_certificate - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('cert_user@example.com', 'fakehashed', 1, 0, 'Cert User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_grapho.py::test_upload_handwriting - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('grapho@example.com', '$2b$12$6hbfa82e/y9/pDY1Jzgd4.Moet2eVgUB9JbAz6fKhBCzIKoCLM7dS', 1, 0, 'Grapho User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_join_wolf_pack - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('wolf1@example.com', '$2b$12$61ypSkHDqRqNAb3IN1K7du3HHTupOeZEvq1JoSzb5tOD85MNxjozy', 1, 0, 'Wolf User 1', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_multiple_users_same_streak_same_group - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('wolfpack0@example.com', '$2b$12$jzfbEGc4clAICGxRQbMbLO92OhX8EpSu/Syn7bkubAFOlLrJGlNWi', 1, 0, 'Pack User 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_get_my_group - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('wolf2@example.com', '$2b$12$9PCR9Ac4LDbtQbWYzYgkYeQSEwpxArxjXPi.H5YAwaycTbXXKgqqe', 1, 0, 'Wolf User 2', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_group_leaderboard - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('leader0@example.com', '$2b$12$Wo4sJ5oZEYAT3V4AzY8ygOQPoMD.Oui1s/4Xgil.cg5gC7j01Ag2C', 1, 0, 'Leader 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_leaderboard_limit - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: groups
[SQL: SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url 
FROM groups]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_group_stats_calculation - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('stats0@example.com', '$2b$12$CYD/4qfD9ST/xgLuqUH8heDZ6e7iZ0s3BZkFzByX0JbBZiMwhL80W', 1, 0, 'Stats User 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_group_max_members_enforcement - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('maxtest0@example.com', '$2b$12$0h3hIsfMpARwfW9ubIRGkOlLKGacCl3n.JeE1f8aTE2pyOBd8Jj9m', 1, 0, 'Max User 0', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_join_group_twice - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('twice@example.com', '$2b$12$UkQj53XEGUAT7Jxk64vkHO8YATlh80mPHKu4sr4lwR.RrGs.GotYK', 1, 0, 'Twice User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_groups.py::test_unauthorized_access - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: groups
[SQL: SELECT groups.id AS groups_id, groups.name AS groups_name, groups.description AS groups_description, groups.avatar_url AS groups_avatar_url 
FROM groups]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_lms.py::test_certificate_number_format - AssertionError: assert 16 == 15
 +  where 16 = len('CERT-2025-B8B045')
FAILED tests/api/test_monitoring.py::test_exam_monitoring_flow - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('monitor@example.com', '$2b$12$Znx4d3.DZdfp7XLZsnUwaeUGB5Vav1g/4sd535EuisARHzHWn67oS', 1, 0, 'Monitor User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_start_shadow_session - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow@example.com', '$2b$12$NkaPd3asVaxgI6EOq5RpqemaGQtht00tPUDfR8hHq8NIBtqlR.wgO', 1, 0, 'Shadow User', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_start_session_with_active_session - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow2@example.com', '$2b$12$BhiKaDteEtjxDGrfdwwkOO0jVrVDI.FHyhxcqN/E1GmVi5kxFHdLu', 1, 0, 'Shadow User 2', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_end_shadow_session - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow3@example.com', '$2b$12$dFc7pnBU3NPBYsQdL8o4xu7EEfGqOgAXeh8QA9o53IP2df/l7nTeu', 1, 0, 'Shadow User 3', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_end_session_without_active - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow4@example.com', '$2b$12$7Ri9dvfo/C9B5YGXY3A7wu4wWGp4OHfvVf9gj0tveG.O3a7GC0QAO', 1, 0, 'Shadow User 4', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_get_shadow_progress - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow5@example.com', '$2b$12$oo1eK3vts69nzJWM/YzE..XUKhIsYm9GbXfZ2YikSW1lgbKsoX4de', 1, 0, 'Shadow User 5', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_get_current_session - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow6@example.com', '$2b$12$JzT3XvBXEUWzM1lNhn0zReI9pCuEO1DH/E8gmdjoGZDy1xE.60l36', 1, 0, 'Shadow User 6', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_coin_calculation_accuracy - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow7@example.com', '$2b$12$gHXVLxBGmuT1scoAkRpdHOJfhTLPlyTm3F05MgWZ8iwQai3hePQVi', 1, 0, 'Shadow User 7', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/api/test_shadow_mode.py::test_session_with_notes - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: INSERT INTO users (email, hashed_password, is_active, is_superuser, full_name, coins, streak_days, token_version, group_id, role, last_login, is_banned, email_notifications, is_premium, stripe_customer_id, subscription_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: ('shadow8@example.com', '$2b$12$1wEBVwpp8ZC3GgdqvYVpaulQG79njYcpwgombSy24O/mZkBP/kbCG', 1, 0, 'Shadow User 8', 0, 0, 1, None, 'user', None, 0, 1, 0, None, 'free')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR tests/api/test_lms.py::test_list_courses - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_list_courses_with_category_filter - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_list_courses_with_level_filter - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_list_courses_with_search - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_create_course_instructor_only - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_create_course_student_forbidden - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_get_course_details - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_update_course_instructor - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_delete_course_instructor - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_add_module_to_course - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_add_lesson_to_module - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_update_module - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_delete_module - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_delete_lesson - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_enroll_in_free_course - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_duplicate_enrollment_prevented - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_get_my_courses - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_get_course_progress - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_update_lesson_progress - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_course_progress_percentage_updates - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_enroll_requires_authentication - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_enroll_in_nonexistent_course - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_get_certificate_not_completed - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_get_my_certificates_empty - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_certificate_requires_authentication - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
ERROR tests/api/test_lms.py::test_download_certificate_unauthorized - assert 404 in [200, 201]
 +  where 404 = <Response [404 Not Found]>.status_code
= 44 failed, 6 passed, 5 skipped, 57 warnings, 26 errors in 100.61s (0:01:40) =
