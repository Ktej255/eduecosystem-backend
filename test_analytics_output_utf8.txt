============================= test session starts =============================
platform win32 -- Python 3.13.2, pytest-9.0.1, pluggy-1.6.0
rootdir: D:\Graphology\Master Software\Eduecosystem\backend
configfile: pytest.ini
plugins: anyio-4.11.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 9 items

tests\api\test_analytics.py F........                                    [100%]

================================== FAILURES ===================================
_______________________ test_dashboard_analytics_basic ________________________

client = <starlette.testclient.TestClient object at 0x00000196B6599D30>
db = <sqlalchemy.orm.session.Session object at 0x00000196B6599A90>

    def test_dashboard_analytics_basic(client: TestClient, db):
        """Test basic dashboard analytics retrieval."""
        # Create and login user
        email = "analytics1@example.com"
        password = "password123"
        user_in = UserCreate(email=email, password=password, full_name="Analytics User 1")
        user = crud_user.create(db, obj_in=user_in)
        user.coins = 250
        user.streak_days = 5
        db.commit()
    
        login_data = {"username": email, "password": password}
        r = client.post(f"{settings.API_V1_STR}/login/access-token", data=login_data)
        token = r.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Get dashboard analytics
        r = client.get(f"{settings.API_V1_STR}/analytics/dashboard", headers=headers)
        assert r.status_code == 200
        data = r.json()
    
        # Verify structure
        assert "user" in data
>       assert data["user"]["coins"] == 250
E       assert 255 == 250

tests\api\test_analytics.py:38: AssertionError
----------------------------- Captured log setup ------------------------------
WARNING  app.core.redis_cache:redis_cache.py:37 Redis connection failed: Error 10061 connecting to localhost:6379. No connection could be made because the target machine actively refused it.. Caching disabled.
WARNING  main:main.py:38 Redis cache not available - running without cache
============================== warnings summary ===============================
app\schemas\coupon.py:28
  D:\Graphology\Master Software\Eduecosystem\backend\app\schemas\coupon.py:28: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('discount_type')

app\schemas\coupon.py:34
  D:\Graphology\Master Software\Eduecosystem\backend\app\schemas\coupon.py:34: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    @validator('discount_value')

app\schemas\coupon.py:54
  D:\Graphology\Master Software\Eduecosystem\backend\app\schemas\coupon.py:54: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Coupon(CouponBase):

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\detection.py:81
  C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\detection.py:81: DeprecationWarning: torch.ao.quantization is deprecated and will be removed in 2.10. 
  For migrations of users: 
  1. Eager mode quantization (torch.ao.quantization.quantize, torch.ao.quantization.quantize_dynamic), please migrate to use torchao eager mode quantize_ API instead 
  2. FX graph mode quantization (torch.ao.quantization.quantize_fx.prepare_fx,torch.ao.quantization.quantize_fx.convert_fx, please migrate to use torchao pt2e quantization API instead (prepare_pt2e, convert_pt2e) 
  3. pt2e quantization has been migrated to torchao (https://github.com/pytorch/ao/tree/main/torchao/quantization/pt2e) 
  see https://github.com/pytorch/ao/issues/2259 for more details
    torch.quantization.quantize_dynamic(net, dtype=torch.qint8, inplace=True)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\torch\ao\quantization\quantize.py:566
C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\torch\ao\quantization\quantize.py:566
  C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\torch\ao\quantization\quantize.py:566: DeprecationWarning: torch.ao.quantization is deprecated and will be removed in 2.10. 
  For migrations of users: 
  1. Eager mode quantization (torch.ao.quantization.quantize, torch.ao.quantization.quantize_dynamic), please migrate to use torchao eager mode quantize_ API instead 
  2. FX graph mode quantization (torch.ao.quantization.quantize_fx.prepare_fx,torch.ao.quantization.quantize_fx.convert_fx, please migrate to use torchao pt2e quantization API instead (prepare_pt2e, convert_pt2e) 
  3. pt2e quantization has been migrated to torchao (https://github.com/pytorch/ao/tree/main/torchao/quantization/pt2e) 
  see https://github.com/pytorch/ao/issues/2259 for more details
    convert(model, mapping, inplace=True)

C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\recognition.py:177
  C:\Users\Sarit\AppData\Local\Programs\Python\Python313\Lib\site-packages\easyocr\recognition.py:177: DeprecationWarning: torch.ao.quantization is deprecated and will be removed in 2.10. 
  For migrations of users: 
  1. Eager mode quantization (torch.ao.quantization.quantize, torch.ao.quantization.quantize_dynamic), please migrate to use torchao eager mode quantize_ API instead 
  2. FX graph mode quantization (torch.ao.quantization.quantize_fx.prepare_fx,torch.ao.quantization.quantize_fx.convert_fx, please migrate to use torchao pt2e quantization API instead (prepare_pt2e, convert_pt2e) 
  3. pt2e quantization has been migrated to torchao (https://github.com/pytorch/ao/tree/main/torchao/quantization/pt2e) 
  see https://github.com/pytorch/ao/issues/2259 for more details
    torch.quantization.quantize_dynamic(model, dtype=torch.qint8, inplace=True)

app\api\api_v1\endpoints\earnings.py:45
  D:\Graphology\Master Software\Eduecosystem\backend\app\api\api_v1\endpoints\earnings.py:45: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Transaction(BaseModel):

tests/api/test_analytics.py::test_dashboard_analytics_basic
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_handwriting_count
tests/api/test_analytics.py::test_analytics_insights_generation
tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_detailed_analytics
tests/api/test_analytics.py::test_analytics_with_activity_heatmap
tests/api/test_analytics.py::test_analytics_empty_state
  D:\Graphology\Master Software\Eduecosystem\backend\app\services\coin_service.py:234: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/api/test_analytics.py::test_dashboard_analytics_basic
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_handwriting_count
tests/api/test_analytics.py::test_analytics_insights_generation
tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_detailed_analytics
tests/api/test_analytics.py::test_analytics_with_activity_heatmap
tests/api/test_analytics.py::test_analytics_empty_state
  D:\Graphology\Master Software\Eduecosystem\backend\app\core\security.py:16: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + expires_delta

tests/api/test_analytics.py::test_dashboard_analytics_basic
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_handwriting_count
tests/api/test_analytics.py::test_analytics_insights_generation
tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_analytics_empty_state
  D:\Graphology\Master Software\Eduecosystem\backend\app\api\api_v1\endpoints\analytics.py:23: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    seven_days_ago = datetime.utcnow() - timedelta(days=7)

tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
  D:\Graphology\Master Software\Eduecosystem\backend\tests\api\test_analytics.py:81: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    start_time=datetime.utcnow(),

tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
tests/api/test_analytics.py::test_analytics_with_shadow_sessions
  D:\Graphology\Master Software\Eduecosystem\backend\tests\api\test_analytics.py:82: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    end_time=datetime.utcnow(),

tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_analytics_attention_tracking
tests/api/test_analytics.py::test_analytics_attention_tracking
  D:\Graphology\Master Software\Eduecosystem\backend\tests\api\test_analytics.py:190: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/api/test_analytics.py: 10 warnings
  D:\Graphology\Master Software\Eduecosystem\backend\tests\api\test_analytics.py:264: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/api/test_analytics.py::test_unauthorized_analytics_access
  D:\Graphology\Master Software\Eduecosystem\backend\tests\conftest.py:47: SAWarning: Can't sort tables for DROP; an unresolvable foreign key dependency exists between tables: lessons, modules, quizzes; and backend does not support ALTER.  To restore at least a partial sort, apply use_alter=True to ForeignKey and ForeignKeyConstraint objects involved in the cycle to mark these as known cycles that will be ignored.
    Base.metadata.drop_all(bind=engine)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/api/test_analytics.py::test_dashboard_analytics_basic - assert 2...
================== 1 failed, 8 passed, 52 warnings in 46.77s ==================
